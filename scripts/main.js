(()=>{var $e=Object.defineProperty;var l=(s,t)=>$e(s,"name",{value:t,configurable:!0});var f="pf2e-token-hud";function v(s){return game.settings.get(f,s)}l(v,"getSetting");function h(...s){let t=s.at(-1),i=typeof t=="object",e=i?s.slice(0,-1):s;return e.unshift(f),game.i18n[i?"format":"localize"](e.join("."),t)}l(h,"localize");function R(s){return`modules/${f}/templates/${s}.hbs`}l(R,"templatePath");function X(s){return s>=0?`+${s}`:s}l(X,"modifier");var Ne=new Map([["incredibly-easy",-10],["very-easy",-5],["easy",-2],["normal",0],["hard",2],["very-hard",5],["incredibly-hard",10]]),He=new Map([[-1,13],[0,14],[1,15],[2,16],[3,18],[4,19],[5,20],[6,22],[7,23],[8,24],[9,26],[10,27],[11,28],[12,30],[13,31],[14,32],[15,34],[16,35],[17,36],[18,38],[19,39],[20,40],[21,42],[22,44],[23,46],[24,48],[25,50]]),ce=new Set(["arcane","divine","occult","primal"]),re={0:"systems/pf2e/icons/actions/FreeAction.webp",free:"systems/pf2e/icons/actions/FreeAction.webp",1:"systems/pf2e/icons/actions/OneAction.webp",2:"systems/pf2e/icons/actions/TwoActions.webp",3:"systems/pf2e/icons/actions/ThreeActions.webp","1 or 2":"systems/pf2e/icons/actions/OneTwoActions.webp","1 to 3":"systems/pf2e/icons/actions/OneThreeActions.webp","2 or 3":"systems/pf2e/icons/actions/TwoThreeActions.webp",reaction:"systems/pf2e/icons/actions/Reaction.webp",passive:"systems/pf2e/icons/actions/Passive.webp"};function le(s,t="systems/pf2e/icons/actions/Empty.webp"){if(s===null)return re.passive;let i=typeof s!="object"?s:s.type==="action"?s.value:s.type,e=String(i??"").toLowerCase().trim();return re[e]??t}l(le,"getActionIcon");async function ue({weapon:s,trait:t,selection:i}){if(s.system.traits.toggles[t].selection===i)return!1;let n=s.actor?.items.get(s.id);return n?.isOfType("weapon")&&n===s?await n.update({[`system.traits.toggles.${t}.selection`]:i}):n?.isOfType("weapon")&&s.altUsageType==="melee"?await n.update({[`system.meleeUsage.traitToggles.${t}`]:i}):await n?.rules.find(r=>r.key==="Strike"&&!r.ignored&&r.slug===s.slug)?.toggleTrait({trait:t,selection:i}),!0}l(ue,"toggleWeaponTrait");function je(s,t="normal"){return s+(Ne.get(t)??0)}l(je,"adjustDC");function Re(s="common"){switch(s){case"uncommon":return"hard";case"rare":return"very-hard";case"unique":return"incredibly-hard";default:return"normal"}}l(Re,"rarityToDCAdjustment");function Q(s,t="common"){return je(s,Re(t))}l(Q,"adjustDCByRarity");function ze(s,{proficiencyWithoutLevel:t,rarity:i="common"}={}){let e=game.settings.get("pf2e","proficiencyVariant");t??=e==="ProficiencyWithoutLevel";let n=He.get(s)??14;return Q(t?n-Math.max(s,0):n,i)}l(ze,"calculateDC");function Be(s){return s.traits.has("cursed")?"unique":s.rarity}l(Be,"getDcRarity");function Ue(s){let t=s.system.traits.value;return new Set(t.filter(i=>We(ce,i)))}l(Ue,"getMagicTraditions");function Ge(s,t,i){let e={occult:t,primal:t,divine:t,arcane:t},n=Ue(s);for(let a of ce)n.size>0&&!n.has(a)&&(e[a]=t+i);return{arcana:e.arcane,nature:e.primal,religion:e.divine,occultism:e.occult}}l(Ge,"getIdentifyMagicDCs");function _e(s,{proficiencyWithoutLevel:t=!1,notMatchingTraditionModifier:i}){let e=ze(s.level,{proficiencyWithoutLevel:t}),n=Be(s),a=Q(e,n);return s.isMagical?Ge(s,a,i):s.isAlchemical?{crafting:a}:{dc:a}}l(_e,"getItemIdentificationDCs");function qe(s,t){return(typeof t=="string"||typeof t=="number")&&t in s}l(qe,"objectHasKey");function We(s,t){return s.has(t)}l(We,"setHasElement");var z=class extends FormApplication{static get defaultOptions(){return{...super.defaultOptions,id:"identify-item",title:game.i18n.localize("PF2E.identification.Identify"),template:"systems/pf2e/templates/actors/identify-item.hbs",width:"auto",classes:["identify-popup"]}}get item(){return this.object}async getData(){let t=this.object,i=game.settings.get("pf2e","identifyMagicNotMatchingTraditionModifier"),e=game.settings.get("pf2e","proficiencyVariant")==="ProficiencyWithoutLevel",n=_e(t,{proficiencyWithoutLevel:e,notMatchingTraditionModifier:i});return{...await super.getData(),isMagic:t.isMagical,isAlchemical:t.isAlchemical,dcs:n}}activateListeners(t){t.find("button.update-identification").on("click",i=>{let e=$(i.delegateTarget);this.submit({updateData:{status:e.val()}})}),t.find("button.post-skill-checks").on("click",async()=>{let i=this.item,e=i.system.identification.unidentified.img,n=i.system.identification.unidentified.name,a=i.system.identification.identified.name,r=$("div#identify-item").find("tr").toArray().flatMap(c=>{let p=c.dataset.skill,d=Number(c.dataset.dc);if(!(Number.isInteger(d)&&qe(CONFIG.PF2E.skillList,p)))return[];let m=game.i18n.localize(CONFIG.PF2E.skillList[p]);return{slug:p,name:m,dc:d}}),o=i.isMagical?"action:identify-magic":i.isAlchemical?"action:identify-alchemy":null,u=await renderTemplate("systems/pf2e/templates/actors/identify-item-chat-skill-checks.hbs",{itemImg:e,itemName:n,identifiedName:a,rollOptions:["concentrate","exploration","secret",o].filter(Boolean),skills:r});await CONFIG.ChatMessage.documentClass.create({user:game.user.id,content:u})})}async _updateObject(t,i){let e=i.status;e==="identified"&&await this.item.setIdentificationStatus(e)}};l(z,"IdentifyItemPopup");async function pe(s,t,i,{rollMode:e=void 0,create:n=!0,data:a={}}){let r=`systems/pf2e/templates/chat/${t.type}-card.hbs`,o=i.token,u=s?.currentTarget.closest(".item")??{},c=CONFIG.ChatMessage.documentClass,p=Object.keys(a).length>0?a:u.dataset||{},d={actor:i,tokenId:o?`${o.parent?.id}.${o.id}`:null,item:t,data:await t.getChatData(void 0,p)},m={speaker:c.getSpeaker({actor:i,token:i.getActiveTokens(!1,!0)[0]??null}),flags:{core:{canPopout:!0},pf2e:{origin:{uuid:t.uuid,type:t.type}}},type:CONST.CHAT_MESSAGE_TYPES.OTHER};return e??=s?.ctrlKey||s?.metaKey?"blindroll":game.settings.get("core","rollMode"),["gmroll","blindroll"].includes(e)&&(m.whisper=c.getWhisperRecipients("GM").map(k=>k.id)),e==="blindroll"&&(m.blind=!0),m.content=await renderTemplate(r,d),n?c.create(m,{renderSheet:!1}):new c(m)}l(pe,"unownedItemToMessage");async function O(s,t){let i=$(`#${f}`);if(!i.length)return;i.find(".popup").remove();let e=document.createElement("div");e.innerHTML=await renderTemplate(R("popup"),{title:s,close:h("popup.close")});let n=e.firstElementChild;n.append(t),n.querySelector("[data-action=close-popup]").addEventListener("click",()=>n.remove()),i.append(n)}l(O,"popup");async function N(s,t){let i=s.data(),e=i.itemId?t.items.get(i.itemId):await fromUuid(i.uuid),n=await e?.getChatData({},i);if(!n)return;let a=document.createElement("div");return a.classList.add("description"),await t.sheet.itemRenderer.renderItemSummary(a,e,n),a}l(N,"getItemSummary");function A(s){s.on("mouseenter",t=>{t.preventDefault();let i=t.currentTarget.querySelector(".name");if(i.scrollWidth<=i.clientWidth)return;let e=i.innerHTML.trim();game.tooltip.activate(t.currentTarget,{text:e})}),s.on("mouseleave",t=>{t.preventDefault(),game.tooltip.deactivate()}),s.on("mousedown",t=>{game.tooltip.deactivate()})}l(A,"addNameTooltipListeners");function de(s,t){s.preventDefault(),x(s,t)?.sheet.render(!0,{focus:!0})}l(de,"editItem");async function me(s,t){s.preventDefault();let i=x(s,t);if(i){if(s.ctrlKey)return i.delete();new Dialog({title:h("deleteItem.title"),content:await renderTemplate("systems/pf2e/templates/actors/delete-item-dialog.hbs",{name:i.name}),buttons:{ok:{icon:'<i class="fa-solid fa-trash"></i>',label:h("deleteItem.ok"),callback:()=>i.delete()},cancel:{icon:'<i class="fas fa-times"></i>',label:h("deleteItem.cancel")}}}).render(!0)}}l(me,"deleteItem");function x(s,t){let{itemId:i}=s.currentTarget.closest("[data-item-id]").dataset;return t.items.get(i)}l(x,"getItemFromEvent");var Ve=new Set(["Compendium.pf2e.equipment-srd.44F1mfJei4GY8f2X","Compendium.pf2e.equipment-srd.4kz3vhkKPUuXBpxk"]),fe="Compendium.pf2e.feats-srd.0GF2j54roPFIDmXf",Ke={initiative:"PF2E.InitiativeLabel","recall-knowledge":"PF2E.RecallKnowledge.Label","cover-tracks":"PF2E.TravelSpeed.ExplorationActivities.CoverTracks",earnIncome:`${f}.skills.actions.earnIncome`,treatWounds:`${f}.skills.actions.treatWounds`,"borrow-arcane-spell":`${f}.skills.actions.borrow-arcane-spell`,"identify-magic":`${f}.skills.actions.identify-magic`,"identify-alchemy":`${f}.skills.actions.identify-alchemy`,"learn-spell":`${f}.skills.actions.learn-spell`,"crafting-goods":`${f}.skills.actions.crafting-goods`,"staging-performance":`${f}.skills.actions.staging-performance`},ge={"sense-motive":"Compendium.pf2e.actionspf2e.1xRFPTFtWtGJ9ELw",seek:"Compendium.pf2e.actionspf2e.BlAOM2X92SI6HMtJ",balance:"Compendium.pf2e.actionspf2e.M76ycLAqHoAgbcej",escape:"Compendium.pf2e.actionspf2e.SkZAQRkLLkmBQNB9","tumble-through":"Compendium.pf2e.actionspf2e.21WIfSu7Xd7uKqV8","maneuver-in-flight":"Compendium.pf2e.actionspf2e.Qf1ylAbdVi1rkc8M",squeeze:"Compendium.pf2e.actionspf2e.kMcV8e5EZUxa6evt","recall-knowledge":"Compendium.pf2e.actionspf2e.1OagaWtBpVXExToo","borrow-arcane-spell":"Compendium.pf2e.actionspf2e.OizxuPb44g3eHPFh","decipher-writing":"Compendium.pf2e.actionspf2e.d9gbpiQjChYDYA2L","identify-magic":"Compendium.pf2e.actionspf2e.eReSHVEPCsdkSL4G","learn-spell":"Compendium.pf2e.actionspf2e.Q5iIYCFdqJFM31GW",climb:"Compendium.pf2e.actionspf2e.pprgrYQ1QnIDGZiy",forceOpen:"Compendium.pf2e.actionspf2e.SjmKHgI7a5Z9JzBx",grapple:"Compendium.pf2e.actionspf2e.PMbdMWc2QroouFGD",highJump:"Compendium.pf2e.actionspf2e.2HJ4yuEFY1Cast4h",longJump:"Compendium.pf2e.actionspf2e.JUvAvruz7yRQXfz2",shove:"Compendium.pf2e.actionspf2e.7blmbDrQFNfdT731",swim:"Compendium.pf2e.actionspf2e.c8TGiZ48ygoSPofx",trip:"Compendium.pf2e.actionspf2e.ge56Lu1xXVFYUnLP",disarm:"Compendium.pf2e.actionspf2e.Dt6B1slsBy8ipJu9",repair:"Compendium.pf2e.actionspf2e.bT3skovyLUtP22ME",craft:"Compendium.pf2e.actionspf2e.rmwa3OyhTZ2i2AHl","crafting-goods":"",earnIncome:"Compendium.pf2e.actionspf2e.QyzlsLrqM0EEwd7j","identify-alchemy":"Compendium.pf2e.actionspf2e.Q4kdWVOf2ztIBFg1",createADiversion:"Compendium.pf2e.actionspf2e.GkmbTGfg8KcgynOA",impersonate:"Compendium.pf2e.actionspf2e.AJstokjdG6iDjVjE",lie:"Compendium.pf2e.actionspf2e.ewwCglB7XOPLUz72",feint:"Compendium.pf2e.actionspf2e.QNAVeNKtHA0EUw4X",bonMot:fe,gatherInformation:"Compendium.pf2e.actionspf2e.plBGdZhqq5JBl1D8",makeAnImpression:"Compendium.pf2e.actionspf2e.OX4fy22hQgUHDr0q",request:"Compendium.pf2e.actionspf2e.DCb62iCBrJXy0Ik6",coerce:"Compendium.pf2e.actionspf2e.tHCqgwjtQtzNqVvd",demoralize:"Compendium.pf2e.actionspf2e.2u915NdUyQan6uKF","administer-first-aid":"Compendium.pf2e.actionspf2e.MHLuKy4nQO2Z4Am1","treat-disease":"Compendium.pf2e.actionspf2e.TC7OcDa7JlWbqMaN","treat-poison":"Compendium.pf2e.actionspf2e.KjoCEEmPGTeFE4hh",treatWounds:"Compendium.pf2e.actionspf2e.1kGNdIIhuglAjIp9","command-an-animal":"Compendium.pf2e.actionspf2e.q9nbyIF0PEBqMtYe",perform:"Compendium.pf2e.actionspf2e.EEDElIyin4z60PXx","staging-performance":"",subsist:"Compendium.pf2e.actionspf2e.49y9Ec4bDii8pcD3","create-forgery":"Compendium.pf2e.actionspf2e.ftG89SjTSa9DYDOD","conceal-an-object":"Compendium.pf2e.actionspf2e.qVNVSmsgpKFGk9hV",hide:"Compendium.pf2e.actionspf2e.XMcnh4cSI32tljXa",sneak:"Compendium.pf2e.actionspf2e.VMozDqMMuK5kpoX4",senseDirection:"Compendium.pf2e.actionspf2e.fJImDBQfqfjKJOhk","cover-tracks":"Compendium.pf2e.actionspf2e.SB7cMECVtE06kByk",track:"Compendium.pf2e.actionspf2e.EA5vuSgJfiHH7plD","palm-an-object":"Compendium.pf2e.actionspf2e.ijZ0DDFpMkWqaShd",steal:"Compendium.pf2e.actionspf2e.RDXXE7wMrSPCLv5k","disable-device":"Compendium.pf2e.actionspf2e.cYdz2grcOcRt4jk6","pick-a-lock":"Compendium.pf2e.actionspf2e.2EE4aF4SZpYf0R6H"},Je={escape:{slug:"escape",cost:"1",type:2,noSkill:!0},"recall-knowledge":{slug:"recall-knowledge",cost:"1",secret:!0},"decipher-writing":{slug:"decipher-writing",type:2,trained:!0},"identify-magic":{slug:"identify-magic",trained:!0},"learn-spell":{slug:"learn-spell",trained:!0}},B=[{slug:"perception",actions:[{slug:"sense-motive",cost:"1",type:2},{slug:"seek",cost:"1",type:2}]},{slug:"acrobatics",actions:[{slug:"balance",cost:"1",type:2},"escape",{slug:"tumble-through",cost:"1",type:2},{slug:"maneuver-in-flight",cost:"1",type:2,trained:!0},{slug:"squeeze",type:2,trained:!0}]},{slug:"arcana",actions:["recall-knowledge",{slug:"borrow-arcane-spell",trained:!0},"decipher-writing","identify-magic","learn-spell"]},{slug:"athletics",actions:[{slug:"climb",cost:"1",type:1},"escape",{slug:"forceOpen",cost:"1",type:1,map:!0,modifiers:[{condition:s=>!s.itemTypes.equipment.some(t=>t.isHeld&&Ve.has(t.sourceId)),modifiers:[{slug:"crowbar-missing",modifier:-2,type:"circumstance"}]}]},{slug:"grapple",cost:"1",type:1,map:!0},{slug:"highJump",cost:"1",type:1},{slug:"longJump",cost:"1",type:1},{slug:"shove",cost:"1",type:1,map:!0},{slug:"swim",cost:"1",type:1},{slug:"trip",cost:"1",type:2,map:!0},{slug:"disarm",cost:"1",type:1,map:!0,trained:!0}]},{slug:"crafting",actions:["recall-knowledge",{slug:"repair",type:1},{slug:"craft",type:1,trained:!0},{slug:"crafting-goods",trained:!0},{slug:"earnIncome",type:3,trained:!0},{slug:"identify-alchemy",trained:!0}]},{slug:"deception",actions:[{slug:"createADiversion",cost:"1",type:1,variants:["distracting-words","gesture","trick"]},{slug:"impersonate",type:1},{slug:"lie",type:1},{slug:"feint",cost:"1",type:1,trained:!0}]},{slug:"diplomacy",actions:[{slug:"bonMot",cost:"1",type:1,condition:s=>s.itemTypes.feat.some(t=>t.getFlag("core","sourceId")===fe)},{slug:"gatherInformation",type:1},{slug:"makeAnImpression",type:1},{slug:"request",cost:"1",type:1}]},{slug:"intimidation",actions:[{slug:"coerce",type:2},{slug:"demoralize",cost:"1",type:2}]},{slug:"medicine",actions:[{slug:"administer-first-aid",cost:"2",type:2,variants:["stabilize","stop-bleeding"]},{slug:"treat-disease",type:2,trained:!0},{slug:"treat-poison",cost:"1",type:2,trained:!0},{slug:"treatWounds",type:1,trained:!0}]},{slug:"nature",actions:[{slug:"command-an-animal",cost:"1",type:2},"recall-knowledge","identify-magic","learn-spell"]},{slug:"occultism",actions:["recall-knowledge","decipher-writing","identify-magic","learn-spell"]},{slug:"performance",actions:[{slug:"perform",cost:"1",type:1,variants:["acting","comedy","dance","keyboards","oratory","percussion","singing","strings","winds","warning"]},{slug:"staging-performance",trained:!0}]},{slug:"religion",actions:["recall-knowledge","decipher-writing","identify-magic","learn-spell"]},{slug:"society",actions:["recall-knowledge",{slug:"subsist",type:2},{slug:"create-forgery",type:2,trained:!0},"decipher-writing"]},{slug:"stealth",actions:[{slug:"conceal-an-object",cost:"1",type:2},{slug:"hide",cost:"1",type:2},{slug:"sneak",cost:"1",type:2}]},{slug:"survival",actions:[{slug:"senseDirection",type:1},{slug:"subsist",type:2},{slug:"cover-tracks",trained:!0},{slug:"track",type:1,trained:!0}]},{slug:"thievery",actions:[{slug:"palm-an-object",cost:"1",type:2},{slug:"steal",cost:"1",type:2},{slug:"disable-device",cost:"2",type:2,trained:!0},{slug:"pick-a-lock",cost:"2",type:2,trained:!0}]}];B.forEach(s=>{s.actions=s.actions.map(e=>typeof e=="string"?Je[e]:e);let{slug:t,actions:i}=s;for(let e of i){let n=e.slug.replace(/-(.)/g,(a,r)=>r.toUpperCase()).capitalize();e.skillSlug=t,e.uuid=ge[e.slug],e.label=Ke[e.slug]??`PF2E.Actions.${n}.Title`,e.variants?e.variants=e.variants.map(a=>({slug:a,label:`${f}.skills.actions.${a}`})):e.map&&(e.variants=[{label:"PF2E.Roll.Normal"},{label:"PF2E.MAPAbbreviationLabel",map:-5},{label:"PF2E.MAPAbbreviationLabel",map:-10}]),e.modifiers?.forEach(({modifiers:a})=>{a.forEach(r=>{r.label=`${f}.skills.modifiers.${r.slug}`})})}});var Y=B.map(s=>s.slug),Xe=B.reduce((s,{slug:t,actions:i})=>(s[t]={slug:t,actions:i.reduce((e,n)=>(e[n.slug]=n,e),{})},s),{}),he=new Set(Object.values(ge).filter(Boolean));function Z(s){return game.i18n.localize(s==="perception"?"PF2E.PerceptionLabel":CONFIG.PF2E.skillList[s])}l(Z,"getSkillLabel");async function ye(s){let t=[],i=!v("untrained"),e=!s.isOfType("character");for(let a=0;a<B.length;a++){let{slug:r,actions:o}=B[a],{label:u,rank:c,mod:p}=ee(r,s);t[a]={slug:r,label:u,rank:c,modifier:X(p),actions:o.filter(d=>(i||e||!d.trained||s.skills[r].rank>=1)&&(!d.condition||d.condition(s)))}}let n=Object.values(s.skills).filter(a=>a.lore).map(({label:a,rank:r,mod:o,slug:u})=>({slug:u,label:a,rank:r,modifier:X(o)}));return{skills:t,lores:n,doubled:v("skills-columns")}}l(ye,"getSkillsData");function ee(s,t){return s==="perception"?t.perception:t.skills[s]}l(ee,"getSkill");function ve(s,t){s.find("[data-action=roll-skill]").on("click",i=>{i.preventDefault();let{slug:e}=i.currentTarget.dataset;ee(e,t).roll({event:i})}),s.find("[data-action=roll-action]").on("click contextmenu",async i=>{i.preventDefault();let e=$(i.currentTarget),{skillSlug:n,slug:a}=e.closest(".action").data(),r=i.type==="contextmenu"?await Qe(t,n):void 0;r!==null&&Ye(i,t,n,a,e.data(),r)}),s.find("[data-action=action-description]").on("click",async i=>{i.preventDefault();let e=$(i.currentTarget).closest(".action"),n=await N(e,t);n&&O(e.find(".name").children().html().trim(),n)}),s.find("[data-action=action-chat]").on("click",async i=>{i.preventDefault();let{uuid:e}=i.currentTarget.closest(".action").dataset,n=await fromUuid(e);n&&pe(i,n,t,{create:!0})})}l(ve,"addSkillsListeners");async function Qe(s,t){let i='<p style="text-align: center; margin-block: 0 8px;">';i+=`<strong>${h("skills.variant.label")}</strong> <select>`;for(let e of Y){let n=e===t?"selected":"",a=Z(e);i+=`<option value="${e}" ${n}>${a}</option>`}return i+="</select></p>",Dialog.prompt({title:h("skills.variant.title"),label:h("skills.variant.button"),callback:e=>e.find("select").val(),rejectClose:!1,content:i,options:{width:280}})}l(Qe,"createVariantDialog");function Ye(s,t,i,e,{variant:n,map:a},r){let o=Xe[i].actions[e],u=o.type;r??=o.noSkill?void 0:i;let c={event:s,actors:[t],variant:n,rollMode:o.secret?"blindroll":"roll"};if(c.modifiers=[],o.modifiers){for(let{condition:p,modifiers:d}of o.modifiers)if(!(p&&!p(t)))for(let m of d)c.modifiers.push(new game.pf2e.Modifier(m))}if(o.custom){o.custom(t,c);return}else if(!u){ee(r,t).roll(c);return}u===1?(c.skill=r,a&&c.modifiers.push(new game.pf2e.Modifier({label:"PF2E.MultipleAttackPenalty",modifier:a})),game.pf2e.actions[e](c)):u===2?(c.statistic=r,a&&(c.multipleAttackPenalty=a/-5),game.pf2e.actions.get(e).use(c)):u===3&&game.pf2e.actions[e](t)}l(Ye,"rollAction");var H={action:{order:0,label:"PF2E.ActionsActionsHeader",actionLabel:"PF2E.ActionTypeAction"},reaction:{order:1,label:"PF2E.ActionTypeReaction",actionLabel:"PF2E.ActionTypeReaction"},free:{order:2,label:"PF2E.ActionTypeFree",actionLabel:"PF2E.ActionTypeFree"},passive:{order:3,label:"PF2E.ActionTypePassive",actionLabel:"PF2E.ActionTypePassive"}},be={delay:[500,0],position:"top",theme:"crb-hover",arrow:!1};async function ke(s){let t=s.isOfType("character"),i=s.synthetics.toggles.slice(),e=t?Ze(s):null,n=v("actions"),a=t?et(s):tt(s),r=await Promise.all(s.system.actions.map(async(u,c)=>({...u,index:c,damageFormula:await u.damage?.({getFormula:!0}),criticalFormula:await u.critical?.({getFormula:!0})}))),o={};for(let u of a)n!=="split"?(o.action??=[],o.action.push(u)):(o[u.type]??=[],o[u.type].push(u));if(o=Object.entries(o).map(([u,c])=>(c.forEach(p=>{p.img=le(p.cost),p.typeLabel=H[p.type].actionLabel}),n!=="type"?c.sort((p,d)=>p.name.localeCompare(d.name)):c.sort((p,d)=>{let m=H[p.type].order,k=H[d.type].order;return m===k?p.name.localeCompare(d.name):m-k}),{type:u,actions:c,label:H[u].label})),n==="split"&&o.sort((u,c)=>H[u.type].order-H[c.type].order),i.length||r.length||o.length||e?.length)return{toggles:i,strikes:r,sections:o,heroActions:e,damageTypes:CONFIG.PF2E.damageTypes}}l(ke,"getActionsData");function we(s){if(v("actions-colors"))return{classList:["attack-damage-system-colors"]}}l(we,"getActionsOptions");function Te(s,t){A(s.find(".toggle")),A(s.find(".strike")),A(s.find(".action")),s.find("[data-action=action-chat]").on("click",e=>{e.preventDefault(),x(e,t).toMessage(e,{create:!0})}),s.find("[data-action=action-description]").on("click",async e=>{e.preventDefault();let n=$(e.currentTarget).closest(".action"),a=await N(n,t);a&&O(n.find(".name").html().trim(),a)}),s.find("[data-action=toggle-roll-option], [data-action=set-suboption]").on("click",e=>{e.preventDefault();let n=e.currentTarget.closest(".toggle"),{domain:a,option:r,itemId:o}=n.dataset,u=n.querySelector("select")?.value??null;t.toggleRollOption(a,r,o??null,n.querySelector("input").checked,u)});function i(e){let{index:n}=e.currentTarget.closest(".strike").dataset;return t.system.actions[n]}l(i,"getStrike"),s.find("[data-action=strike-attack]").on("click",e=>{e.preventDefault();let{index:n}=e.currentTarget.dataset;i(e)?.variants[n].roll({event:e})}),s.find("[data-action=strike-damage], [data-action=strike-critical]").on("click",e=>{e.preventDefault();let{action:n}=e.currentTarget.dataset;i(e)?.[n==="strike-damage"?"damage":"critical"]({event:e})}).tooltipster(be),s.find("[data-action=strike-auxiliary]").on("click",e=>{if(e.preventDefault(),e.currentTarget!==e.target)return;let n=i(e);if(!n)return;let{index:a}=e.currentTarget.dataset,r=e.currentTarget.querySelector("select")?.value??null;n.auxiliaryActions?.[a]?.execute({selection:r})}),s.find("[data-action=toggle-versatile]").on("click",e=>{e.preventDefault();let n=i(e)?.item;if(!n)return;let a=e.currentTarget,{value:r}=a.dataset,o=n?.system.damage.damageType??null,u=a.classList.contains("selected")||r===o?null:r;ue({trait:"versatile",weapon:n,selection:u})}).tooltipster(be),s.find("[data-action=strike-ammo]").on("change",async e=>{e.preventDefault();let n=i(e)?.item;if(!n)return;let a=t.items.get(e.currentTarget.value);await n.update({system:{selectedAmmoId:a?.id??null}})})}l(Te,"addActionsListeners");function Ze(s){let t=game.modules.get("pf2e-hero-actions");return t?.active?t.api.getHeroActions(s):null}l(Ze,"getHeroActions");function et(s){let t=s.itemTypes.action.filter(e=>!he.has(e.sourceId)),i=s.itemTypes.feat.filter(e=>e.actionCost);return[...t,...i].filter(e=>{let n=e.system.traits.value;return!n.includes("downtime")&&!n.includes("exploration")}).map(e=>{let n=e.actionCost;return{id:e.id,type:n?.type??"free",cost:n,name:e.name}})}l(et,"getCharacterActions");function tt(s){return s.itemTypes.action.map(t=>{let i=t.actionCost,e=i?.type??"passive",n=e==="passive"&&(t.system.traits.value.includes("aura")||!!t.system.rules.find(a=>a.key==="Aura"));return{id:t.id,type:e,cost:i,name:t.name,hasDeathNote:t.system.deathNote,hasAura:n}})}l(tt,"getNpcActions");async function Ce(s){let{attributes:t}=s,{initiative:i}=t;return{initiative:{selected:i.statistic,skills:Y.map(e=>({slug:e,label:Z(e)}))},hasDailies:game.modules.get("pf2e-dailies").active}}l(Ce,"getExtrasData");function Ie(s,t){s.find("input[name], select[name]").on("change",async i=>{let e=i.currentTarget,n=e.type==="number"?e.valueAsNumber:e.value;await t.update({[e.name]:n})}),s.find("[data-action=roll-initiative]").on("click",async i=>{i.preventDefault(),await t.initiative.roll({event:i})}),s.find("[data-action=prepare-dailies]").on("click",async i=>{i.preventDefault();let e=game.modules.get("pf2e-dailies");e.active&&e.api.openDailiesInterface(t)}),s.find("[data-action=rest-for-the-night]").on("click",i=>{i.preventDefault(),game.pf2e.actions.restForTheNight({actors:[t]})})}l(Ie,"addExtrasListeners");var te={weapon:{order:0,label:"PF2E.InventoryWeaponsHeader"},armor:{order:1,label:"PF2E.InventoryArmorHeader"},consumable:{order:2,label:"PF2E.InventoryConsumablesHeader"},equipment:{order:3,label:"PF2E.InventoryEquipmentHeader"},treasure:{order:4,label:"PF2E.InventoryTreasureHeader"},backpack:{order:5,label:"PF2E.InventoryBackpackHeader"}};async function Se(s){let t={};for(let i of s.inventory.contents)t[i.type]??=[],t[i.type].push(i);return{categories:Object.entries(t).map(([i,e])=>(e.sort((n,a)=>n.name.localeCompare(a.name)),{type:i,items:e,label:te[i].label})).sort((i,e)=>te[i.type].order-te[e.type].order)}}l(Se,"getItemsData");function De(s,t){let i=s.find(".item");A(i),i.on("dragstart",e=>{let n=e.target.closest(".item"),{itemType:a,uuid:r}=n.dataset,o=new Image;o.src=n.querySelector(".item-img img").src,o.style.width="32px",o.style.height="32px",o.style.borderRadius="4px",o.style.position="absolute",o.style.left="-1000px",document.body.append(o),e.originalEvent.dataTransfer.setDragImage(o,16,16),e.originalEvent.dataTransfer.setData("text/plain",JSON.stringify({type:"Item",fromInventory:!0,itemType:a,uuid:r})),n.addEventListener("dragend",()=>o.remove(),{once:!0})}),s.find(".quantity input").on("change",async e=>{await x(e,t)?.update({"system.quantity":e.currentTarget.valueAsNumber})}),s.find("[data-action=toggle-item-invest]").on("click",e=>{e.preventDefault();let{itemId:n}=e.currentTarget.closest(".item").dataset;t.toggleInvested(n)}),s.find("[data-action=repair-item]").on("click",e=>{e.preventDefault();let n=x(e,t);n&&game.pf2e.actions.repair({item:n,actors:[t]})}),s.find("[data-action=toggle-identified]").on("click",e=>{e.preventDefault();let n=x(e,t);n&&(n.isIdentified?n.setIdentificationStatus("unidentified"):new z(n).render(!0))}),s.find("[data-action=edit-item]").on("click",e=>de(e,t)),s.find("[data-action=delete-item]").on("click",e=>me(e,t)),s.find("[data-action=toggle-item-worn").tooltipster({animation:null,updateAnimation:null,animationDuration:0,delay:[0,0],trigger:"click",contentAsHTML:!0,interactive:!0,arrow:!1,side:["bottom","top"],theme:"crb-hover",minWidth:120,content:"",functionBefore:async function(e,{event:n,origin:a}){let r=x(n,t);if(!r)return;let o=document.createElement("div");o.innerHTML=await renderTemplate("systems/pf2e/templates/actors/partials/carry-type.hbs",{item:r});let u=o.children[1];$(u).find("[data-carry-type]").on("click",c=>{let{carryType:p,handsHeld:d=0,inSlot:m}=$(c.currentTarget).data();t.adjustCarryType(r,p,d,m),e.close()}),e.content(u)}})}l(De,"addItemsListeners");async function Ee(s){let t=s.system.resources.focus?.value??0,i=s.spellcasting.regular,e=v("tradition"),n=[];for(let o of i){let u=o.id,c=e&&o.statistic.label[0],p=await o.getSheetData(),d=o.system?.prepared?.value==="charge",m=getProperty(o,"flags.pf2e-staves.staveID")!==void 0,k={value:getProperty(o,"flags.pf2e-staves.charges")??0};for(let b of p.levels){if(!b.active.length||b.uses?.max===0)continue;let D=[],L=b.active.filter(E=>E&&E.uses?.max!==0);for(let E=0;E<L.length;E++){let{spell:I,expended:G,virtual:_,uses:q,castLevel:W}=L[E];D.push({name:I.name,img:I.img,tradition:c,castLevel:W??I.level,slotId:E,entryId:u,itemId:I.id,inputId:p.isInnate?I.id:p.id,inputPath:d?"flags.pf2e-staves.charges":p.isInnate?"system.location.uses.value":`system.slots.slot${b.level}.value`,isCharge:d,isVirtual:_,isInnate:p.isInnate,isCantrip:b.isCantrip,isFocus:p.isFocusPool,isPrepared:p.isPrepared,isSpontaneous:p.isSpontaneous||p.isFlexible,slotLevel:b.level,uses:q??(d?k:b.uses),expended:G??(p.isFocusPool&&!b.isCantrip?t<=0:!1),action:I.system.time.value,type:d?m?`${f}.spells.staff`:`${f}.spells.charges`:p.isInnate?"PF2E.PreparationTypeInnate":p.isSpontaneous?"PF2E.PreparationTypeSpontaneous":p.isFlexible?"PF2E.SpellFlexibleLabel":p.isFocusPool?"PF2E.SpellFocusLabel":"PF2E.SpellPreparedLabel",order:d?0:p.isPrepared?1:p.isFocusPool?2:p.isInnate?3:p.isSpontaneous?4:5})}D.length&&(n[b.level]??=[],n[b.level].push(...D))}}if(n.length){let o=v("spells")?(u,c)=>u.order===c.order?u.name.localeCompare(c.name):u.order-c.order:(u,c)=>u.name.localeCompare(c.name);n.forEach(u=>u.sort(o))}let r=(await s.spellcasting.ritual?.getSheetData())?.levels.flatMap((o,u)=>o.active.map(({spell:c})=>({name:c.name,img:c.img,slotId:u,itemId:c.id,level:c.level,time:c.system.time.value})));if(n.length||r?.length)return{spells:n,rituals:r,doubled:v("spells-columns")}}l(Ee,"getSpellsData");function xe(s,t){A(s.find(".spell")),s.find("[data-action=toggle-pips]").on("click contextmenu",async i=>{i.preventDefault();let e=i.type==="click"?1:-1,n=(t.system.resources.focus?.value??0)+e;await t.update({"system.resources.focus.value":n})}),s.find("[data-action=toggle-prepared]").on("click",i=>{i.preventDefault();let{slotLevel:e,slotId:n,entryId:a,expended:r}=$(i.currentTarget).closest(".spell").data();t.spellcasting.collections.get(a)?.setSlotExpendedState(e??0,n??0,r!==!0)}),s.find("[data-action=cast-spell]").on("click",i=>{i.preventDefault();let{slotLevel:e,slotId:n,entryId:a,itemId:r}=$(i.currentTarget).closest(".spell").data(),o=t.spellcasting.collections.get(a,{strict:!0});if(!o)return;let u=o.get(r,{strict:!0});u&&o.entry.cast(u,{slot:n,level:e})}),s.find("[data-action=spell-description]").on("click",async i=>{i.preventDefault();let e=$(i.currentTarget).closest(".spell"),n=await N(e,t);n&&O(e.find(".name").html().trim(),n)}),s.find("[data-input-path]").on("change",async i=>{let{inputPath:e,entryId:n}=$(i.currentTarget).data(),a=i.currentTarget.valueAsNumber;await t.updateEmbeddedDocuments("Item",[{_id:n,[e]:a}])})}l(xe,"addSpellsListeners");var ie="Compendium.pf2e.other-effects.I9lfZUiCwMiGogVi",it="Compendium.pf2e.feats-srd.jFmdevE4nKevovzo",st={left:["left","right","top","bottom"],right:["right","left","top","bottom"],top:["top","bottom","left","right"],bottom:["bottom","top","left","right"]},nt={G:'<i class="fa-solid fa-face-smile-halo"></i>',N:'<i class="fa-solid fa-face-meh"></i>',E:'<i class="fa-solid fa-face-angry-horns"></i>'},at=["burrow","climb","fly","swim"],ot={actions:{getData:ke,addListeners:Te,getOptions:we},items:{getData:Se,addListeners:De},spells:{getData:Ee,addListeners:xe},skills:{getData:ye,addListeners:ve},extras:{getData:Ce,addListeners:Ie}},U=class extends Application{#e=null;#c=null;#t=null;#i=!1;#s=null;#n;#o=!1;#a=!1;#r=!1;constructor(){super(),this.hoverToken=(t,i)=>{if(this.#o||this.#a||this.#r||game.keyboard.downKeys.has("ControlLeft")||!(t instanceof Token)||!t.actor?.isOfType("character","npc"))return;let e=t.localTransform,n=t.document;if(!(e.tx!==n.x||e.ty!==n.y)&&(this.#i=i,!(i&&this.#e===t&&this.rendered)))if(i){if(this.#e&&delete this.#e.actor.apps[f],this.#e=t,!this.#s)return this.render();clearTimeout(this.#s),this.#s=null,this.render(!0)}else this.close()},this.#n=t=>{if(t.type==="mouseup"){this.#o--;return}this.#o++;let i=t.target,e=this.element[0];if(e){let n=e.querySelector(".popup");if(e.contains(i)){n&&!n.contains(i)&&n.remove();return}if(i.closest(".app")||i.closest(".tooltipster-base"))return;if(n)return n.remove();this.close({force:!0})}else this.#t&&(clearTimeout(this.#t),this.#t=null);this.#a=!1},this.forceClose=()=>this.close({force:!0}),this.deleteToken=t=>{this.#e&&t.id===this.#e.id&&this.close({force:!0})},window.addEventListener("mousedown",this.#n),window.addEventListener("mouseup",this.#n)}delete(){this.close({force:!0}),window.removeEventListener("mousedown",this.#n),window.removeEventListener("mouseup",this.#n)}static get defaultOptions(){return mergeObject(super.defaultOptions,{popOut:!1,minimizable:!1,template:R("hud")})}get token(){return this.#e}get actor(){return this.#e?.actor}get hasCover(){return this.actor?.itemTypes.effect.find(t=>t.flags.core?.sourceId===ie)}get isCharacter(){return this.actor?.isOfType("character")}getData(){let t=this.#e,i=this.#e?.actor;if(!i)return{};let e=null,n=t.isOwner,a=v("distance"),r=this.isCharacter,{attributes:o,saves:u,heroPoints:c,system:p,alignment:d}=i,{traits:m}=p,{hp:k,sp:b={max:0,value:0},resolve:D,ac:L,shield:E,speed:I,dying:G,wounded:_,resistances:q,weaknesses:W,immunities:Pe}=o,V=game.settings.get("pf2e","staminaVariant");if(a==="all"||a==="self"&&n){let g=v("unit").split(","),T=Number(g[0]?.trim())||1,P=g[1]?.trim()||game.system.gridUnits,ae=Number(g[2]?.trim())||0,F=canvas.tokens.controlled,j=!1,M=F.length===1?F[0]:null;if(!M||M===t){let oe=game.user.targets;M=oe.size===1?oe.first():null,j=!0}M&&M!==t&&(e={unit:P,icon:j?'<i class="fa-solid fa-crosshairs-simple"></i>':'<i class="fa-solid fa-expand"></i>',range:(t.distanceTo(M)*T).toFixed(ae)})}if(!n){let g,T=v("status").split(",").map(P=>P.trim()).filter(Boolean);if(T.length){let P=k.max+(V?b.max:0),F=(k.value+(V?b.value:0))/P,j=Math.ceil(F*T.length);g={hue:F*F*122+3,value:j===0?game.i18n.localize("EFFECT.StatusDead"):T.at(j-1)}}return{status:g,distance:e,tokenId:t.id}}let ne=at.map(g=>({label:game.i18n.localize(CONFIG.PF2E.speedTypes[g]),value:I.otherSpeeds.find(T=>T.type===g)?.total??0}));I.details&&ne.push({label:game.i18n.localize("PF2E.DetailsHeading"),value:I.details});function K(g){return`<li>${g.trim()}</li>`}l(K,"toInfo");function Fe(g,T){return g.localeCompare(T)}l(Fe,"sort");let Me=i.system.traits?.languages?.value.map(g=>game.i18n.localize(CONFIG.PF2E.languages[g])).sort(Fe).map(K).join(""),Oe=r?m.senses.map(g=>g.label):m.senses.value.split(",");function J(g,T){return g.length?`<li>${game.i18n.localize(T)}<ul>`+g.map(P=>K(P.label.replace("-"," ").titleCase())).join("")+"</ul></li>":""}return l(J,"toIWR"),{distance:e,isOwner:n,tokenId:t.id,name:t.document.name,hp:k,sp:V?b:{max:0},ac:L.value,hero:c,dying:G,wounded:_,shield:E,resolve:D,alignment:{value:d,icon:nt[d.at(-1)]},level:i.level,isCharacter:r,hasCover:this.hasCover,saves:{fortitude:u.fortitude.mod,reflex:u.reflex.mod,will:u.will.mod},speeds:{land:I.total,others:ne.map(({value:g,label:T})=>`<li>${T}: ${g}</li>`).join("")},iwr:J(Pe,"PF2E.ImmunitiesLabel")+J(W,"PF2E.WeaknessesLabel")+J(q,"PF2E.ResistancesLabel"),senses:Oe.map(K).join(""),languages:Me,hasSpells:i.spellcasting.some(g=>g.category!=="items"),hasItems:i.inventory.size}}#l(){this.#e=null,this.#i=!1,this.#a=!1,this.#r=!1,this.#t!==null&&(clearTimeout(this.#t),this.#t=null);let t=Application.RENDER_STATES;this._state=t.CLOSING;let i=this.element;if(!i)return this._state=t.CLOSED;i.css({minHeight:0});for(let e of this.constructor._getInheritanceChain())Hooks.call(`close${e.name}`,this,i);i.remove(),this._element=null,this._state=t.CLOSED}close(t={}){let i=Application.RENDER_STATES;if(!(!t.force&&!this.#t&&![i.RENDERED,i.ERROR].includes(this._state))){if(t.force)return this.#l(t);this.#s=setTimeout(()=>{this.#s=null,!this.#i&&this.#l(t)})}}async _render(t=!1,i={}){let e,n;if(this.#c===this.#e){let a=this.element.find(".sidebar")[0];a&&(e=a.dataset.type,n=a.scrollTop)}if(await super._render(t,i),e){let a=await this.#u(e);n>0&&(a.scrollTop=n)}this.#c=this.#e}render(t){if(!this.#e?.actor||this.#o)return;if(t)return super.render(!0);let i=v("delay");i?this.#t=setTimeout(()=>super.render(!0),i):super.render(!0)}_injectHTML(t){$("body").append(t),this._element=t}setPosition(){let t=this.#e;if(!t)return;let i=this.element[0],e=t.worldTransform.a,n=i.getBoundingClientRect(),a=canvas.clientCoordinatesFromCanvas(t.document._source),r={x:a.x,y:a.y,width:t.hitArea.width*e,height:t.hitArea.height*e,get right(){return this.x+this.width},get bottom(){return this.y+this.height}},o,u=t.isOwner?st[v("position")].slice():["top","bottom"];for(;u.length&&!o;){let c=u.shift();c==="left"?(o={x:r.x-n.width,y:se(n,r)},o.x<0&&(o=void 0)):c==="right"?(o={x:r.right,y:se(n,r)},o.x+n.width>window.innerWidth&&(o=void 0)):c==="top"?(o={x:Le(n,r),y:r.y-n.height},o.y<0&&(o=void 0)):c==="bottom"&&(o={x:Le(n,r),y:r.bottom},o.y+n.height>window.innerHeight&&(o=void 0))}return o&&(i.style.left=`${o.x}px`,i.style.top=`${o.y}px`),o}activateListeners(t){let e=this.#e?.actor;e&&(e.apps[f]=this,t.on("mouseenter",()=>{this.#i=!0,this.#r=!0}),t.on("mouseleave",()=>{this.#r=!1,!this.#a&&(this.#i=!1,this.close())}),t.on("dragover",()=>{t.css("opacity",.1),t.css("pointerEvents","none"),window.addEventListener("dragend",()=>{t.css("opacity",1),t.css("pointerEvents","")},{once:!0})}),t.find("input").on("change",async n=>{let a=n.currentTarget,r=a.valueAsNumber,o=a.name;a.blur(),o!=="shield.value"?await e.update({[o]:r}):await e.heldShield.update({"system.hp.value":r})}),t.find("[data-action=toggle-hero]").on("click contextmenu",n=>{n.preventDefault();let{max:a,value:r}=e.heroPoints,o=n.type==="click"?1:-1,u=Math.clamped(r+o,0,a);u!==r&&e.update({"system.resources.heroPoints.value":u})}),t.find("[data-action=raise-shield]").on("click",n=>{n.preventDefault(),game.pf2e.actions.raiseAShield({actors:[e]})}),t.find("[data-action=take-cover]").on("click",async n=>{n.preventDefault();let a=(await fromUuid(ie)).toObject();setProperty(a,"flags.core.sourceId",ie);let r=this.hasCover;this.hasCover?await r.delete():await e.createEmbeddedDocuments("Item",[a])}),t.find("[data-action=roll-save]").on("click",n=>{n.preventDefault();let a=n.currentTarget.dataset.save;e.saves[a].roll({event:n})}),t.find("[data-action=recovery-check]").on("click",n=>{n.preventDefault(),e.rollRecovery(n)}),t.find("[data-action=toggle-dying], [data-action=toggle-wounded]").on("click contextmenu",n=>{n.preventDefault();let a=n.currentTarget.dataset.action==="toggle-dying"?"dying":"wounded",r=e.system.attributes[a]?.max;r&&(n.type==="click"?e.increaseCondition(a,{max:r}):e.decreaseCondition(a))}),t.find("[data-action=use-resolve]").on("click",n=>{n.preventDefault(),rt(e)}),t.find("[data-action=show-info]").on("mouseleave",n=>{$(n.currentTarget).tooltipster("hide")}).tooltipster({delay:[500,0],position:["top","bottom","left","right"],theme:"crb-hover",arrow:!1,animationDuration:0,contentAsHTML:!0,trigger:v("info-click")?"click":"hover"}),t.find(".inner .footer [data-type]").on("click",this.#u.bind(this)))}async#u(t){t=typeof t=="string"?t:t.currentTarget.dataset.type;let i=this.element,e=i.find(".sidebar"),n=e[0]?.dataset.type;if(e.remove(),i.find(".inner .footer [data-type]").removeClass("active"),n===t)return;let a=this.actor,{getData:r,addListeners:o,getOptions:u}=ot[t],c=await r(a),{classList:p=[]}=u&&await u(a)||{};if(!c)return ui.notifications.warn(h(`${t}.empty`,{name:this.#e.name}));c.isGM=game.user.isGM,c.isCharacter=this.isCharacter,this.#a=!0,i.find(`.inner .footer [data-type=${t}]`).addClass("active"),i=i[0];let d=document.createElement("div");d.innerHTML=await renderTemplate(R(t),c),e=d.firstElementChild,e.classList.add("sidebar",...p),v("scrollbar")||e.classList.add("no-scrollbar"),c.doubled&&e.classList.add("doubled"),e.dataset.type=t,e.style.setProperty("--max-height",v("height").trim()||"100%"),this.element.append(e);let m=e.getBoundingClientRect(),k=i.getBoundingClientRect(),b=k.x-m.width;b<0&&(b=k.right);let D=parseInt(window.getComputedStyle(i).padding),L=se(m,k,D);return e.style.left=`${b}px`,e.style.top=`${L}px`,o($(e),a),e}};l(U,"HUD");function se(s,t,i=0){let e=t.y+t.height/2-s.height/2;return e+s.height>window.innerHeight&&(e=window.innerHeight-s.height-i),e<0&&(e=i),e}l(se,"postionFromTargetY");function Le(s,t){let i=t.x+t.width/2-s.width/2;return i+s.width>window.innerWidth&&(y=window.innerWidth-s.width),i<0&&(i=0),i}l(Le,"postionFromTargetX");function rt(s){function t(p){ChatMessage.create({user:game.user.id,content:p,speaker:ChatMessage.getSpeaker({actor:s})})}l(t,"toChat");let{name:i,attributes:e}=s,{sp:n,resolve:a}=e,r=h("hud.resolve.full",{name:i}),o=game.i18n.format("PF2E.Actions.SteelYourResolve.NoStamina",{name:i});if(n.value===n.max)return ui.notifications.warn(r);if(a.value<1)return ui.notifications.warn(o);let u=s.itemTypes.feat.find(p=>p.sourceId===it),c='<p><input type="radio" name="pick" value="breather" style="margin-right: 6px;';u||(c+=" display: none;"),c+='" checked><span>',u&&(c+=`<strong>${h("hud.resolve.breather.label")}:</strong> `),c+=`${h("hud.resolve.breather.msg")}</span></p>`,u&&(c+='<p><input type="radio" name="pick" value="steel" style="margin-right: 6px;">',c+=`<span><strong>${game.i18n.localize("PF2E.Actions.SteelYourResolve.Title")}:</strong> `,c+=`${h("hud.resolve.steel.msg")}</span></p>`),new Dialog({title:h("hud.resolve.title"),content:c,buttons:{yes:{icon:"<i class='fas fa-check'></i>",label:h("hud.resolve.yes"),callback:async p=>{let{attributes:d}=s,{sp:m,resolve:k}=d;if(m.value===m.max)return t(r);if(k.value<1)return t(o);let b=p.find("input:checked").val(),D=`${m.value}/${m.max}`;if(b==="breather")t(h("hud.resolve.breather.used",{name:i,ratio:D})),await s.update({"system.attributes.sp.value":m.max,"system.attributes.resolve.value":k.value-1});else{t(game.i18n.format("PF2E.Actions.SteelYourResolve.RecoverStamina",{name:i,ratio:D}));let L=m.value+Math.floor(m.max/2);await s.update({"system.attributes.sp.value":Math.min(L,m.max),"system.attributes.resolve.value":k.value-1})}}},no:{icon:"<i class='fas fa-times'></i>",label:h("hud.resolve.no")}}}).render(!0)}l(rt,"useResolve");var S=null;Hooks.once("setup",()=>{let s=["first","second","third","fourth"].map(t=>h(`settings.status.statuses.${t}`)).join(", ");w("status",String,s,{scope:"world"}),w("enabled",Boolean,!0,{onChange:Ae}),w("position",String,"right",{choices:{left:C("position","choices.left"),right:C("position","choices.right"),top:C("position","choices.top"),bottom:C("position","choices.bottom")}}),w("delay",Number,250,{range:{min:0,max:2e3,step:50}}),w("info-click",Boolean,!0),w("distance",String,"all",{choices:{none:C("distance","choices.none"),self:C("distance","choices.self"),all:C("distance","choices.all")}}),w("unit",String,""),w("height",String,""),w("scrollbar",Boolean,!0),w("spells-columns",Boolean,!1),w("skills-columns",Boolean,!1),w("actions",String,"split",{choices:{name:C("actions","choices.name"),type:C("actions","choices.type"),split:C("actions","choices.split")}}),w("actions-colors",Boolean,!0),w("spells",Boolean,!1),w("tradition",Boolean,!1),w("untrained",Boolean,!0)});Hooks.once("ready",()=>{v("enabled")&&Ae(!0)});Hooks.on("renderSettingsConfig",(s,t)=>{let i=t.find(`.tab[data-tab=${f}]`);function e(n,a,r="h3"){let o=h(`menu.${a}`);i.find(`[name="${f}.${n}"]`).closest(".form-group").before(`<${r}>${o}</${r}>`)}l(e,"beforeGroup"),game.user.isGM&&e("enabled","client.header","h2"),e("distance","client.distance"),e("height","client.sidebar"),e("actions","client.actions"),e("spells","client.spells"),e("untrained","client.skills")});function C(s,t){return`${f}.settings.${s}.${t}`}l(C,"settingPath");function w(s,t,i,e={}){game.settings.register(f,s,{name:C(s,"name"),hint:C(s,"hint"),scope:"client",config:!0,type:t,default:i,...e})}l(w,"registerSetting");function Ae(s){s&&!S?(S=new U,Hooks.on("hoverToken",S.hoverToken),Hooks.on("deleteToken",S.deleteToken),Hooks.on("canvasPan",S.forceClose)):!s&&S&&(Hooks.off("hoverToken",S.hoverToken),Hooks.off("deleteToken",S.deleteToken),Hooks.off("canvasPan",S.forceClose),S.delete(),S=null)}l(Ae,"enableModule");})();
//# sourceMappingURL=main.js.map
