(()=>{var Ht=Object.defineProperty;var u=(t,e)=>Ht(t,"name",{value:e,configurable:!0});var Ut=new Map([["incredibly-easy",-10],["very-easy",-5],["easy",-2],["normal",0],["hard",2],["very-hard",5],["incredibly-hard",10]]),_t=new Map([[-1,13],[0,14],[1,15],[2,16],[3,18],[4,19],[5,20],[6,22],[7,23],[8,24],[9,26],[10,27],[11,28],[12,30],[13,31],[14,32],[15,34],[16,35],[17,36],[18,38],[19,39],[20,40],[21,42],[22,44],[23,46],[24,48],[25,50]]);function Bt(t,e="normal"){return t+(Ut.get(e)??0)}u(Bt,"adjustDC");function zt(t="common"){switch(t){case"uncommon":return"hard";case"rare":return"very-hard";case"unique":return"incredibly-hard";default:return"normal"}}u(zt,"rarityToDCAdjustment");function oe(t,e="common"){return Bt(t,zt(e))}u(oe,"adjustDCByRarity");function re(t,{proficiencyWithoutLevel:e,rarity:s="common"}={}){let i=game.settings.get("pf2e","proficiencyVariant");e??=i==="ProficiencyWithoutLevel";let a=_t.get(t)??14;return oe(e?a-Math.max(t,0):a,s)}u(re,"calculateDC");function K(t,e){return t instanceof Element||t instanceof Document?Array.from(t.querySelectorAll(e)):[]}u(K,"htmlQueryAll");function Ue(t,e){return t instanceof Element?t.closest(e):null}u(Ue,"htmlClosest");var _e={0:"systems/pf2e/icons/actions/FreeAction.webp",free:"systems/pf2e/icons/actions/FreeAction.webp",1:"systems/pf2e/icons/actions/OneAction.webp",2:"systems/pf2e/icons/actions/TwoActions.webp",3:"systems/pf2e/icons/actions/ThreeActions.webp","1 or 2":"systems/pf2e/icons/actions/OneTwoActions.webp","1 to 3":"systems/pf2e/icons/actions/OneThreeActions.webp","2 or 3":"systems/pf2e/icons/actions/TwoThreeActions.webp",reaction:"systems/pf2e/icons/actions/Reaction.webp",passive:"systems/pf2e/icons/actions/Passive.webp"};function Be(t,e="systems/pf2e/icons/actions/Empty.webp"){if(t===null)return _e.passive;let s=typeof t!="object"?t:t.type==="action"?t.value:t.type,i=String(s??"").toLowerCase().trim();return _e[i]??e}u(Be,"getActionIcon");function jt(t){return Error(`PF2e System | ${t}`)}u(jt,"ErrorPF2e");var ce=String.raw`[\p{Alphabetic}\p{Mark}\p{Decimal_Number}\p{Join_Control}]`,Te=String.raw`[^\p{Alphabetic}\p{Mark}\p{Decimal_Number}\p{Join_Control}]`,Gt=new RegExp(Te,"gu"),Kt=String.raw`(?:${ce})(?=${Te})|(?:${Te})(?=${ce})`,Wt=String.raw`(?:${ce})(?=${ce})`,ze=String.raw`\p{Lowercase_Letter}`,je=String.raw`\p{Uppercase_Letter}`,qt=new RegExp(`(${ze})(${je}${Wt})`,"gu"),Vt=/[^-\p{White_Space}\p{Alphabetic}\p{Mark}\p{Decimal_Number}\p{Join_Control}]/gu,Jt=new RegExp(`${je}|(?:${Kt})${ze}`,"gu");function Ee(t,{camel:e=null}={}){if(typeof t!="string")return console.warn("Non-string argument passed to `sluggify`"),"";if(t==="-")return t;switch(e){case null:return t.replace(qt,"$1-$2").toLowerCase().replace(/['â€™]/g,"").replace(Gt," ").trim().replace(/[-\s]+/g,"-");case"bactrian":{let s=Ee(t,{camel:"dromedary"});return s.charAt(0).toUpperCase()+s.slice(1)}case"dromedary":return t.replace(Vt,"").replace(/[-_]+/g," ").replace(Jt,(s,i)=>i===0?s.toLowerCase():s.toUpperCase()).replace(/\s+/g,"");default:throw jt("I don't think that's a real camel.")}}u(Ee,"sluggify");function Ge(t,e=!0){let s=canvas.tokens.controlled.flatMap(i=>i.actor?i.actor:[]).filter(i=>i.isOwner).filter(i=>!t||i.isOfType(...t));return s.length===0&&game.user.character&&e&&s.push(game.user.character),s}u(Ge,"getSelectedOrOwnActors");function Yt(t){return!!t&&"ctrlKey"in t&&"metaKey"in t&&"shiftKey"in t}u(Yt,"isRelevantEvent");function Ke(t){let e=!game.user.settings.showRollDialogs;if(!Yt(t))return{skipDialog:e};let s={skipDialog:t.shiftKey?!e:e};return(t.ctrlKey||t.metaKey)&&(s.rollMode=game.user.isGM?"gmroll":"blindroll"),s}u(Ke,"eventToRollParams");var qe=["action","check","effect-area"].map(t=>`[data-pf2-${t}]`).join(",");function Qt(t,e){for(let s of t){(!e||e.isOwner)&&s.classList.add("with-repost");let i=K(s,"i[data-pf2-repost]");if(i.length>0){if(e&&!e.isOwner){for(let o of i)o.remove();s.classList.remove("with-repost")}continue}if(e&&!e.isOwner)continue;let a=document.createElement("i"),n=s.parentElement?.dataset?.pf2Checkgroup!==void 0?"fa-comment-alt-dots":"fa-comment-alt";a.classList.add("fas",n),a.setAttribute("data-pf2-repost",""),a.setAttribute("title",game.i18n.localize("PF2E.Repost")),s.appendChild(a)}}u(Qt,"injectRepostElement");function Xt(t,e=null){for(let s of K(t,"a.inline-roll[data-damage-roll]")){let i=Ue(s,"[data-item-id]")?.dataset.itemId,a=e?.items.get(i??"");a&&(s.dataset.flavor||=a.name)}}u(Xt,"flavorDamageRolls");function We(t,e){let s=t.attributes.getNamedItem("data-pf2-repost-flavor")?.value??"";return`<span data-visibility="${t.attributes.getNamedItem("data-pf2-show-dc")?.value??e}">${s}</span> ${t.outerHTML}`.trim()}u(We,"makeRepostHtml");function Zt(t,e=null){if(!["pf2Action","pf2Check","pf2EffectArea"].some(r=>r in t.dataset))return;let s=e?.hasPlayerOwner?"all":"gm",i=(()=>t.parentElement?.dataset?.pf2Checkgroup!==void 0?`<div data-pf2-checkgroup>${K(t.parentElement,qe).map(l=>We(l,s)).join("<br>")}</div>`:We(t,s))(),a=CONFIG.ChatMessage.documentClass,n=e instanceof Actor?a.getSpeaker({actor:e,token:e.token??e.getActiveTokens(!1,!0).shift()}):a.getSpeaker(),o=e instanceof JournalEntry?{pf2e:{journalEntry:e.uuid}}:{};a.create({speaker:n,content:i,flags:o})}u(Zt,"repostAction");function le(t,e){let s=t instanceof HTMLElement?t:t[0],i=K(s,qe).filter(o=>o.nodeName==="SPAN");Qt(i,e),Xt(s,e instanceof Actor?e:null);let a=u(o=>{if(e instanceof ChatMessage)return e.actor??e.journalEntry??null;if(e instanceof Actor||e instanceof JournalEntry||e instanceof JournalEntryPage)return e;let r=ui.windows[Number(o.closest(".app.sheet")?.dataset.appid)];return r.document instanceof Actor||r.document instanceof JournalEntry?r.document:null},"documentFromDOM");K(s,"i[data-pf2-repost]").forEach(o=>o.addEventListener("click",r=>{let l=r.target;if(!(l instanceof HTMLElement))return;let c=l?.parentElement,d=a(l);c&&Zt(c,d),r.stopPropagation()}));let n=$(i);n.filter("[data-pf2-action]").on("click",o=>{let r=$(o.currentTarget),{pf2Action:l,pf2Glyph:c,pf2Variant:d,pf2Dc:f,pf2ShowDc:p,pf2Skill:h}=r[0]?.dataset??{},w=game.pf2e.actions[l?Ee(l,{camel:"dromedary"}):""],b=p??"all";l&&w?w({event:o,glyph:c,variant:d,difficultyClass:f?{scope:"check",value:Number(f)||0,visibility:b}:void 0,skill:h}):console.warn(`PF2e System | Skip executing unknown action '${l}'`)}),n.filter("[data-pf2-check]").on("click",o=>{let{pf2Check:r,pf2Dc:l,pf2Traits:c,pf2Label:d,pf2Adjustment:f}=o.currentTarget.dataset,p=Ge();if(p.length===0){ui.notifications.error(game.i18n.localize("PF2E.UI.errorTargetToken"));return}let h=c?.split(",").map(b=>b.trim()).filter(b=>!!b),w=Ke(o);switch(r){default:for(let b of p){let S=b.getStatistic(r??"");if(S){let D=(()=>{let O=Number(f)||0;return l==="@self.level"?re(b.level)+O:Number(l)+O})(),A=Number.isInteger(D)?{label:d,value:D}:null,R=a(o.currentTarget);S.check.roll({...w,extraRollOptions:h,origin:R instanceof Actor?R:null,dc:A})}else console.warn(`PF2e System | Skip rolling unknown statistic ${r}`)}}}),n.filter("[data-pf2-effect-area]").on("click",async o=>{let{pf2EffectArea:r,pf2Distance:l,pf2TemplateData:c,pf2Traits:d,pf2Width:f}=o.currentTarget.dataset,p={burst:"circle",emanation:"circle",line:"ray",cone:"cone",rect:"rect"};if(typeof r=="string"){let h=JSON.parse(c??"{}");h.distance||=Number(l),h.fillColor||=game.user.color,h.t=p[r],h.t==="ray"?h.width=Number(f)||CONFIG.MeasuredTemplate.defaults.width*(canvas.dimensions?.distance??1):h.t==="cone"&&(h.angle=CONFIG.MeasuredTemplate.defaults.angle),d&&(h.flags={pf2e:{origin:{traits:d.split(",")}}});let w=new CONFIG.MeasuredTemplate.documentClass(h,{parent:canvas.scene});await new CONFIG.MeasuredTemplate.documentClass(w).drawPreview()}else console.warn("PF2e System | Could not create template'")})}u(le,"listenInlineRoll");var ue=["U","T","E","M","L"];async function Ve(t,e){let s=t.data(),i=s.itemId?e.items.get(s.itemId):await fromUuid(s.uuid),a=await i?.getChatData({secrets:e.isOwner},s);if(!a)return;let n=document.createElement("div");return n.classList.add("description"),await e.sheet.itemRenderer.renderItemSummary(n,i,a),le(n,e),n}u(Ve,"getItemSummary");function _(t){t.on("mouseenter",e=>{e.preventDefault();let s=e.currentTarget.querySelector(".name"),{width:i}=s.getBoundingClientRect();if(s.scrollWidth<=Math.ceil(i))return;let a=s.innerHTML.trim();game.tooltip.activate(e.currentTarget,{text:a})}),t.on("mouseleave",e=>{e.preventDefault(),game.tooltip.deactivate()}),t.on("mousedown",e=>{game.tooltip.deactivate()})}u(_,"addNameTooltipListeners");function Je(t,e){t.preventDefault(),F(t,e)?.sheet.render(!0,{focus:!0})}u(Je,"editItem");async function Ye(t,e){t.preventDefault();let s=F(t,e);if(s){if(t.ctrlKey)return s.delete();new Dialog({title:C("deleteItem.title"),content:await renderTemplate("systems/pf2e/templates/actors/delete-item-dialog.hbs",{name:s.name}),buttons:{ok:{icon:'<i class="fa-solid fa-trash"></i>',label:C("deleteItem.ok"),callback:()=>s.delete()},cancel:{icon:'<i class="fas fa-times"></i>',label:C("deleteItem.cancel")}}}).render(!0)}}u(Ye,"deleteItem");function F(t,e){let{itemId:s}=t.currentTarget.closest("[data-item-id]").dataset;return e.items.get(s)}u(F,"getItemFromEvent");function de(t){return t.isOwner&&W(t,`macros.${game.user.id}`)?.map(e=>{let s=fromUuidSync(e);return s?{img:s.img,name:s.name,uuid:e}:null}).filter(Boolean)}u(de,"getMacros");function pe(t,e){let{type:s,uuid:i}=TextEditor.getDragEventData(t.originalEvent)??{};if(s!=="Macro"||!fromUuidSync(i))return;let a=`macros.${game.user.id}`,n=W(e,a)?.slice()??[];n.includes(i)||(n.push(i),X(e,a,n))}u(pe,"onDroppedMacro");function fe(t,e){let s=`macros.${game.user.id}`,i=W(e,s)?.slice();if(!i?.length)return;let{uuid:a}=t.currentTarget.closest(".macro").dataset,n=i.indexOf(a);n!==-1&&(i.splice(n,1),X(e,s,i))}u(fe,"deleteMacro");function me(t=()=>!0){let e=game.user.targets,s=e.size===1?e.first():null;return s&&t(s)?s:null}u(me,"getUniqueTarget");async function Qe({weapon:t,trait:e,selection:s}){if(t.system.traits.toggles[e].selection===s)return!1;let a=t.actor?.items.get(t.id);return a?.isOfType("weapon")&&a===t?await a.update({[`system.traits.toggles.${e}.selection`]:s}):a?.isOfType("weapon")&&t.altUsageType==="melee"?await a.update({[`system.meleeUsage.traitToggles.${e}`]:s}):await a?.rules.find(o=>o.key==="Strike"&&!o.ignored&&o.slug===t.slug)?.toggleTrait({trait:e,selection:s}),!0}u(Qe,"toggleWeaponTrait");async function Z(t,e,s){let i=$(`#${T}`);if(!i.length)return;i.find("> .popup").remove();let a=document.createElement("div");a.innerHTML=`<div class="popup">
    <div class="header">
        <div class="title">${t}</div>
        <a class="observable" data-action="close-popup"><i class="fas fa-times"></i> ${C("popup.close")}</a>
    </div>
</div>`;let n=a.firstElementChild;typeof e=="string"?(e=await q(e,s),n.insertAdjacentHTML("beforeend",e)):n.append(e),n.querySelector("[data-action=close-popup]").addEventListener("click",()=>n.remove()),i.append(n)}u(Z,"popup");async function P(t,e,s){s??=t.find(".name").html();let i=await Ve(t,e);i&&Z(s.trim(),i,e)}u(P,"showItemSummary");async function ge(t,e,s,{rollMode:i=void 0,create:a=!0,data:n={}}){let o=`systems/pf2e/templates/chat/${e.type}-card.hbs`,r=s.token,l=t?.currentTarget.closest(".item")??{},c=CONFIG.ChatMessage.documentClass,d=Object.keys(n).length>0?n:l.dataset||{},f={actor:s,tokenId:r?`${r.parent?.id}.${r.id}`:null,item:e,data:await e.getChatData(void 0,d)},p={speaker:c.getSpeaker({actor:s,token:s.getActiveTokens(!1,!0)[0]??null}),flags:{core:{canPopout:!0},pf2e:{origin:{uuid:e.uuid,type:e.type}}},type:CONST.CHAT_MESSAGE_TYPES.OTHER};return i??=t?.ctrlKey||t?.metaKey?"blindroll":game.settings.get("core","rollMode"),["gmroll","blindroll"].includes(i)&&(p.whisper=c.getWhisperRecipients("GM").map(h=>h.id)),i==="blindroll"&&(p.blind=!0),p.content=await renderTemplate(o,f),a?c.create(p,{renderSheet:!1}):new c(p)}u(ge,"unownedItemToMessage");var B="pf2e-token-hud",es=new Set(["Compendium.pf2e.equipment-srd.44F1mfJei4GY8f2X","Compendium.pf2e.equipment-srd.4kz3vhkKPUuXBpxk"]),Xe="Compendium.pf2e.feats-srd.0GF2j54roPFIDmXf",ts="Compendium.pf2e.feats-srd.WC4xLBGmBsdOdHWu",ss={initiative:"PF2E.InitiativeLabel","recall-knowledge":"PF2E.RecallKnowledge.Label","cover-tracks":"PF2E.TravelSpeed.ExplorationActivities.CoverTracks",earnIncome:`${B}.skills.actions.earnIncome`,treatWounds:`${B}.skills.actions.treatWounds`,"borrow-arcane-spell":`${B}.skills.actions.borrow-arcane-spell`,"identify-magic":`${B}.skills.actions.identify-magic`,"identify-alchemy":`${B}.skills.actions.identify-alchemy`,"learn-spell":`${B}.skills.actions.learn-spell`,"crafting-goods":`${B}.skills.actions.crafting-goods`,"staging-performance":`${B}.skills.actions.staging-performance`},Ze={"sense-motive":"Compendium.pf2e.actionspf2e.1xRFPTFtWtGJ9ELw",seek:"Compendium.pf2e.actionspf2e.BlAOM2X92SI6HMtJ",balance:"Compendium.pf2e.actionspf2e.M76ycLAqHoAgbcej",escape:"Compendium.pf2e.actionspf2e.SkZAQRkLLkmBQNB9","tumble-through":"Compendium.pf2e.actionspf2e.21WIfSu7Xd7uKqV8","maneuver-in-flight":"Compendium.pf2e.actionspf2e.Qf1ylAbdVi1rkc8M",squeeze:"Compendium.pf2e.actionspf2e.kMcV8e5EZUxa6evt","recall-knowledge":"Compendium.pf2e.actionspf2e.1OagaWtBpVXExToo","borrow-arcane-spell":"Compendium.pf2e.actionspf2e.OizxuPb44g3eHPFh","decipher-writing":"Compendium.pf2e.actionspf2e.d9gbpiQjChYDYA2L","identify-magic":"Compendium.pf2e.actionspf2e.eReSHVEPCsdkSL4G","learn-spell":"Compendium.pf2e.actionspf2e.Q5iIYCFdqJFM31GW",climb:"Compendium.pf2e.actionspf2e.pprgrYQ1QnIDGZiy",forceOpen:"Compendium.pf2e.actionspf2e.SjmKHgI7a5Z9JzBx",grapple:"Compendium.pf2e.actionspf2e.PMbdMWc2QroouFGD",highJump:"Compendium.pf2e.actionspf2e.2HJ4yuEFY1Cast4h",longJump:"Compendium.pf2e.actionspf2e.JUvAvruz7yRQXfz2",shove:"Compendium.pf2e.actionspf2e.7blmbDrQFNfdT731",swim:"Compendium.pf2e.actionspf2e.c8TGiZ48ygoSPofx",trip:"Compendium.pf2e.actionspf2e.ge56Lu1xXVFYUnLP",disarm:"Compendium.pf2e.actionspf2e.Dt6B1slsBy8ipJu9",repair:"Compendium.pf2e.actionspf2e.bT3skovyLUtP22ME",craft:"Compendium.pf2e.actionspf2e.rmwa3OyhTZ2i2AHl","crafting-goods":"",earnIncome:"Compendium.pf2e.actionspf2e.QyzlsLrqM0EEwd7j","identify-alchemy":"Compendium.pf2e.actionspf2e.Q4kdWVOf2ztIBFg1",createADiversion:"Compendium.pf2e.actionspf2e.GkmbTGfg8KcgynOA",impersonate:"Compendium.pf2e.actionspf2e.AJstokjdG6iDjVjE",lie:"Compendium.pf2e.actionspf2e.ewwCglB7XOPLUz72",feint:"Compendium.pf2e.actionspf2e.QNAVeNKtHA0EUw4X",bonMot:Xe,gatherInformation:"Compendium.pf2e.actionspf2e.plBGdZhqq5JBl1D8",makeAnImpression:"Compendium.pf2e.actionspf2e.OX4fy22hQgUHDr0q",request:"Compendium.pf2e.actionspf2e.DCb62iCBrJXy0Ik6",coerce:"Compendium.pf2e.actionspf2e.tHCqgwjtQtzNqVvd",demoralize:"Compendium.pf2e.actionspf2e.2u915NdUyQan6uKF","administer-first-aid":"Compendium.pf2e.actionspf2e.MHLuKy4nQO2Z4Am1","treat-disease":"Compendium.pf2e.actionspf2e.TC7OcDa7JlWbqMaN","treat-poison":"Compendium.pf2e.actionspf2e.KjoCEEmPGTeFE4hh",treatWounds:"Compendium.pf2e.actionspf2e.1kGNdIIhuglAjIp9","command-an-animal":"Compendium.pf2e.actionspf2e.q9nbyIF0PEBqMtYe",perform:"Compendium.pf2e.actionspf2e.EEDElIyin4z60PXx","staging-performance":"",subsist:"Compendium.pf2e.actionspf2e.49y9Ec4bDii8pcD3","create-forgery":"Compendium.pf2e.actionspf2e.ftG89SjTSa9DYDOD","conceal-an-object":"Compendium.pf2e.actionspf2e.qVNVSmsgpKFGk9hV",hide:"Compendium.pf2e.actionspf2e.XMcnh4cSI32tljXa",sneak:"Compendium.pf2e.actionspf2e.VMozDqMMuK5kpoX4",senseDirection:"Compendium.pf2e.actionspf2e.fJImDBQfqfjKJOhk","cover-tracks":"Compendium.pf2e.actionspf2e.SB7cMECVtE06kByk",track:"Compendium.pf2e.actionspf2e.EA5vuSgJfiHH7plD","palm-an-object":"Compendium.pf2e.actionspf2e.ijZ0DDFpMkWqaShd",steal:"Compendium.pf2e.actionspf2e.RDXXE7wMrSPCLv5k","disable-device":"Compendium.pf2e.actionspf2e.cYdz2grcOcRt4jk6","pick-a-lock":"Compendium.pf2e.actionspf2e.2EE4aF4SZpYf0R6H"},is={escape:{slug:"escape",cost:"1",type:2,noSkill:!0},"recall-knowledge":{slug:"recall-knowledge",cost:"1",secret:!0},"decipher-writing":{slug:"decipher-writing",type:2,trained:!0},"identify-magic":{slug:"identify-magic",trained:!0},"learn-spell":{slug:"learn-spell",trained:!0}},ee=[{slug:"perception",actions:[{slug:"sense-motive",cost:"1",type:2},{slug:"seek",cost:"1",type:2}]},{slug:"acrobatics",actions:[{slug:"balance",cost:"1",type:2},{slug:"tumble-through",cost:"1",type:2},{slug:"maneuver-in-flight",cost:"1",type:2,trained:!0},{slug:"squeeze",type:2,trained:!0}]},{slug:"arcana",actions:[{slug:"borrow-arcane-spell",trained:!0},"decipher-writing","identify-magic","learn-spell"]},{slug:"athletics",actions:[{slug:"climb",cost:"1",type:1},{slug:"forceOpen",cost:"1",type:1,map:!0,modifiers:[{condition:t=>!t.itemTypes.equipment.some(e=>e.isHeld&&es.has(e.sourceId)),modifiers:[{slug:"crowbar-missing",modifier:-2,type:"circumstance"}]}]},{slug:"grapple",cost:"1",type:1,map:!0},{slug:"highJump",cost:"1",type:1},{slug:"longJump",cost:"1",type:1},{slug:"shove",cost:"1",type:1,map:!0},{slug:"swim",cost:"1",type:1},{slug:"trip",cost:"1",type:2,map:!0},{slug:"disarm",cost:"1",type:1,map:!0,trained:!0}]},{slug:"crafting",actions:[{slug:"repair",type:1},{slug:"craft",type:1,trained:!0},{slug:"crafting-goods",trained:!0},{slug:"earnIncome",type:3,trained:!0},{slug:"identify-alchemy",trained:!0}]},{slug:"deception",actions:[{slug:"createADiversion",cost:"1",type:1,variants:["distracting-words","gesture","trick"]},{slug:"impersonate",type:1},{slug:"lie",type:1},{slug:"feint",cost:"1",type:1,trained:!0}]},{slug:"diplomacy",actions:[{slug:"bonMot",cost:"1",type:1,condition:t=>Ie(t,Xe)},{slug:"gatherInformation",type:1},{slug:"makeAnImpression",type:1},{slug:"request",cost:"1",type:1}]},{slug:"intimidation",actions:[{slug:"coerce",type:2},{slug:"demoralize",cost:"1",type:2}]},{slug:"medicine",actions:[{slug:"administer-first-aid",cost:"2",type:2,variants:["stabilize","stop-bleeding"]},{slug:"treat-disease",type:2,trained:!0},{slug:"treat-poison",cost:"1",type:2,trained:!0},{slug:"treatWounds",type:1,trained:!0}]},{slug:"nature",actions:[{slug:"command-an-animal",cost:"1",type:2},"identify-magic","learn-spell",{slug:"treatWounds",type:1,trained:!0,condition:t=>Ie(t,ts)}]},{slug:"occultism",actions:["decipher-writing","identify-magic","learn-spell"]},{slug:"performance",actions:[{slug:"perform",cost:"1",type:1,variants:["acting","comedy","dance","keyboards","oratory","percussion","singing","strings","winds"]},{slug:"staging-performance",trained:!0}]},{slug:"religion",actions:["decipher-writing","identify-magic","learn-spell"]},{slug:"society",actions:[{slug:"subsist",type:2},{slug:"create-forgery",type:2,trained:!0},"decipher-writing"]},{slug:"stealth",actions:[{slug:"conceal-an-object",cost:"1",type:2},{slug:"hide",cost:"1",type:2},{slug:"sneak",cost:"1",type:2}]},{slug:"survival",actions:[{slug:"senseDirection",type:1},{slug:"subsist",type:2},{slug:"cover-tracks",trained:!0},{slug:"track",type:1,trained:!0}]},{slug:"thievery",actions:[{slug:"palm-an-object",cost:"1",type:2},{slug:"steal",cost:"1",type:2},{slug:"disable-device",cost:"2",type:2,trained:!0},{slug:"pick-a-lock",cost:"2",type:2,trained:!0}]}];ee.forEach(t=>{t.actions=t.actions.map(i=>typeof i=="string"?is[i]:i);let{slug:e,actions:s}=t;for(let i of s){let a=i.slug.replace(/-(.)/g,(n,o)=>o.toUpperCase()).capitalize();i.skillSlug=e,i.uuid=Ze[i.slug],i.label=ss[i.slug]??`PF2E.Actions.${a}.Title`,i.variants?i.variants=i.variants.map(n=>({slug:n,label:`${B}.skills.actions.${n}`})):i.map&&(i.variants=[{label:"PF2E.Roll.Normal"},{label:"PF2E.MAPAbbreviationLabel",map:-5},{label:"PF2E.MAPAbbreviationLabel",map:-10}]),i.modifiers?.forEach(({modifiers:n})=>{n.forEach(o=>{o.label=`${B}.skills.modifiers.${o.slug}`})})}});var De=ee.map(t=>t.slug),ns=ee.reduce((t,{slug:e,actions:s})=>(t[e]={slug:e,actions:s.reduce((i,a)=>(i[a.slug]=a,i),{})},t),{}),et=new Set(Object.values(Ze).filter(Boolean));function Le(t){return game.i18n.localize(t==="perception"?"PF2E.PerceptionLabel":CONFIG.PF2E.skillList[t])}u(Le,"getSkillLabel");async function tt(t){let e=[],s=!m("untrained"),i=!t.isOfType("character");for(let n=0;n<ee.length;n++){let{slug:o,actions:r}=ee[n],{label:l,rank:c,mod:d}=V(o,t);e[n]={slug:o,label:l,rank:c,modifier:z(d),actions:r.filter(f=>(s||i||!f.trained||t.skills[o].rank>=1)&&(!f.condition||f.condition(t)))}}let a=Object.values(t.skills).filter(n=>n.lore).map(({label:n,rank:o,mod:r,slug:l})=>({slug:l,label:n,rank:o,modifier:z(r)}));return{skills:e,lores:a,doubled:m("skills-columns")}}u(tt,"getSkillsData");function V(t,e){return t==="perception"?e.perception:e.skills[t]}u(V,"getSkill");function st(t,e){t.find("[data-action=action-description]").on("click",s=>{s.preventDefault();let i=$(s.currentTarget).closest(".action");P(i,e,i.find(".name").children().html())}),e.isOwner&&(t.find("[data-action=roll-skill]").on("click",s=>{s.preventDefault();let{slug:i}=s.currentTarget.dataset;V(i,e).roll({event:s})}),t.find("[data-action=roll-action]").on("click contextmenu",async s=>{s.preventDefault();let i=$(s.currentTarget),{skillSlug:a,slug:n}=i.closest(".action").data(),o=s.type==="contextmenu"?await he(a):void 0;o!==null&&as(s,e,a,n,i.data(),o?.selected)}),t.find("[data-action=action-chat]").on("click",async s=>{s.preventDefault();let{uuid:i}=s.currentTarget.closest(".action").dataset,a=await fromUuid(i);a&&ge(s,a,e,{create:!0})}))}u(st,"addSkillsListeners");async function he(t,e){let s=De.map(a=>({slug:a,label:Le(a)})),i=await renderTemplate(x("dialogs/variant"),{i18n:a=>C(`skills.variant.${a}`),dc:e,skills:s,selected:t});return Dialog.prompt({title:C("skills.variant.title"),label:C("skills.variant.button"),callback:a=>({selected:a.find("select").val(),dc:a.find("input").val()}),rejectClose:!1,content:i,options:{width:280}})}u(he,"createVariantDialog");function as(t,e,s,i,{variant:a,map:n},o){let r=ns[s].actions[i],l=r.type;o??=r.noSkill?void 0:s;let c={event:t,actors:[e],variant:a,rollMode:r.secret?"blindroll":"roll"};if(c.modifiers=[],r.modifiers){for(let{condition:d,modifiers:f}of r.modifiers)if(!(d&&!d(e)))for(let p of f)c.modifiers.push(new game.pf2e.Modifier(p))}if(r.custom){r.custom(e,c);return}else if(!l){V(o,e).roll(c);return}l===1?(c.skill=o,n&&c.modifiers.push(new game.pf2e.Modifier({label:"PF2E.MultipleAttackPenalty",modifier:n})),game.pf2e.actions[i](c)):l===2?(c.statistic=o,n&&(c.multipleAttackPenalty=n/-5),game.pf2e.actions.get(i).use(c)):l===3&&game.pf2e.actions[i](e)}u(as,"rollAction");var J={action:{order:0,label:"PF2E.ActionsActionsHeader",actionLabel:"PF2E.ActionTypeAction"},reaction:{order:1,label:"PF2E.ActionTypeReaction",actionLabel:"PF2E.ActionTypeReaction"},free:{order:2,label:"PF2E.ActionTypeFree",actionLabel:"PF2E.ActionTypeFree"},passive:{order:3,label:"PF2E.ActionTypePassive",actionLabel:"PF2E.ActionTypePassive"}},it={delay:[500,0],position:"top",theme:"crb-hover",arrow:!1};async function nt(t){let e=t.isOfType("character"),s=t.synthetics.toggles.slice(),i=m("actions"),a=e?rs(t):cs(t),n,o=game.modules.get("pf2e-hero-actions");if(o?.active&&e){let c=o.api.getHeroActions(t),d=t.heroPoints.value-c.length;n={actions:c,draw:Math.max(d,0),discard:Math.abs(Math.min(d,0)),canTrade:c.length&&game.settings.get("pf2e-hero-actions","trade")}}let r=t.system.actions&&await Promise.all(t.system.actions.map(async(c,d)=>({...c,index:d,damageFormula:await c.damage?.({getFormula:!0}),criticalFormula:await c.critical?.({getFormula:!0})}))),l={};for(let c of a)i!=="split"?(l.action??=[],l.action.push(c)):(l[c.type]??=[],l[c.type].push(c));if(l=Object.entries(l).map(([c,d])=>(d.forEach(f=>{f.img=Be(f.cost),f.typeLabel=J[f.type].actionLabel}),i!=="type"?d.sort((f,p)=>f.name.localeCompare(p.name)):d.sort((f,p)=>{let h=J[f.type].order,w=J[p.type].order;return h===w?f.name.localeCompare(p.name):h-w}),{type:c,actions:d,label:J[c].label})),i==="split"&&l.sort((c,d)=>J[c.type].order-J[d.type].order),s.length||r?.length||l.length||n?.length)return{toggles:s,strikes:r,sections:l,heroActions:n,damageTypes:CONFIG.PF2E.damageTypes,doubled:m("actions-columns")}}u(nt,"getActionsData");function at(t){if(m("actions-colors"))return{classList:["attack-damage-system-colors"]}}u(at,"getActionsOptions");function ot(t,e){_(t.find(".toggle")),_(t.find(".strike")),_(t.find(".action"));function s(n,o,r="click"){return n=typeof n=="string"?[n]:n,n=n.map(l=>`[data-action=${l}]`).join(", "),t.find(n).on(r,l=>{l.preventDefault(),o(l)})}u(s,"action");function i(n){let{index:o}=n.currentTarget.closest(".strike").dataset;return e.system.actions[o]}u(i,"getStrike");function a(n){return $(n.currentTarget).closest(".action").data().uuid}u(a,"getUuid"),s("action-description",async n=>{let o=$(n.currentTarget).closest(".action");P(o,e)}),s("hero-action-description",async n=>{let{description:o,name:r}=await os(a(n))??{};o&&Z(r,o,e)}),s("strike-description",async n=>{let o=i(n);if(!o)return;let r=document.createElement("div");r.classList.add("description"),r.innerHTML=await renderTemplate(x("strike-description"),o),Z(o.label,r,e)}),s("trait-description",n=>{let o=i(n);if(!o)return;let{index:r}=n.currentTarget.dataset,l=o.traits[r];if(!l)return;let c=game.i18n.localize(l.description);c&&Z(game.i18n.localize(l.label),c,e)}),e.isOwner&&(s("action-chat",n=>{F(n,e)?.toMessage(n,{create:!0})}),s("hero-action-chat",async n=>{await game.modules.get("pf2e-hero-actions")?.api.sendActionToChat(e,a(n))}),s("draw-hero-action",async n=>{await game.modules.get("pf2e-hero-actions")?.api.drawHeroActions(e)}),s("use-hero-action",async n=>{await game.modules.get("pf2e-hero-actions")?.api.useHeroAction(e,a(n))}),s("discard-hero-action",async n=>{await game.modules.get("pf2e-hero-actions")?.api.discardHeroActions(e,a(n))}),s("trade-hero-action",async n=>{game.modules.get("pf2e-hero-actions")?.api.tradeHeroAction(e)}),s("strike-attack",n=>{let{index:o}=n.currentTarget.dataset;i(n)?.variants[o].roll({event:n})}),s(["toggle-roll-option","set-suboption"],n=>{let o=n.currentTarget.closest(".toggle"),{domain:r,option:l,itemId:c}=o.dataset,d=o.querySelector("select")?.value??null;e.toggleRollOption(r,l,c??null,o.querySelector("input").checked,d)}),s(["strike-damage","strike-critical"],n=>{let{action:o}=n.currentTarget.dataset;i(n)?.[o==="strike-damage"?"damage":"critical"]({event:n})}).tooltipster(it),s("strike-auxiliary",n=>{if(n.currentTarget!==n.target)return;let o=i(n);if(!o)return;let{index:r}=n.currentTarget.dataset,l=n.currentTarget.querySelector("select")?.value??null;o.auxiliaryActions?.[r]?.execute({selection:l})}),s("toggle-versatile",n=>{let o=i(n)?.item;if(!o)return;let r=n.currentTarget,{value:l}=r.dataset,c=o?.system.damage.damageType??null,d=r.classList.contains("selected")||l===c?null:l;Qe({trait:"versatile",weapon:o,selection:d})}).tooltipster(it),s("strike-ammo",async n=>{let o=i(n)?.item;if(!o)return;let r=e.items.get(n.currentTarget.value);await o.update({system:{selectedAmmoId:r?.id??null}})},"change"))}u(ot,"addActionsListeners");function os(t){return game.modules.get("pf2e-hero-actions")?.api.getHeroActionDetails(t)}u(os,"getHeroActionDescription");function rs(t){let e=t.itemTypes.action.filter(i=>!et.has(i.sourceId)),s=t.itemTypes.feat.filter(i=>i.actionCost);return[...e,...s].filter(i=>{let a=i.system.traits.value;return!a.includes("downtime")&&!a.includes("exploration")}).map(i=>{let a=i.actionCost;return{id:i.id,type:a?.type??"free",cost:a,name:i.name}})}u(rs,"getCharacterActions");function cs(t){return t.itemTypes.action.map(e=>{let s=e.actionCost,i=s?.type??"passive",a=i==="passive"&&(e.system.traits.value.includes("aura")||!!e.system.rules.find(n=>n.key==="Aura"));return{id:e.id,type:i,cost:s,name:e.name,hasDeathNote:e.system.deathNote,hasAura:a}})}u(cs,"getNpcActions");var ye={CRITICAL_FAILURE:0,FAILURE:1,SUCCESS:2,CRITICAL_SUCCESS:3},rt={LOWER_BY_TWO:-2,LOWER:-1,INCREASE:1,INCREASE_BY_TWO:2,TO_CRITICAL_FAILURE:"criticalFailure",TO_FAILURE:"failure",TO_SUCCESS:"success",TO_CRITICAL_SUCCESS:"criticalSuccess"};function ct(t,e){switch(t){case"criticalFailure":return 0;case"failure":return 1;case"success":return 2;case"criticalSuccess":return 3;default:return Math.clamped(e+t,0,3)}}u(ct,"adjustDegreeOfSuccess");function be(t,e){return t===20?ct(rt.INCREASE,e):t===1?ct(rt.LOWER,e):e}u(be,"adjustDegreeByDieValue");function lt(t,e,s){return t-s>=10?be(e,ye.CRITICAL_SUCCESS):s-t>=10?be(e,ye.CRITICAL_FAILURE):t>=s?be(e,ye.SUCCESS):be(e,ye.FAILURE)}u(lt,"calculateDegreeOfSuccess");var ls=["arcana","crafting","medicine","nature","occultism","religion","society"],ut={0:{icon:'<i class="fa-solid fa-xmark-large"></i><i class="fa-solid fa-xmark-large"></i>',name:"criticalFailure"},1:{icon:'<i class="fa-solid fa-xmark-large"></i>',name:"failure"},2:{icon:'<i class="fa-solid fa-check"></i>',name:"success"},3:{icon:'<i class="fa-solid fa-check"></i><i class="fa-solid fa-check"></i>',name:"criticalSuccess"}};async function dt(t){let e=await new Roll("1d20").evaluate({async:!0}),s=e.total,i=e.dice[0].total,a=i===1?"0":i===20?"3":"",n=Object.values(t.skills).filter(c=>c.lore),o=me(c=>c.actor?.identificationDCs),r={dieSuccess:a,dieResult:i,target:o,i18n:c=>C(`actions.recall-knowledge.${c}`)};if(o){let{standard:c,skills:d,lore:f}=o.actor.identificationDCs,p=c.progression.slice();p.length=4,p=[...p];let h=f.map(({progression:w})=>{let b=w;return b.length=6,[...b]});r.skillsDCs=p,r.skills=d.map(w=>{let{mod:b,label:S,rank:D}=t.skills[w],A=s+b;return{label:S,mod:b,rank:D,rankLabel:ue[D],total:A,checks:p.map(R=>{if(!R)return"-";let O=lt(A,i,R);return{success:O,icon:ut[O].icon,title:ut[O].name}})}}),r.loresDCs=h,r.lores=n.map(({label:w,rank:b,mod:S})=>({label:w,rank:b,mod:S,modifier:z(S)}))}else r.skills=[...ls.map(c=>t.skills[c]),...n].map(({label:c,rank:d,mod:f})=>({label:c,rank:d,mod:f,modifier:z(f)}));let l=await renderTemplate(x("chat/recall-knowledge"),r);ChatMessage.create({flavor:l,speaker:ChatMessage.getSpeaker({actor:t}),rollMode:CONST.DICE_ROLL_MODES.BLIND,type:CONST.CHAT_MESSAGE_TYPES.ROLL})}u(dt,"rollRecallKnowledges");async function pt(t){let{attributes:e}=t,{initiative:s}=e;return{noMacro:C("extras.no-macro"),macros:de(t),initiative:s&&{selected:s.statistic,skills:De.map(i=>({slug:i,label:Le(i)}))},hasDailies:game.modules.get("pf2e-dailies")?.active}}u(pt,"getExtrasData");function ft(t,e,s){function i(n,o,r="click"){t.find(`[data-action=${n}]`).on(r,l=>{l.preventDefault(),o(l)})}if(u(i,"action"),i("action-description",n=>{let o=$(n.currentTarget).closest(".row");P(o,e)}),!e.isOwner)return;_(t.find(".macro"));async function a(n){let{uuid:o}=n.currentTarget.closest(".macro").dataset;return fromUuid(o)}u(a,"getMacro"),i("delete-macro",n=>fe(n,e)),i("edit-macro",async n=>{(await a(n))?.sheet.render(!0)}),i("use-macro",async n=>{(await a(n))?.execute({actor:e,token:s})}),t.on("drop",n=>pe(n,e)),i("action-chat",async n=>{let{uuid:o}=n.currentTarget.closest(".row").dataset,r=await fromUuid(o);r&&ge(n,r,e,{create:!0})}),t.find("input[name], select[name]").on("change",async n=>{let o=n.currentTarget,r=o.type==="number"?o.valueAsNumber:o.value;await e.update({[o.name]:r})}),i("roll-initiative",async n=>{await e.initiative.roll({event:n})}),i("prepare-dailies",n=>{let o=game.modules.get("pf2e-dailies");o?.active&&o.api.openDailiesInterface(e)}),i("rest-for-the-night",n=>{game.pf2e.actions.restForTheNight({actors:[e]})}),i("roll-recall-knowledge",n=>{dt(e)}),i("roll-aid",async n=>{let o=await he(null,20),r={text:"@UUID[Compendium.pf2e.other-effects.AHMUpMbaVkZ5A1KX]"};o!==null&&game.pf2e.actions.get("aid").use({event:n,actors:[e],statistic:o?.selected,difficultyClass:{value:o?.dc},notes:[r]})},"click contextmenu"),i("roll-escape",async n=>{let o=n.type==="contextmenu"?await he():void 0;o!==null&&game.pf2e.actions.get("escape").use({event:n,actors:[e],statistic:o?.selected})},"click contextmenu")}u(ft,"addExtrasListeners");async function mt(t){let{system:e,itemTypes:s}=t,{details:i,traits:a,attributes:n}=e,{stealth:o}=n,{description:r,disable:l,routine:c,reset:d,isComplex:f}=i,p=s.action,h=t.getRollData(),w=t.isOwner,b=u(async S=>q(S,t,{isOwner:w,rollData:h}),"enrich");return{actions:p,description:await b(r),disable:await b(l),routine:await b(c),reset:await b(d),isComplex:f,rarity:{value:a.rarity,label:CONFIG.PF2E.rarityTraits[a.rarity]},traits:a.value.map(S=>CONFIG.PF2E.hazardTraits[S]),stealth:z(o.value),maxWidth:m("hazard-width")}}u(mt,"getHazardData");function gt(t,e){t.find("[data-action=action-description]").on("click",s=>{s.preventDefault();let i=$(s.currentTarget).closest(".action");P(i,e)}),le(t,e),e.isOwner&&t.find("[data-action=roll-initiative").on("click",s=>{s.preventDefault(),e.initiative.roll({event:s})})}u(gt,"addHazardListeners");var ht=new Set(["arcane","divine","occult","primal"]);function us(t,e){return t.has(e)}u(us,"setHasElement");function ds(t){return t.traits.has("cursed")?"unique":t.rarity}u(ds,"getDcRarity");function ps(t){let e=t.system.traits.value;return new Set(e.filter(s=>us(ht,s)))}u(ps,"getMagicTraditions");function fs(t,e,s){let i={occult:e,primal:e,divine:e,arcane:e},a=ps(t);for(let n of ht)a.size>0&&!a.has(n)&&(i[n]=e+s);return{arcana:i.arcane,nature:i.primal,religion:i.divine,occultism:i.occult}}u(fs,"getIdentifyMagicDCs");function ms(t,{proficiencyWithoutLevel:e=!1,notMatchingTraditionModifier:s}){let i=re(t.level,{proficiencyWithoutLevel:e}),a=ds(t),n=oe(i,a);return t.isMagical?fs(t,n,s):t.isAlchemical?{crafting:n}:{dc:n}}u(ms,"getItemIdentificationDCs");function gs(t,e){return(typeof e=="string"||typeof e=="number")&&e in t}u(gs,"objectHasKey");var te=class extends FormApplication{static get defaultOptions(){return{...super.defaultOptions,id:"identify-item",title:game.i18n.localize("PF2E.identification.Identify"),template:"systems/pf2e/templates/actors/identify-item.hbs",width:"auto",classes:["identify-popup"]}}get item(){return this.object}async getData(){let e=this.object,s=game.settings.get("pf2e","identifyMagicNotMatchingTraditionModifier"),i=game.settings.get("pf2e","proficiencyVariant")==="ProficiencyWithoutLevel",a=ms(e,{proficiencyWithoutLevel:i,notMatchingTraditionModifier:s});return{...await super.getData(),isMagic:e.isMagical,isAlchemical:e.isAlchemical,dcs:a}}activateListeners(e){e.find("button.update-identification").on("click",s=>{let i=$(s.delegateTarget);this.submit({updateData:{status:i.val()}})}),e.find("button.post-skill-checks").on("click",async()=>{let s=this.item,i=s.system.identification.unidentified.img,a=s.system.identification.unidentified.name,n=s.system.identification.identified.name,o=$("div#identify-item").find("tr").toArray().flatMap(c=>{let d=c.dataset.skill,f=Number(c.dataset.dc);if(!(Number.isInteger(f)&&gs(CONFIG.PF2E.skillList,d)))return[];let p=game.i18n.localize(CONFIG.PF2E.skillList[d]);return{slug:d,name:p,dc:f}}),r=s.isMagical?"action:identify-magic":s.isAlchemical?"action:identify-alchemy":null,l=await renderTemplate("systems/pf2e/templates/actors/identify-item-chat-skill-checks.hbs",{itemImg:i,itemName:a,identifiedName:n,rollOptions:["concentrate","exploration","secret",r].filter(Boolean),skills:o});await CONFIG.ChatMessage.documentClass.create({user:game.user.id,content:l})})}async _updateObject(e,s){let i=s.status;i==="identified"&&await this.item.setIdentificationStatus(i)}};u(te,"IdentifyItemPopup");var xe={weapon:{order:0,label:"PF2E.InventoryWeaponsHeader"},armor:{order:1,label:"PF2E.InventoryArmorHeader"},consumable:{order:2,label:"PF2E.InventoryConsumablesHeader"},equipment:{order:3,label:"PF2E.InventoryEquipmentHeader"},treasure:{order:4,label:"PF2E.InventoryTreasureHeader"},backpack:{order:5,label:"PF2E.InventoryBackpackHeader"}};async function yt(t){let e={};for(let s of t.inventory.contents)e[s.type]??=[],e[s.type].push(s);return{doubled:m("items-columns"),categories:Object.entries(e).map(([s,i])=>(i.sort((a,n)=>a.name.localeCompare(n.name)),{type:s,items:i,label:xe[s].label})).sort((s,i)=>xe[s.type].order-xe[i.type].order)}}u(yt,"getItemsData");function bt(t,e){let s=t.find(".item");_(s),s.find("[data-action=item-description]").on("click",async i=>{i.preventDefault();let a=$(i.currentTarget).closest(".item");P(a,e)}),e.isOwner&&(s.find("[data-action=item-chat]").on("click",async i=>{F(i,e)?.toMessage(i,{create:!0})}),s.on("dragstart",i=>{let a=i.target.closest(".item"),{itemType:n,uuid:o}=a.dataset,r=new Image;r.src=a.querySelector(".item-img img").src,r.style.width="32px",r.style.height="32px",r.style.borderRadius="4px",r.style.position="absolute",r.style.left="-1000px",document.body.append(r),i.originalEvent.dataTransfer.setDragImage(r,16,16),i.originalEvent.dataTransfer.setData("text/plain",JSON.stringify({type:"Item",fromInventory:!0,itemType:n,uuid:o})),a.addEventListener("dragend",()=>r.remove(),{once:!0})}),t.find(".quantity input").on("change",async i=>{await F(i,e)?.update({"system.quantity":i.currentTarget.valueAsNumber})}),t.find("[data-action=toggle-item-invest]").on("click",i=>{i.preventDefault();let{itemId:a}=i.currentTarget.closest(".item").dataset;e.toggleInvested(a)}),t.find("[data-action=repair-item]").on("click",i=>{i.preventDefault();let a=F(i,e);a&&game.pf2e.actions.repair({item:a,actors:[e]})}),t.find("[data-action=toggle-identified]").on("click",i=>{i.preventDefault();let a=F(i,e);a&&(a.isIdentified?a.setIdentificationStatus("unidentified"):new te(a).render(!0))}),t.find("[data-action=edit-item]").on("click",i=>{i.preventDefault(),Je(i,e)}),t.find("[data-action=delete-item]").on("click",i=>{i.preventDefault(),Ye(i,e)}),t.find("[data-action=toggle-item-worn").tooltipster({animation:null,updateAnimation:null,animationDuration:0,delay:[0,0],trigger:"click",contentAsHTML:!0,interactive:!0,arrow:!1,side:["bottom","top"],theme:"crb-hover",minWidth:120,content:"",functionBefore:async function(i,{event:a,origin:n}){let o=F(a,e);if(!o)return;let r=document.createElement("div");r.innerHTML=await renderTemplate("systems/pf2e/templates/actors/partials/carry-type.hbs",{item:o});let l=r.children[1];$(l).find("[data-carry-type]").on("click",c=>{let{carryType:d,handsHeld:f=0,inSlot:p}=$(c.currentTarget).data();e.adjustCarryType(o,d,f,p),i.close()}),i.content(l)}}))}u(bt,"addItemsListeners");async function wt(t){let e=t.system.resources.focus??{value:0,max:0},s=t.spellcasting.regular,i=m("tradition"),a=[],n=[],o=!1;for(let c of s){let d=c.id,f=i&&c.statistic.label[0],p=await c.getSheetData(),h=p.isFocusPool,w=c.system?.prepared?.value==="charge",b=getProperty(c,"flags.pf2e-staves.staveID")!==void 0,S={value:getProperty(c,"flags.pf2e-staves.charges")??0};for(let D of p.levels){if(!D.active.length||D.uses?.max===0)continue;let A=[],R=D.isCantrip,O=D.active.filter(N=>N&&N.uses?.max!==0);for(let N=0;N<O.length;N++){let{spell:U,expended:Q,virtual:ke,uses:G,castLevel:H}=O[N];A.push({name:U.name,img:U.img,tradition:f,castLevel:H??U.level,slotId:N,entryId:d,itemId:U.id,inputId:p.isInnate?U.id:p.id,inputPath:w?"flags.pf2e-staves.charges":p.isInnate?"system.location.uses.value":`system.slots.slot${D.level}.value`,isCharge:w,isVirtual:ke,isInnate:p.isInnate,isCantrip:R,isFocus:h,isPrepared:p.isPrepared,isSpontaneous:p.isSpontaneous||p.isFlexible,slotLevel:D.level,uses:G??(w?S:D.uses),expended:Q??(h&&!R?e.value<=0:!1),action:U.system.time.value,type:w?b?`${T}.spells.staff`:`${T}.spells.charges`:p.isInnate?"PF2E.PreparationTypeInnate":p.isSpontaneous?"PF2E.PreparationTypeSpontaneous":p.isFlexible?"PF2E.SpellFlexibleLabel":h?"PF2E.SpellFocusLabel":"PF2E.SpellPreparedLabel",order:w?0:p.isPrepared?1:h?2:p.isInnate?3:p.isSpontaneous?4:5})}if(A.length){if(h)if(R)o=!0;else{n.push(...A);continue}a[D.level]??=[],a[D.level].push(...A)}}}if(a.length){let c=m("spells")?(d,f)=>d.order===f.order?d.name.localeCompare(f.name):d.order-f.order:(d,f)=>d.name.localeCompare(f.name);a.forEach(d=>d.sort(c))}n.length&&(n.sort((c,d)=>c.name.localeCompare(d.name)),a[12]=n,o=!1);let l=(await t.spellcasting.ritual?.getSheetData())?.levels.flatMap((c,d)=>c.active.map(({spell:f})=>({name:f.name,img:f.img,slotId:d,itemId:f.id,level:f.level,time:f.system.time.value})));if(a.length||l?.length)return{spells:a,rituals:l,focusPool:e,hasFocusCantrips:o,doubled:m("spells-columns")}}u(wt,"getSpellsData");function vt(t,e){_(t.find(".spell")),t.find("[data-action=spell-description]").on("click",async s=>{s.preventDefault();let i=$(s.currentTarget).closest(".spell");P(i,e)}),e.isOwner&&(t.find("[data-action=spell-chat]").on("click",async s=>{F(s,e)?.toMessage(s,{create:!0})}),t.find("[data-action=toggle-pips]").on("click contextmenu",async s=>{s.preventDefault();let i=s.type==="click"?1:-1,a=(e.system.resources.focus?.value??0)+i;await e.update({"system.resources.focus.value":a})}),t.find("[data-action=toggle-prepared]").on("click",s=>{s.preventDefault();let{slotLevel:i,slotId:a,entryId:n,expended:o}=$(s.currentTarget).closest(".spell").data();e.spellcasting.collections.get(n)?.setSlotExpendedState(i??0,a??0,o!==!0)}),t.find("[data-action=cast-spell]").on("click",s=>{s.preventDefault();let{slotLevel:i,slotId:a,entryId:n,itemId:o}=$(s.currentTarget).closest(".spell").data(),r=e.spellcasting.collections.get(n,{strict:!0});if(!r)return;let l=r.get(o,{strict:!0});l&&r.entry.cast(l,{slot:a,level:i})}),t.find("[data-input-path]").on("change",async s=>{let{inputPath:i,entryId:a}=$(s.currentTarget).data(),n=s.currentTarget.valueAsNumber;await e.updateEmbeddedDocuments("Item",[{_id:a,[i]:n}])}))}u(vt,"addSpellsListeners");var Ae="Compendium.pf2e.other-effects.I9lfZUiCwMiGogVi",hs="Compendium.pf2e.feats-srd.jFmdevE4nKevovzo",kt={left:["left","right","top","bottom"],right:["right","left","top","bottom"],top:["top","bottom","left","right"],bottom:["bottom","top","left","right"]},ys={G:"fa-solid fa-face-smile-halo",N:"fa-solid fa-face-meh",E:"fa-solid fa-face-angry-horns"},bs=[{type:"land",icon:"fa-solid fa-shoe-prints"},{type:"burrow",icon:"fa-solid fa-chevrons-down"},{type:"climb",icon:"fa-solid fa-spider"},{type:"fly",icon:"fa-solid fa-feather"},{type:"swim",icon:"fa-solid fa-person-swimming"}],ws={actions:{getData:nt,addListeners:ot,getOptions:at},items:{getData:yt,addListeners:bt},spells:{getData:wt,addListeners:vt},skills:{getData:tt,addListeners:st},extras:{getData:pt,addListeners:ft},hazard:{getData:mt,addListeners:gt}},se={fortitude:{icon:"fa-solid fa-hand-fist",label:"PF2E.SavesFortitude"},reflex:{icon:"fa-solid fa-person-running",label:"PF2E.SavesReflex"},will:{icon:"fa-solid fa-brain",label:"PF2E.SavesWill"}},vs={perception:{icon:"fa-solid fa-eye",label:"PF2E.PerceptionLabel"},stealth:{icon:"fa-duotone fa-eye-slash",label:"PF2E.SkillStealth"},athletics:{icon:"fa-solid fa-dumbbell",label:"PF2E.SkillAthletics"}},ie=class extends Application{#e=null;#d=null;#s=null;#n=!1;#a=null;#o;#r=[!1,!1,!1];#t=!1;#c=!1;#l=null;#u=null;#i=!1;constructor(){super(),this.forceClose=()=>this.close({force:!0}),this.#l=(e,s)=>{let i=m("chat")&&$(window.document).find(":hover").filter("#sidebar").length,a=e.actor;if(!a||i||this.mousedown||this.#t||this.#c||!(e instanceof Token)||a.isOfType("loot"))return;let n=e.localTransform,o=e.document;if(!(n.tx!==o.x||n.ty!==o.y)&&(this.#n=s,!(s&&this.#e===e&&this.rendered)))if(s&&!game.keyboard.downKeys.has("ControlLeft")){if(this.#p(e),!this.#a)return this.render(null,null,m("use-holding")==="none"||!Me());clearTimeout(this.#a),this.#a=null,this.render()}else this.close()},this.#o=e=>{let s=e.button;if(![0,2].includes(s))return;if(e.type==="mouseup"){this.#r[s]=!1;return}this.#r[s]=!0;let i=e.target,a=this.element[0];if(a){let n=a.querySelector(".popup");if(a.contains(i)){n&&!n.contains(i)&&n.remove();return}if(i.closest(".app")||i.closest(".tooltipster-base")||a.querySelector(".sidebar.extras")&&i.closest("#hotbar"))return;if(n)return n.remove();this.forceClose()}else this.#s&&(clearTimeout(this.#s),this.#s=null);this.#t=!1},this.#u=e=>{this.#e&&e.id===this.#e.id&&this.forceClose()},window.addEventListener("mousedown",this.#o),window.addEventListener("mouseup",this.#o),Hooks.on("hoverToken",this.#l),Hooks.on("deleteToken",this.#u),Hooks.on("canvasPan",this.forceClose)}delete(){this.forceClose(),window.removeEventListener("mousedown",this.#o),window.removeEventListener("mouseup",this.#o),Hooks.off("hoverToken",this.#l),Hooks.off("deleteToken",this.#u),Hooks.off("canvasPan",this.forceClose)}static get defaultOptions(){return mergeObject(super.defaultOptions,{popOut:!1,minimizable:!1,template:x("hud")})}get mousedown(){return this.#r[0]||this.#r[2]}get token(){return this.#e}get actor(){return this.#e?.actor}get hasCover(){return this.actor?.itemTypes.effect.find(e=>e.flags.core?.sourceId===Ae)}get isCharacter(){return this.actor?.isOfType("character")}#p(e){e!==this.#e&&(this.#e&&delete this.#e.actor.apps[this.appId],this.#e=e)}async getData(){let e=this.#e,s=this.#e?.actor;if(!s)return{};let i=null,a=m("saves"),n=m("others"),o=this.isCharacter,{attributes:r}=s,{hp:l,sp:c={max:0,value:0},ac:d}=r,f=game.settings.get("pf2e","staminaVariant"),p=this.#i,h=m("distance"),w=m("scale");if(h==="all"||h==="self"&&p){let g=m("unit").split(","),E=Number(g[0]?.trim())||1,L=g[1]?.trim()||game.system.gridUnits,I=Number(g[2]?.trim())||0,M=canvas.tokens.controlled,ae=!1,j=M.length===1?M[0]:null;(!j||j===e)&&(j=me(),ae=!0),j&&j!==e&&(i={unit:L,icon:ae?'<i class="fa-solid fa-crosshairs-simple"></i>':'<i class="fa-solid fa-expand"></i>',range:(e.distanceTo(j)*E).toFixed(I)})}let b;if(!p||m("see-status")){let g=m("status").split(",").map(E=>E.trim()).filter(Boolean);if(g.length&&l.max){let E=l.max+(f?c.max:0),I=(l.value+(f?c.value:0))/E,M=Math.ceil(I*g.length);b={hue:I*I*122+3,value:M===0?game.i18n.localize("EFFECT.StatusDead"):g.at(M-1)}}}let S={status:b,distance:i,fontSize:w,tokenId:e.id,type:s.isOfType("creature")?"creature":s.type};if(!p||s.isOfType("familiar")&&!s.master)return S;let{level:D,saves:A,isOwner:R,system:O}=s,{resistances:N,weaknesses:U,immunities:Q}=r;S={...S,isOwner:R,isObserver:p,name:e.document.name,hp:l,ac:d.value,level:D};let ke=m("ranks");function G(g,E,L){let I=g.slug,M=E==="bonus"?z(g.mod):g.dc.value;return{slug:I,value:M,label:L[I].label,icon:L[I].icon,rank:ke&&ue[g.rank]}}u(G,"getStatistic");function H(g,E){if(!g.length)return"";let L=g.map(I=>Se(I.label.replace("-"," ").titleCase())).join("");return E?`<li>${game.i18n.localize(E)}<ul>`+L+"</ul></li>":L}if(u(H,"toIWR"),s.isOfType("hazard")){let{hardness:g,emitsSound:E,stealth:L}=r;return{...S,hardness:g,emitsSound:E.toString().capitalize(),immunities:H(Q),weaknesses:H(U),resistances:H(N),stealth:{value:L.value,details:await q(L.details,s)},saves:a!=="none"&&["fortitude","reflex","will"].map(I=>{let M=A[I];return M?G(M,a,se):{slug:I,label:se[I].label,icon:se[I].icon}})}}if(S={...S,sidebarTitles:{actions:`${T}.actions.title`,items:`${T}.items.title`,spells:`${T}.spells.title`,skills:`${T}.skills.title`,extras:`${T}.extras.title`},hasItems:s.inventory.size},s.isOfType("vehicle")){let{hardness:g,collisionDC:E,collisionDamage:L}=r,{details:I}=O,{crew:M,passengers:ae,pilotingCheck:j,speed:Nt}=I;return{...S,hardness:g,crew:M,passengers:ae,pilotingCheck:j,speed:Nt,collisionDC:E.value,collisionDamage:L.value,immunities:H(Q),weaknesses:H(U),resistances:H(N),fortitude:G(A.fortitude,a,se),hasActions:s.itemTypes.action.length}}let Lt=m("show-death"),{alignment:Pe,heroPoints:xt}=s,{traits:Ce}=O,{wounded:$e,dying:Re,shield:At,resolve:Ot,speed:ne}=r;function Se(g){return`<li>${g.trim()}</li>`}u(Se,"toInfo");function Mt(g,E){return g.localeCompare(E)}u(Mt,"sort");let Ft=Ce?.languages?.value.map(g=>game.i18n.localize(CONFIG.PF2E.languages[g])).filter(Boolean).sort(Mt).map(Se).join(""),Pt=o?Ce.senses.map(g=>g.label):Ce.senses.value?.split(",").filter(Boolean),Ne=bs.map(({type:g,icon:E},L)=>({index:L,icon:E,label:game.i18n.localize(CONFIG.PF2E.speedTypes[g]??"PF2E.SpeedTypesLand"),value:(g==="land"?ne.total:ne.otherSpeeds.find(I=>I.type===g)?.total)||0})),$t=W(s,`speeds.selected.${game.user.id}`)||0,Rt=Ne.splice($t,1)[0],He=Ne.map(({value:g,label:E,index:L})=>`<a data-index="${L}"><li>${E}: ${g}</li></a>`).join("");return ne.details&&(He+=`<li>${game.i18n.localize("PF2E.DetailsHeading")}: ${ne.details}</li>`),{...S,sp:f?c:{max:0},hero:xt,dying:Re,wounded:$e,shield:At,resolve:Ot,alignment:{value:Pe,icon:ys[Pe.at(-1)]},isCharacter:o,showDeathLine:o&&(Lt==="always"||Re.value||$e.value),hasCover:this.hasCover,saves:a!=="none"&&["fortitude","reflex","will"].map(g=>G(A[g],a,se)),others:n!=="none"&&["perception","stealth","athletics"].map(g=>G(V(g,s),n,vs)),speeds:{main:Rt,others:He},iwr:H(Q,"PF2E.ImmunitiesLabel")+H(U,"PF2E.WeaknessesLabel")+H(N,"PF2E.ResistancesLabel"),senses:Pt?.map(Se).join(""),languages:Ft,hasSpells:s.spellcasting.some(g=>g.category!=="items")}}#f(e){this.#p(null),this.#n=!1,this.#t=!1,this.#c=!1,this.#i=!1,this.#s!==null&&(clearTimeout(this.#s),this.#s=null);let s=Application.RENDER_STATES;if(!e.force&&![s.RENDERED,s.ERROR].includes(this._state))return;this._state=s.CLOSING;let i=this.element;if(!i)return this._state=s.CLOSED;i.css({minHeight:0});for(let a of this.constructor._getInheritanceChain())Hooks.call(`close${a.name}`,this,i);i.remove(),this._element=null,this._state=s.CLOSED,delete ui.windows[this.appId]}close(e={}){if(e.force)return this.#f(e);this.#a=setTimeout(()=>{this.#a=null,!this.#n&&this.#f(e)})}async _render(e=!1,s={}){let i,a;if(this.#d===this.#e){let n=this.element.find("> .sidebar")[0];n&&(i=n.dataset.type,a=n.scrollTop)}if(await super._render(e,s),ui.windows[this.appId]=this,i){let n=await this.#m(i);a>0&&(n.scrollTop=a)}this.#d=this.#e}render(e,s,i){let a=this.#e,n=a?.actor;if(!n)return;let o=Me(),r=m("use-holding"),l=n.system.details.alliance==="party";if(game.user.isGM&&r==="half"&&!o?this.#i=!1:n.isOfType("familiar")&&!n.master?this.#i=!1:this.#i=a.isOwner||m("observer")&&(a.observer||l&&m("party")),r!=="none"&&!o&&(r==="all"||this.#i))return;if(!i)return super.render(!0);let c=m("delay");c?this.#s=setTimeout(()=>super.render(!0),c):super.render(!0)}_injectHTML(e){$("body").append(e),this._element=e}setPosition(){let e=this.#e;if(!e)return;let s=this.element[0],i=e.worldTransform.a,a=s.getBoundingClientRect(),n=canvas.clientCoordinatesFromCanvas(e.document._source),o={x:n.x,y:n.y,width:e.hitArea.width*i,height:e.hitArea.height*i,get right(){return this.x+this.width},get bottom(){return this.y+this.height}},r,l=this.#i?kt[m("position")].slice():kt[m("small-position")].slice();for(;l.length&&!r;){let c=l.shift();c==="left"?(r={x:o.x-a.width,y:Oe(a,o)},r.x<0&&(r=void 0)):c==="right"?(r={x:o.right,y:Oe(a,o)},r.x+a.width>window.innerWidth&&(r=void 0)):c==="top"?(r={x:Ct(a,o),y:o.y-a.height},r.y<0&&(r=void 0)):c==="bottom"&&(r={x:Ct(a,o),y:o.bottom},r.y+a.height>window.innerHeight&&(r=void 0))}return r&&(s.style.left=`${r.x}px`,s.style.top=`${r.y}px`),r}activateListeners(e){let s=this.#e,i=s?.actor;if(!i)return;let a=s.isOwner,n=CONFIG.ChatMessage.documentClass;i.apps[this.appId]=this,m("tooltips")&&e.find(".inner [data-tooltip]").attr("data-tooltip",""),e.on("mousedown",()=>this.bringToTop()),e.on("mouseenter",()=>{e.find(".inner").length&&(this.#n=!0,this.#c=!0)}),e.on("mouseleave",()=>{this.#c=!1,!this.#t&&(this.#n=!1,this.close())}),e.on("dragover",()=>{s.isOwner&&e.find("> .sidebar.extras").length&&!e.find(".popup").length||(e.css("opacity",.1),e.css("pointerEvents","none"),window.addEventListener("dragend",()=>{e.css("opacity",1),e.css("pointerEvents","")},{once:!0}))});let o=e.find("[data-action=show-info]");o.tooltipster({position:["top","bottom","left","right"],theme:"crb-hover",arrow:!1,animationDuration:0,contentAsHTML:!0,trigger:"click"}),o.filter(".stealth").tooltipster("option","interactive",!0).tooltipster("option","functionReady",(l,{origin:c,tooltip:d})=>{this.#t=!0,$(d).find(".content-link").on("click",()=>setTimeout(()=>l.close()))}).tooltipster("option","functionAfter",()=>{e.find("> .sidebar").length||(this.#t=!1)}),(a?o.filter(":not(.speeds):not(.stealth)"):o).on("mouseleave",l=>{$(l.currentTarget).tooltipster("hide")}),e.find(".inner .footer [data-type], [data-action=open-sidebar]").on("click",this.#m.bind(this)),a&&(e.find("[data-action=collision-dc]").on("click",l=>{l.preventDefault();let c=i.system.attributes.collisionDC.value||15;n.create({content:`@Check[type:reflex|dc:${c}]`,speaker:n.getSpeaker({actor:i})})}),e.find("[data-action=collision-damage]").on("click",async l=>{l.preventDefault();let c=(i.system.attributes.collisionDamage.value||"1d6").trim();isNaN(Number(c.at(-1)))||(c+="[bludgeoning]");let d=CONFIG.Dice.rolls.find(p=>p.name==="DamageRoll"),f=await new d(c).evaluate({async:!0});n.create({flavor:`<strong>${game.i18n.localize("PF2E.vehicle.collisionDamageLabel")}</strong>`,speaker:n.getSpeaker({actor:i}),type:CONST.CHAT_MESSAGE_TYPES.ROLL,sound:"sounds/dice.wav",rolls:[f]})}),e.find("input").on("change",async l=>{let c=l.currentTarget,d=c.valueAsNumber,f=c.name;c.blur(),f!=="shield.value"?await i.update({[f]:d}):await i.heldShield.update({"system.hp.value":d})}),e.find("[data-action=toggle-hero]").on("click contextmenu",l=>{l.preventDefault();let{max:c,value:d}=i.heroPoints,f=l.type==="click"?1:-1,p=Math.clamped(d+f,0,c);p!==d&&i.update({"system.resources.heroPoints.value":p})}),e.find("[data-action=raise-shield]").on("click",l=>{l.preventDefault(),game.pf2e.actions.raiseAShield({actors:[i]})}),e.find("[data-action=take-cover]").on("click",async l=>{l.preventDefault();let c=(await fromUuid(Ae)).toObject();setProperty(c,"flags.core.sourceId",Ae);let d=this.hasCover;this.hasCover?await d.delete():await i.createEmbeddedDocuments("Item",[c])}),e.find("[data-action=roll-save]").on("click",l=>{l.preventDefault();let c=l.currentTarget.dataset.save;i.saves[c].roll({event:l})}),e.find("[data-action=roll-other]").on("click",l=>{l.preventDefault();let c=l.currentTarget.dataset.slug;if(c!=="athletics"){let{ctrlKey:d,metaKey:f,shiftKey:p}=l;l=new MouseEvent("click",{ctrlKey:!d,metaKey:f,shiftKey:p})}V(c,i).roll({event:l})}),e.find("[data-action=recovery-check]").on("click",l=>{l.preventDefault(),i.rollRecovery(l)}),e.find("[data-action=toggle-dying], [data-action=toggle-wounded]").on("click contextmenu",l=>{l.preventDefault();let c=l.currentTarget.dataset.action==="toggle-dying"?"dying":"wounded",d=i.system.attributes[c]?.max;d&&(l.type==="click"?i.increaseCondition(c,{max:d}):i.decreaseCondition(c))}),e.find("[data-action=use-resolve]").on("click",l=>{l.preventDefault(),ks(i)}),o.filter(".speeds").tooltipster("option","interactive",!0).tooltipster("option","functionReady",(l,{origin:c,tooltip:d})=>{this.#t=!0,d.querySelectorAll("[data-index]").forEach(f=>{f.addEventListener("click",async p=>{p.preventDefault(),await X(i,`speeds.selected.${game.user.id}`,Number(f.dataset.index))})})}).tooltipster("option","functionAfter",()=>{e.find("> .sidebar").length||(this.#t=!1)}))}async#m(e){e=typeof e=="string"?e:e.currentTarget.dataset.type;let s=this.element,i=s.find("> .sidebar"),a=i[0]?.dataset.type;if(i.remove(),s.find(".inner .footer [data-type], [data-action=open-sidebar]").removeClass("active"),a===e){this.#t=!1;return}let n=this.#e,o=n.actor,{getData:r,addListeners:l,getOptions:c}=ws[e],d=await r(o,n),{classList:f=[]}=c&&await c(o,n)||{};if(!d)return ui.notifications.warn(C(`${e}.empty`,{name:this.#e.name}));d.isGM=game.user.isGM,d.isCharacter=this.isCharacter,d.isOwner=o.isOwner,this.#t=!0,s.find(`.inner .footer [data-type=${e}], [data-action=open-sidebar][data-type=${e}]`).addClass("active"),s=s[0];let p=document.createElement("div");p.innerHTML=await renderTemplate(x(`sidebars/${e}`),d),i=p.firstElementChild,i.classList.add("sidebar",...f),m("scrollbar")||i.classList.add("no-scrollbar"),d.doubled&&i.classList.add("doubled"),i.dataset.type=e,i.style.setProperty("--max-height",m("height").trim()||"100%"),this.element.append(i);let h=i.getBoundingClientRect(),w=s.getBoundingClientRect(),b=w.x-h.width;b<0&&(b=w.right);let S=parseInt(window.getComputedStyle(s).padding),D=Oe(h,w,S);return i.style.left=`${b}px`,i.style.top=`${D}px`,l($(i),o,n),i}};u(ie,"HUD");function Oe(t,e,s=0){let i=e.y+e.height/2-t.height/2;return i+t.height>window.innerHeight&&(i=window.innerHeight-t.height-s),i<0&&(i=s),i}u(Oe,"postionFromTargetY");function Ct(t,e){let s=e.x+e.width/2-t.width/2;return s+t.width>window.innerWidth&&(y=window.innerWidth-t.width),s<0&&(s=0),s}u(Ct,"postionFromTargetX");async function ks(t){function e(d){ChatMessage.create({user:game.user.id,content:d,speaker:ChatMessage.getSpeaker({actor:t})})}u(e,"toChat");let{name:s,attributes:i}=t,{sp:a,resolve:n}=i,o=C("hud.resolve.full",{name:s}),r=game.i18n.format("PF2E.Actions.SteelYourResolve.NoStamina",{name:s});if(a.value===a.max)return ui.notifications.warn(o);if(n.value<1)return ui.notifications.warn(r);let l=t.itemTypes.feat.find(d=>d.sourceId===hs),c=await renderTemplate(x("dialogs/resolve"),{hasSteel:l,i18n:d=>C(`hud.resolve.${d}`)});new Dialog({title:C("hud.resolve.title"),content:c,buttons:{yes:{icon:"<i class='fas fa-check'></i>",label:C("hud.resolve.yes"),callback:async d=>{let{attributes:f}=t,{sp:p,resolve:h}=f;if(p.value===p.max)return e(o);if(h.value<1)return e(r);let w=d.find("input:checked").val(),b=`${p.value}/${p.max}`;if(w==="breather")e(C("hud.resolve.breather.used",{name:s,ratio:b})),await t.update({"system.attributes.sp.value":p.max,"system.attributes.resolve.value":h.value-1});else{e(game.i18n.format("PF2E.Actions.SteelYourResolve.RecoverStamina",{name:s,ratio:b}));let S=p.value+Math.floor(p.max/2);await t.update({"system.attributes.sp.value":Math.min(S,p.max),"system.attributes.resolve.value":h.value-1})}}},no:{icon:"<i class='fas fa-times'></i>",label:C("hud.resolve.no")}}}).render(!0)}u(ks,"useResolve");var T="pf2e-token-hud",Y=null;function St(){return Y}u(St,"getHud");function we(t){t&&!Y?Y=new ie:!t&&Y&&(Y.delete(),Y=null)}u(we,"enableModule");function m(t){return game.settings.get(T,t)}u(m,"getSetting");function C(...t){let e=t.at(-1),s=typeof e=="object",i=s?t.slice(0,-1):t;return i.unshift(T),game.i18n[s?"format":"localize"](i.join("."),e)}u(C,"localize");function Ie(t,e){return t.itemTypes.feat.some(s=>s.sourceId===e)}u(Ie,"hasFeat");function x(t){return`modules/${T}/templates/${t}.hbs`}u(x,"templatePath");function z(t){return t>=0?`+${t}`:t}u(z,"modifier");function W(t,e){return t.getFlag(T,e)}u(W,"getFlag");function X(t,e,s){return t.setFlag(T,e,s)}u(X,"setFlag");async function q(t,e,{isOwner:s=e.isOwner,rollData:i=e.getRollData()}={}){return t=t?.trim(),t?await TextEditor.enrichHTML(t,{async:!0,secrets:s,rollData:i}):""}u(q,"enrichHTML");var Fe=!1;function Et(){Cs("hold",{onDown:()=>{Fe=!0,m("use-holding")!=="none"&&St().render()},onUp:()=>{Fe=!1}})}u(Et,"registerKeybindings");function Me(){return Fe}u(Me,"isHolding");function Tt(t,e){return`${T}.keybinds.${t}.${e}`}u(Tt,"path");function Cs(t,e={}){game.keybindings.register(T,t,{name:Tt(t,"name"),hint:Tt(t,"hint"),precedence:CONST.KEYBINDING_PRECEDENCE.PRIORITY,...e})}u(Cs,"register");function It(){let t=game.data.users.find(s=>s._id===game.data.userId).role>=CONST.USER_ROLES.GAMEMASTER,e=["first","second","third","fourth"].map(s=>C(`settings.status.statuses.${s}`)).join(", ");v("status",String,e,{scope:"world"}),v("party",Boolean,!1,{scope:"world"}),v("enabled",Boolean,!0,{onChange:we}),v("position",String,"right",{choices:{left:k("position","choices.left"),right:k("position","choices.right"),top:k("position","choices.top"),bottom:k("position","choices.bottom")}}),v("small-position",String,"top",{choices:{left:k("position","choices.left"),right:k("position","choices.right"),top:k("position","choices.top"),bottom:k("position","choices.bottom")}}),v("delay",Number,250,{range:{min:0,max:2e3,step:50}}),v("scale",Number,14,{range:{min:10,max:30,step:1}}),v("use-holding",String,"none",{hint:k("use-holding",t?"choices.gm.hint":"choices.player.hint"),choices:{none:k("use-holding","choices.none"),half:k("use-holding",t?"choices.gm.half":"choices.player.half"),all:k("use-holding",t?"choices.gm.all":"choices.player.all")}}),v("observer",Boolean,!0),v("see-status",Boolean,!1),v("chat",Boolean,!0),v("saves",String,"bonus",{choices:{none:k("saves","choices.none"),bonus:k("saves","choices.bonus"),dc:k("saves","choices.dc")}}),v("others",String,"none",{choices:{none:k("saves","choices.none"),bonus:k("saves","choices.bonus"),dc:k("saves","choices.dc")}}),v("ranks",Boolean,!1),v("show-death",String,"always",{choices:{none:k("show-death","choices.none"),always:k("show-death","choices.always"),only:k("show-death","choices.only")}}),v("tooltips",Boolean,!1),v("hazard-width",Number,32,{range:{min:14,max:50,step:1}}),v("distance",String,"all",{choices:{none:k("distance","choices.none"),self:k("distance","choices.self"),all:k("distance","choices.all")}}),v("unit",String,""),v("height",String,""),v("scrollbar",Boolean,!0),v("actions-columns",Boolean,!1),v("items-columns",Boolean,!1),v("spells-columns",Boolean,!1),v("skills-columns",Boolean,!1),v("actions",String,"split",{choices:{name:k("actions","choices.name"),type:k("actions","choices.type"),split:k("actions","choices.split")}}),v("actions-colors",Boolean,!0),v("spells",Boolean,!1),v("tradition",Boolean,!1),v("untrained",Boolean,!0)}u(It,"registerSettings");function Dt(t,e){let s=e.find(`.tab[data-tab=${T}]`);function i(a,n,o="h3"){let r=C(`menu.${n}`);s.find(`[name="${T}.${a}"]`).closest(".form-group").before(`<${o}>${r}</${o}>`)}u(i,"beforeGroup"),game.user.isGM&&i("enabled","client.header","h2"),i("saves","client.tooltip"),i("distance","client.distance"),i("height","client.sidebar"),i("actions","client.actions"),i("spells","client.spells"),i("untrained","client.skills")}u(Dt,"renderSettingsConfig");function k(t,e){return`${T}.settings.${t}.${e}`}u(k,"path");function v(t,e,s,i={}){game.settings.register(T,t,{name:k(t,"name"),hint:k(t,"hint"),scope:"client",config:!0,type:e,default:s,...i})}u(v,"register");Hooks.once("init",async()=>{It(),Et(),await loadTemplates({creature:x("tooltips/creature"),hazard:x("tooltips/hazard"),vehicle:x("tooltips/vehicle")})});Hooks.once("ready",()=>{m("enabled")&&we(!0)});Hooks.on("renderSettingsConfig",Dt);Hooks.on("getActorDirectoryEntryContext",(t,e)=>{e.unshift({icon:'<i class="fa-solid fa-code"></i>',name:`${T}.actor.macros.contextmenu`,condition:s=>{let{documentId:i}=s.data();return m("enabled")&&game.actors.get(i)?.isOwner},callback:s=>{let{documentId:i}=s.data();Ss(i)}})});var ve=class extends Dialog{async getData(e={}){let s=super.getData(e);return typeof s.content=="function"&&(s.content=await s.content()),s}};u(ve,"DataDialog");function Ss(t){let e=game.actors.get(t);if(!e)return;let s=new ve({title:`${e.name} - ${C("actor.macros.title")}`,content:async()=>{let i=de(e)??[];return renderTemplate(x("dialogs/macros"),{macros:i,noMacro:C("extras.no-macro")})},buttons:{},render:i=>{e.apps[s.appId]=s,i.on("drop",a=>pe(a,e)),i.find("[data-action=delete-macro]").on("click",a=>fe(a,e))},close:()=>{delete e.apps[s.appId]}},{height:"auto"}).render(!0)}u(Ss,"openMacrosDialog");})();
//# sourceMappingURL=main.js.map
