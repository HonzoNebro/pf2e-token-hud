{
  "version": 3,
  "sources": ["../src/shared.js", "../src/pf2e.js", "../src/popup.js", "../src/sidebars/skills.js", "../src/sidebars/actions.js", "../src/actions/recall-knowledge.js", "../src/sidebars/extras.js", "../src/sidebars/items.js", "../src/sidebars/spells.js", "../src/hud.js", "../src/module.js", "../src/keybindings.js", "../src/settings.js", "../src/main.js"],
  "sourcesContent": ["import { getFlag, localize, setFlag } from './module.js'\r\n\r\nexport const RANKS = ['U', 'T', 'E', 'M', 'L']\r\n\r\nexport async function getItemSummary(el, actor) {\r\n    const dataset = el.data()\r\n    const item = dataset.itemId ? actor.items.get(dataset.itemId) : await fromUuid(dataset.uuid)\r\n    const data = await item?.getChatData({}, dataset)\r\n    if (!data) return\r\n\r\n    const description = document.createElement('div')\r\n    description.classList.add('description')\r\n\r\n    await actor.sheet.itemRenderer.renderItemSummary(description, item, data)\r\n\r\n    return description\r\n}\r\n\r\nexport function addNameTooltipListeners(el) {\r\n    el.on('mouseenter', event => {\r\n        event.preventDefault()\r\n\r\n        const target = event.currentTarget.querySelector('.name')\r\n        const { width } = target.getBoundingClientRect()\r\n        if (target.scrollWidth <= Math.ceil(width)) return\r\n\r\n        const name = target.innerHTML.trim()\r\n        game.tooltip.activate(event.currentTarget, { text: name })\r\n    })\r\n\r\n    el.on('mouseleave', event => {\r\n        event.preventDefault()\r\n        game.tooltip.deactivate()\r\n    })\r\n\r\n    el.on('mousedown', event => {\r\n        game.tooltip.deactivate()\r\n    })\r\n}\r\n\r\nexport function editItem(event, actor) {\r\n    event.preventDefault()\r\n    const item = getItemFromEvent(event, actor)\r\n    item?.sheet.render(true, { focus: true })\r\n}\r\n\r\nexport async function deleteItem(event, actor) {\r\n    event.preventDefault()\r\n\r\n    const item = getItemFromEvent(event, actor)\r\n    if (!item) return\r\n\r\n    if (event.ctrlKey) return item.delete()\r\n\r\n    new Dialog({\r\n        title: localize('deleteItem.title'),\r\n        content: await renderTemplate('systems/pf2e/templates/actors/delete-item-dialog.hbs', { name: item.name }),\r\n        buttons: {\r\n            ok: {\r\n                icon: '<i class=\"fa-solid fa-trash\"></i>',\r\n                label: localize('deleteItem.ok'),\r\n                callback: () => item.delete(),\r\n            },\r\n            cancel: {\r\n                icon: '<i class=\"fas fa-times\"></i>',\r\n                label: localize('deleteItem.cancel'),\r\n            },\r\n        },\r\n    }).render(true)\r\n}\r\n\r\nexport function getItemFromEvent(event, actor) {\r\n    const { itemId } = event.currentTarget.closest('[data-item-id]').dataset\r\n    return actor.items.get(itemId)\r\n}\r\n\r\nexport function getMacros(actor) {\r\n    return (\r\n        actor.isOwner &&\r\n        getFlag(actor, `macros.${game.user.id}`)\r\n            ?.map(uuid => fromUuidSync(uuid))\r\n            .filter(Boolean)\r\n    )\r\n}\r\n\r\nexport function onDroppedMacro(event, actor) {\r\n    const { type, uuid } = TextEditor.getDragEventData(event.originalEvent) ?? {}\r\n    if (type !== 'Macro' || !fromUuidSync(uuid)) return\r\n\r\n    const flag = `macros.${game.user.id}`\r\n    const macros = getFlag(actor, flag)?.slice() ?? []\r\n    if (macros.includes(uuid)) return\r\n\r\n    macros.push(uuid)\r\n    setFlag(actor, flag, macros)\r\n}\r\n\r\nexport function deleteMacro(event, actor) {\r\n    const flag = `macros.${game.user.id}`\r\n    const macros = getFlag(actor, flag)?.slice()\r\n    if (!macros?.length) return\r\n\r\n    const { uuid } = event.currentTarget.closest('.macro').dataset\r\n    const index = macros.indexOf(uuid)\r\n    if (index === -1) return\r\n\r\n    macros.splice(index, 1)\r\n    setFlag(actor, flag, macros)\r\n}\r\n\r\nexport function getUniqueTarget(condition = () => true) {\r\n    const targets = game.user.targets\r\n    const target = targets.size === 1 ? targets.first() : null\r\n    return target && condition(target) ? target : null\r\n}\r\n", "/**\r\n * Those are directly copied from the PF2e system because they are not accesible to us in the global\r\n */\r\n\r\nconst dcAdjustments = new Map([\r\n    ['incredibly-easy', -10],\r\n    ['very-easy', -5],\r\n    ['easy', -2],\r\n    ['normal', 0],\r\n    ['hard', 2],\r\n    ['very-hard', 5],\r\n    ['incredibly-hard', 10],\r\n])\r\n\r\nconst dcByLevel = new Map([\r\n    [-1, 13],\r\n    [0, 14],\r\n    [1, 15],\r\n    [2, 16],\r\n    [3, 18],\r\n    [4, 19],\r\n    [5, 20],\r\n    [6, 22],\r\n    [7, 23],\r\n    [8, 24],\r\n    [9, 26],\r\n    [10, 27],\r\n    [11, 28],\r\n    [12, 30],\r\n    [13, 31],\r\n    [14, 32],\r\n    [15, 34],\r\n    [16, 35],\r\n    [17, 36],\r\n    [18, 38],\r\n    [19, 39],\r\n    [20, 40],\r\n    [21, 42],\r\n    [22, 44],\r\n    [23, 46],\r\n    [24, 48],\r\n    [25, 50],\r\n])\r\n\r\nconst MAGIC_TRADITIONS = new Set(['arcane', 'divine', 'occult', 'primal'])\r\n\r\nconst actionImgMap = {\r\n    0: 'systems/pf2e/icons/actions/FreeAction.webp',\r\n    free: 'systems/pf2e/icons/actions/FreeAction.webp',\r\n    1: 'systems/pf2e/icons/actions/OneAction.webp',\r\n    2: 'systems/pf2e/icons/actions/TwoActions.webp',\r\n    3: 'systems/pf2e/icons/actions/ThreeActions.webp',\r\n    '1 or 2': 'systems/pf2e/icons/actions/OneTwoActions.webp',\r\n    '1 to 3': 'systems/pf2e/icons/actions/OneThreeActions.webp',\r\n    '2 or 3': 'systems/pf2e/icons/actions/TwoThreeActions.webp',\r\n    reaction: 'systems/pf2e/icons/actions/Reaction.webp',\r\n    passive: 'systems/pf2e/icons/actions/Passive.webp',\r\n}\r\n\r\nconst actionGlyphMap = {\r\n    0: 'F',\r\n    free: 'F',\r\n    1: 'A',\r\n    2: 'D',\r\n    3: 'T',\r\n    '1 or 2': 'A/D',\r\n    '1 to 3': 'A - T',\r\n    '2 or 3': 'D/T',\r\n    reaction: 'R',\r\n}\r\n\r\nexport function getActionIcon(action, fallback = 'systems/pf2e/icons/actions/Empty.webp') {\r\n    if (action === null) return actionImgMap['passive']\r\n    const value = typeof action !== 'object' ? action : action.type === 'action' ? action.value : action.type\r\n    const sanitized = String(value ?? '')\r\n        .toLowerCase()\r\n        .trim()\r\n    return actionImgMap[sanitized] ?? fallback\r\n}\r\n\r\nexport function getActionGlyph(action) {\r\n    if (!action && action !== 0) return ''\r\n\r\n    const value = typeof action !== 'object' ? action : action.type === 'action' ? action.value : action.type\r\n    const sanitized = String(value ?? '')\r\n        .toLowerCase()\r\n        .trim()\r\n\r\n    return actionGlyphMap[sanitized] ?? ''\r\n}\r\n\r\nexport async function toggleWeaponTrait({ weapon, trait, selection }) {\r\n    const current = weapon.system.traits.toggles[trait].selection\r\n    if (current === selection) return false\r\n\r\n    const item = weapon.actor?.items.get(weapon.id)\r\n    if (item?.isOfType('weapon') && item === weapon) {\r\n        await item.update({ [`system.traits.toggles.${trait}.selection`]: selection })\r\n    } else if (item?.isOfType('weapon') && weapon.altUsageType === 'melee') {\r\n        await item.update({ [`system.meleeUsage.traitToggles.${trait}`]: selection })\r\n    } else {\r\n        const rule = item?.rules.find(r => r.key === 'Strike' && !r.ignored && r.slug === weapon.slug)\r\n        await rule?.toggleTrait({ trait, selection })\r\n    }\r\n\r\n    return true\r\n}\r\n\r\nfunction adjustDC(dc, adjustment = 'normal') {\r\n    return dc + (dcAdjustments.get(adjustment) ?? 0)\r\n}\r\n\r\nfunction rarityToDCAdjustment(rarity = 'common') {\r\n    switch (rarity) {\r\n        case 'uncommon':\r\n            return 'hard'\r\n        case 'rare':\r\n            return 'very-hard'\r\n        case 'unique':\r\n            return 'incredibly-hard'\r\n        default:\r\n            return 'normal'\r\n    }\r\n}\r\n\r\nfunction adjustDCByRarity(dc, rarity = 'common') {\r\n    return adjustDC(dc, rarityToDCAdjustment(rarity))\r\n}\r\n\r\nfunction calculateDC(level, { proficiencyWithoutLevel, rarity = 'common' } = {}) {\r\n    const pwlSetting = game.settings.get('pf2e', 'proficiencyVariant')\r\n    proficiencyWithoutLevel ??= pwlSetting === 'ProficiencyWithoutLevel'\r\n\r\n    const dc = dcByLevel.get(level) ?? 14\r\n    if (proficiencyWithoutLevel) {\r\n        return adjustDCByRarity(dc - Math.max(level, 0), rarity)\r\n    } else {\r\n        return adjustDCByRarity(dc, rarity)\r\n    }\r\n}\r\n\r\nfunction getDcRarity(item) {\r\n    return item.traits.has('cursed') ? 'unique' : item.rarity\r\n}\r\n\r\nfunction getMagicTraditions(item) {\r\n    const traits = item.system.traits.value\r\n    return new Set(traits.filter(t => setHasElement(MAGIC_TRADITIONS, t)))\r\n}\r\n\r\nfunction getIdentifyMagicDCs(item, baseDC, notMatchingTraditionModifier) {\r\n    const result = {\r\n        occult: baseDC,\r\n        primal: baseDC,\r\n        divine: baseDC,\r\n        arcane: baseDC,\r\n    }\r\n    const traditions = getMagicTraditions(item)\r\n    for (const key of MAGIC_TRADITIONS) {\r\n        if (traditions.size > 0 && !traditions.has(key)) {\r\n            result[key] = baseDC + notMatchingTraditionModifier\r\n        }\r\n    }\r\n    return { arcana: result.arcane, nature: result.primal, religion: result.divine, occultism: result.occult }\r\n}\r\n\r\nfunction getItemIdentificationDCs(item, { proficiencyWithoutLevel = false, notMatchingTraditionModifier }) {\r\n    const baseDC = calculateDC(item.level, { proficiencyWithoutLevel })\r\n    const rarity = getDcRarity(item)\r\n    const dc = adjustDCByRarity(baseDC, rarity)\r\n    if (item.isMagical) {\r\n        return getIdentifyMagicDCs(item, dc, notMatchingTraditionModifier)\r\n    } else if (item.isAlchemical) {\r\n        return { crafting: dc }\r\n    } else {\r\n        return { dc: dc }\r\n    }\r\n}\r\n\r\nfunction objectHasKey(obj, key) {\r\n    return (typeof key === 'string' || typeof key === 'number') && key in obj\r\n}\r\n\r\nfunction setHasElement(set, value) {\r\n    return set.has(value)\r\n}\r\n\r\nexport class IdentifyItemPopup extends FormApplication {\r\n    static get defaultOptions() {\r\n        return {\r\n            ...super.defaultOptions,\r\n            id: 'identify-item',\r\n            title: game.i18n.localize('PF2E.identification.Identify'),\r\n            template: 'systems/pf2e/templates/actors/identify-item.hbs',\r\n            width: 'auto',\r\n            classes: ['identify-popup'],\r\n        }\r\n    }\r\n\r\n    get item() {\r\n        return this.object\r\n    }\r\n\r\n    async getData() {\r\n        const item = this.object\r\n        const notMatchingTraditionModifier = game.settings.get('pf2e', 'identifyMagicNotMatchingTraditionModifier')\r\n        const proficiencyWithoutLevel = game.settings.get('pf2e', 'proficiencyVariant') === 'ProficiencyWithoutLevel'\r\n        const dcs = getItemIdentificationDCs(item, { proficiencyWithoutLevel, notMatchingTraditionModifier })\r\n\r\n        return {\r\n            ...(await super.getData()),\r\n            isMagic: item.isMagical,\r\n            isAlchemical: item.isAlchemical,\r\n            dcs,\r\n        }\r\n    }\r\n\r\n    activateListeners($form) {\r\n        $form.find('button.update-identification').on('click', event => {\r\n            const $button = $(event.delegateTarget)\r\n            this.submit({ updateData: { status: $button.val() } })\r\n        })\r\n        $form.find('button.post-skill-checks').on('click', async () => {\r\n            const item = this.item\r\n            const itemImg = item.system.identification.unidentified.img\r\n            const itemName = item.system.identification.unidentified.name\r\n            const identifiedName = item.system.identification.identified.name\r\n            const skills = $('div#identify-item')\r\n                .find('tr')\r\n                .toArray()\r\n                .flatMap(row => {\r\n                    const slug = row.dataset.skill\r\n                    const dc = Number(row.dataset.dc)\r\n                    if (!(Number.isInteger(dc) && objectHasKey(CONFIG.PF2E.skillList, slug))) {\r\n                        return []\r\n                    }\r\n                    const name = game.i18n.localize(CONFIG.PF2E.skillList[slug])\r\n\r\n                    return { slug, name, dc }\r\n                })\r\n\r\n            const actionOption = item.isMagical ? 'action:identify-magic' : item.isAlchemical ? 'action:identify-alchemy' : null\r\n\r\n            const content = await renderTemplate('systems/pf2e/templates/actors/identify-item-chat-skill-checks.hbs', {\r\n                itemImg,\r\n                itemName,\r\n                identifiedName,\r\n                // We don't want to install remeda just for that so we do our own thing\r\n                // rollOptions: R.compact(['concentrate', 'exploration', 'secret', actionOption]),\r\n                rollOptions: ['concentrate', 'exploration', 'secret', actionOption].filter(Boolean),\r\n                skills,\r\n            })\r\n\r\n            await CONFIG.ChatMessage.documentClass.create({ user: game.user.id, content })\r\n        })\r\n    }\r\n\r\n    async _updateObject(_event, formData) {\r\n        const status = formData['status']\r\n        if (status === 'identified') {\r\n            await this.item.setIdentificationStatus(status)\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * This one is used to create chat message for items directly picked from compendiums\r\n * So it is not technically a direct copy/paste of the system code but a slightly rearanged version\r\n */\r\nexport async function unownedItemToMessage(event, item, actor, { rollMode = undefined, create = true, data = {} }) {\r\n    const template = `systems/pf2e/templates/chat/${item.type}-card.hbs`\r\n    const token = actor.token\r\n    const nearestItem = event?.currentTarget.closest('.item') ?? {}\r\n    const ChatMessagePF2e = CONFIG.ChatMessage.documentClass\r\n\r\n    const contextualData = Object.keys(data).length > 0 ? data : nearestItem.dataset || {}\r\n    const templateData = {\r\n        actor: actor,\r\n        tokenId: token ? `${token.parent?.id}.${token.id}` : null,\r\n        item,\r\n        data: await item.getChatData(undefined, contextualData),\r\n    }\r\n\r\n    const chatData = {\r\n        speaker: ChatMessagePF2e.getSpeaker({\r\n            actor: actor,\r\n            token: actor.getActiveTokens(false, true)[0] ?? null,\r\n        }),\r\n        flags: {\r\n            core: {\r\n                canPopout: true,\r\n            },\r\n            pf2e: {\r\n                origin: { uuid: item.uuid, type: item.type },\r\n            },\r\n        },\r\n        type: CONST.CHAT_MESSAGE_TYPES.OTHER,\r\n    }\r\n\r\n    rollMode ??= event?.ctrlKey || event?.metaKey ? 'blindroll' : game.settings.get('core', 'rollMode')\r\n    if (['gmroll', 'blindroll'].includes(rollMode)) chatData.whisper = ChatMessagePF2e.getWhisperRecipients('GM').map(u => u.id)\r\n    if (rollMode === 'blindroll') chatData.blind = true\r\n\r\n    chatData.content = await renderTemplate(template, templateData)\r\n    return create ? ChatMessagePF2e.create(chatData, { renderSheet: false }) : new ChatMessagePF2e(chatData)\r\n}\r\n\r\nconst DegreeOfSuccess = {\r\n    CRITICAL_FAILURE: 0,\r\n    FAILURE: 1,\r\n    SUCCESS: 2,\r\n    CRITICAL_SUCCESS: 3,\r\n}\r\n\r\nconst DEGREE_ADJUSTMENT_AMOUNTS = {\r\n    LOWER_BY_TWO: -2,\r\n    LOWER: -1,\r\n    INCREASE: 1,\r\n    INCREASE_BY_TWO: 2,\r\n    TO_CRITICAL_FAILURE: 'criticalFailure',\r\n    TO_FAILURE: 'failure',\r\n    TO_SUCCESS: 'success',\r\n    TO_CRITICAL_SUCCESS: 'criticalSuccess',\r\n}\r\n\r\nfunction adjustDegreeOfSuccess(amount, degreeOfSuccess) {\r\n    switch (amount) {\r\n        case 'criticalFailure':\r\n            return 0\r\n        case 'failure':\r\n            return 1\r\n        case 'success':\r\n            return 2\r\n        case 'criticalSuccess':\r\n            return 3\r\n        default:\r\n            return Math.clamped(degreeOfSuccess + amount, 0, 3)\r\n    }\r\n}\r\n\r\nfunction adjustDegreeByDieValue(dieResult, degree) {\r\n    if (dieResult === 20) {\r\n        return adjustDegreeOfSuccess(DEGREE_ADJUSTMENT_AMOUNTS.INCREASE, degree)\r\n    } else if (dieResult === 1) {\r\n        return adjustDegreeOfSuccess(DEGREE_ADJUSTMENT_AMOUNTS.LOWER, degree)\r\n    }\r\n\r\n    return degree\r\n}\r\n\r\nexport function calculateDegreeOfSuccess(rollTotal, dieResult, dc) {\r\n    if (rollTotal - dc >= 10) {\r\n        return adjustDegreeByDieValue(dieResult, DegreeOfSuccess.CRITICAL_SUCCESS)\r\n    } else if (dc - rollTotal >= 10) {\r\n        return adjustDegreeByDieValue(dieResult, DegreeOfSuccess.CRITICAL_FAILURE)\r\n    } else if (rollTotal >= dc) {\r\n        return adjustDegreeByDieValue(dieResult, DegreeOfSuccess.SUCCESS)\r\n    }\r\n\r\n    return adjustDegreeByDieValue(dieResult, DegreeOfSuccess.FAILURE)\r\n}\r\n", "import { localize, MODULE_ID } from './module.js'\r\nimport { getItemSummary } from './shared.js'\r\n\r\nexport async function popup(title, content) {\r\n    const hud = $(`#${MODULE_ID}`)\r\n    if (!hud.length) return\r\n\r\n    hud.find('> .popup').remove()\r\n\r\n    const tmp = document.createElement('div')\r\n    tmp.innerHTML = `<div class=\"popup\">\r\n    <div class=\"header\">\r\n        <div class=\"title\">${title}</div>\r\n        <a class=\"observable\" data-action=\"close-popup\"><i class=\"fas fa-times\"></i> ${localize('popup.close')}</a>\r\n    </div>\r\n</div>`\r\n\r\n    const popup = tmp.firstElementChild\r\n    if (typeof content === 'string') {\r\n        content = await TextEditor.enrichHTML(content, { async: true })\r\n        popup.insertAdjacentHTML('beforeend', content)\r\n    } else {\r\n        popup.append(content)\r\n    }\r\n\r\n    popup.querySelector('[data-action=close-popup]').addEventListener('click', () => popup.remove())\r\n\r\n    hud.append(popup)\r\n}\r\n\r\nexport async function showItemSummary(el, actor, title) {\r\n    title ??= el.find('.name').html()\r\n    const description = await getItemSummary(el, actor)\r\n    if (description) popup(title.trim(), description)\r\n}\r\n", "import { getSetting, hasFeat, localize, modifier, templatePath } from '../module.js'\r\nimport { unownedItemToMessage } from '../pf2e.js'\r\nimport { showItemSummary } from '../popup.js'\r\n\r\nconst MODULE_ID = 'pf2e-token-hud'\r\n\r\nconst CROWBAR_UUIDS = new Set([\r\n    'Compendium.pf2e.equipment-srd.44F1mfJei4GY8f2X',\r\n    'Compendium.pf2e.equipment-srd.4kz3vhkKPUuXBpxk',\r\n])\r\nconst BON_MOT_UUID = 'Compendium.pf2e.feats-srd.0GF2j54roPFIDmXf'\r\nconst NATURAL_MEDICINE_UUID = 'Compendium.pf2e.feats-srd.WC4xLBGmBsdOdHWu'\r\n\r\nconst LABELS = {\r\n    initiative: 'PF2E.InitiativeLabel',\r\n    'recall-knowledge': 'PF2E.RecallKnowledge.Label',\r\n    'cover-tracks': 'PF2E.TravelSpeed.ExplorationActivities.CoverTracks',\r\n    earnIncome: `${MODULE_ID}.skills.actions.earnIncome`,\r\n    treatWounds: `${MODULE_ID}.skills.actions.treatWounds`,\r\n    'borrow-arcane-spell': `${MODULE_ID}.skills.actions.borrow-arcane-spell`,\r\n    'identify-magic': `${MODULE_ID}.skills.actions.identify-magic`,\r\n    'identify-alchemy': `${MODULE_ID}.skills.actions.identify-alchemy`,\r\n    'learn-spell': `${MODULE_ID}.skills.actions.learn-spell`,\r\n    'crafting-goods': `${MODULE_ID}.skills.actions.crafting-goods`,\r\n    'staging-performance': `${MODULE_ID}.skills.actions.staging-performance`,\r\n}\r\n\r\nconst ACTIONS_UUIDS = {\r\n    'sense-motive': 'Compendium.pf2e.actionspf2e.1xRFPTFtWtGJ9ELw',\r\n    seek: 'Compendium.pf2e.actionspf2e.BlAOM2X92SI6HMtJ',\r\n    balance: 'Compendium.pf2e.actionspf2e.M76ycLAqHoAgbcej',\r\n    escape: 'Compendium.pf2e.actionspf2e.SkZAQRkLLkmBQNB9',\r\n    'tumble-through': 'Compendium.pf2e.actionspf2e.21WIfSu7Xd7uKqV8',\r\n    'maneuver-in-flight': 'Compendium.pf2e.actionspf2e.Qf1ylAbdVi1rkc8M',\r\n    squeeze: 'Compendium.pf2e.actionspf2e.kMcV8e5EZUxa6evt',\r\n    'recall-knowledge': 'Compendium.pf2e.actionspf2e.1OagaWtBpVXExToo',\r\n    'borrow-arcane-spell': 'Compendium.pf2e.actionspf2e.OizxuPb44g3eHPFh',\r\n    'decipher-writing': 'Compendium.pf2e.actionspf2e.d9gbpiQjChYDYA2L',\r\n    'identify-magic': 'Compendium.pf2e.actionspf2e.eReSHVEPCsdkSL4G',\r\n    'learn-spell': 'Compendium.pf2e.actionspf2e.Q5iIYCFdqJFM31GW',\r\n    climb: 'Compendium.pf2e.actionspf2e.pprgrYQ1QnIDGZiy',\r\n    forceOpen: 'Compendium.pf2e.actionspf2e.SjmKHgI7a5Z9JzBx',\r\n    grapple: 'Compendium.pf2e.actionspf2e.PMbdMWc2QroouFGD',\r\n    highJump: 'Compendium.pf2e.actionspf2e.2HJ4yuEFY1Cast4h',\r\n    longJump: 'Compendium.pf2e.actionspf2e.JUvAvruz7yRQXfz2',\r\n    shove: 'Compendium.pf2e.actionspf2e.7blmbDrQFNfdT731',\r\n    swim: 'Compendium.pf2e.actionspf2e.c8TGiZ48ygoSPofx',\r\n    trip: 'Compendium.pf2e.actionspf2e.ge56Lu1xXVFYUnLP',\r\n    disarm: 'Compendium.pf2e.actionspf2e.Dt6B1slsBy8ipJu9',\r\n    repair: 'Compendium.pf2e.actionspf2e.bT3skovyLUtP22ME',\r\n    craft: 'Compendium.pf2e.actionspf2e.rmwa3OyhTZ2i2AHl',\r\n    'crafting-goods': '',\r\n    earnIncome: 'Compendium.pf2e.actionspf2e.QyzlsLrqM0EEwd7j',\r\n    'identify-alchemy': 'Compendium.pf2e.actionspf2e.Q4kdWVOf2ztIBFg1',\r\n    createADiversion: 'Compendium.pf2e.actionspf2e.GkmbTGfg8KcgynOA',\r\n    impersonate: 'Compendium.pf2e.actionspf2e.AJstokjdG6iDjVjE',\r\n    lie: 'Compendium.pf2e.actionspf2e.ewwCglB7XOPLUz72',\r\n    feint: 'Compendium.pf2e.actionspf2e.QNAVeNKtHA0EUw4X',\r\n    bonMot: BON_MOT_UUID,\r\n    gatherInformation: 'Compendium.pf2e.actionspf2e.plBGdZhqq5JBl1D8',\r\n    makeAnImpression: 'Compendium.pf2e.actionspf2e.OX4fy22hQgUHDr0q',\r\n    request: 'Compendium.pf2e.actionspf2e.DCb62iCBrJXy0Ik6',\r\n    coerce: 'Compendium.pf2e.actionspf2e.tHCqgwjtQtzNqVvd',\r\n    demoralize: 'Compendium.pf2e.actionspf2e.2u915NdUyQan6uKF',\r\n    'administer-first-aid': 'Compendium.pf2e.actionspf2e.MHLuKy4nQO2Z4Am1',\r\n    'treat-disease': 'Compendium.pf2e.actionspf2e.TC7OcDa7JlWbqMaN',\r\n    'treat-poison': 'Compendium.pf2e.actionspf2e.KjoCEEmPGTeFE4hh',\r\n    treatWounds: 'Compendium.pf2e.actionspf2e.1kGNdIIhuglAjIp9',\r\n    'command-an-animal': 'Compendium.pf2e.actionspf2e.q9nbyIF0PEBqMtYe',\r\n    perform: 'Compendium.pf2e.actionspf2e.EEDElIyin4z60PXx',\r\n    'staging-performance': '',\r\n    subsist: 'Compendium.pf2e.actionspf2e.49y9Ec4bDii8pcD3',\r\n    'create-forgery': 'Compendium.pf2e.actionspf2e.ftG89SjTSa9DYDOD',\r\n    'conceal-an-object': 'Compendium.pf2e.actionspf2e.qVNVSmsgpKFGk9hV',\r\n    hide: 'Compendium.pf2e.actionspf2e.XMcnh4cSI32tljXa',\r\n    sneak: 'Compendium.pf2e.actionspf2e.VMozDqMMuK5kpoX4',\r\n    senseDirection: 'Compendium.pf2e.actionspf2e.fJImDBQfqfjKJOhk',\r\n    'cover-tracks': 'Compendium.pf2e.actionspf2e.SB7cMECVtE06kByk',\r\n    track: 'Compendium.pf2e.actionspf2e.EA5vuSgJfiHH7plD',\r\n    'palm-an-object': 'Compendium.pf2e.actionspf2e.ijZ0DDFpMkWqaShd',\r\n    steal: 'Compendium.pf2e.actionspf2e.RDXXE7wMrSPCLv5k',\r\n    'disable-device': 'Compendium.pf2e.actionspf2e.cYdz2grcOcRt4jk6',\r\n    'pick-a-lock': 'Compendium.pf2e.actionspf2e.2EE4aF4SZpYf0R6H',\r\n}\r\n\r\nconst DUPLICATE_SKILLS = {\r\n    escape: { slug: 'escape', cost: '1', type: 2, noSkill: true },\r\n    'recall-knowledge': { slug: 'recall-knowledge', cost: '1', secret: true },\r\n    'decipher-writing': { slug: 'decipher-writing', type: 2, trained: true },\r\n    'identify-magic': { slug: 'identify-magic', trained: true },\r\n    'learn-spell': { slug: 'learn-spell', trained: true },\r\n}\r\n\r\nconst SKILLS = [\r\n    {\r\n        slug: 'perception',\r\n        actions: [\r\n            { slug: 'sense-motive', cost: '1', type: 2 },\r\n            { slug: 'seek', cost: '1', type: 2 },\r\n        ],\r\n    },\r\n    {\r\n        slug: 'acrobatics',\r\n        actions: [\r\n            { slug: 'balance', cost: '1', type: 2 },\r\n            // 'escape',\r\n            { slug: 'tumble-through', cost: '1', type: 2 },\r\n            { slug: 'maneuver-in-flight', cost: '1', type: 2, trained: true },\r\n            { slug: 'squeeze', type: 2, trained: true },\r\n        ],\r\n    },\r\n    {\r\n        slug: 'arcana',\r\n        actions: [\r\n            // 'recall-knowledge',\r\n            { slug: 'borrow-arcane-spell', trained: true },\r\n            'decipher-writing',\r\n            'identify-magic',\r\n            'learn-spell',\r\n        ],\r\n    },\r\n    {\r\n        slug: 'athletics',\r\n        actions: [\r\n            { slug: 'climb', cost: '1', type: 1 },\r\n            // 'escape',\r\n            {\r\n                slug: 'forceOpen',\r\n                cost: '1',\r\n                type: 1,\r\n                map: true,\r\n                modifiers: [\r\n                    {\r\n                        condition: actor =>\r\n                            !actor.itemTypes.equipment.some(item => item.isHeld && CROWBAR_UUIDS.has(item.sourceId)),\r\n                        modifiers: [\r\n                            {\r\n                                slug: 'crowbar-missing',\r\n                                modifier: -2,\r\n                                type: 'circumstance',\r\n                            },\r\n                        ],\r\n                    },\r\n                ],\r\n            },\r\n            { slug: 'grapple', cost: '1', type: 1, map: true },\r\n            { slug: 'highJump', cost: '1', type: 1 },\r\n            { slug: 'longJump', cost: '1', type: 1 },\r\n            { slug: 'shove', cost: '1', type: 1, map: true },\r\n            { slug: 'swim', cost: '1', type: 1 },\r\n            { slug: 'trip', cost: '1', type: 2, map: true },\r\n            { slug: 'disarm', cost: '1', type: 1, map: true, trained: true },\r\n        ],\r\n    },\r\n    {\r\n        slug: 'crafting',\r\n        actions: [\r\n            // 'recall-knowledge',\r\n            { slug: 'repair', type: 1 },\r\n            { slug: 'craft', type: 1, trained: true },\r\n            { slug: 'crafting-goods', trained: true },\r\n            { slug: 'earnIncome', type: 3, trained: true },\r\n            { slug: 'identify-alchemy', trained: true },\r\n        ],\r\n    },\r\n    {\r\n        slug: 'deception',\r\n        actions: [\r\n            { slug: 'createADiversion', cost: '1', type: 1, variants: ['distracting-words', 'gesture', 'trick'] },\r\n            { slug: 'impersonate', type: 1 },\r\n            { slug: 'lie', type: 1 },\r\n            { slug: 'feint', cost: '1', type: 1, trained: true },\r\n        ],\r\n    },\r\n    {\r\n        slug: 'diplomacy',\r\n        actions: [\r\n            {\r\n                slug: 'bonMot',\r\n                cost: '1',\r\n                type: 1,\r\n                condition: actor => hasFeat(actor, BON_MOT_UUID),\r\n            },\r\n            { slug: 'gatherInformation', type: 1 },\r\n            { slug: 'makeAnImpression', type: 1 },\r\n            { slug: 'request', cost: '1', type: 1 },\r\n        ],\r\n    },\r\n    {\r\n        slug: 'intimidation',\r\n        actions: [\r\n            { slug: 'coerce', type: 2 },\r\n            { slug: 'demoralize', cost: '1', type: 2 },\r\n        ],\r\n    },\r\n    {\r\n        slug: 'medicine',\r\n        actions: [\r\n            { slug: 'administer-first-aid', cost: '2', type: 2, variants: ['stabilize', 'stop-bleeding'] },\r\n            { slug: 'treat-disease', type: 2, trained: true },\r\n            { slug: 'treat-poison', cost: '1', type: 2, trained: true },\r\n            { slug: 'treatWounds', type: 1, trained: true },\r\n        ],\r\n    },\r\n    {\r\n        slug: 'nature',\r\n        actions: [\r\n            { slug: 'command-an-animal', cost: '1', type: 2 }, //\r\n            // 'recall-knowledge',\r\n            'identify-magic',\r\n            'learn-spell',\r\n            { slug: 'treatWounds', type: 1, trained: true, condition: actor => hasFeat(actor, NATURAL_MEDICINE_UUID) },\r\n        ],\r\n    },\r\n    {\r\n        slug: 'occultism',\r\n        actions: [\r\n            // 'recall-knowledge', //\r\n            'decipher-writing',\r\n            'identify-magic',\r\n            'learn-spell',\r\n        ],\r\n    },\r\n    {\r\n        slug: 'performance',\r\n        actions: [\r\n            {\r\n                slug: 'perform',\r\n                cost: '1',\r\n                type: 1,\r\n                variants: ['acting', 'comedy', 'dance', 'keyboards', 'oratory', 'percussion', 'singing', 'strings', 'winds'],\r\n            },\r\n            { slug: 'staging-performance', trained: true },\r\n        ],\r\n    },\r\n    {\r\n        slug: 'religion',\r\n        actions: [\r\n            // 'recall-knowledge', //\r\n            'decipher-writing',\r\n            'identify-magic',\r\n            'learn-spell',\r\n        ],\r\n    },\r\n    {\r\n        slug: 'society',\r\n        actions: [\r\n            // 'recall-knowledge', //\r\n            { slug: 'subsist', type: 2 },\r\n            { slug: 'create-forgery', type: 2, trained: true },\r\n            'decipher-writing',\r\n        ],\r\n    },\r\n    {\r\n        slug: 'stealth',\r\n        actions: [\r\n            { slug: 'conceal-an-object', cost: '1', type: 2 },\r\n            { slug: 'hide', cost: '1', type: 2 },\r\n            { slug: 'sneak', cost: '1', type: 2 },\r\n        ],\r\n    },\r\n    {\r\n        slug: 'survival',\r\n        actions: [\r\n            { slug: 'senseDirection', type: 1 },\r\n            { slug: 'subsist', type: 2 },\r\n            { slug: 'cover-tracks', trained: true },\r\n            { slug: 'track', type: 1, trained: true },\r\n        ],\r\n    },\r\n    {\r\n        slug: 'thievery',\r\n        actions: [\r\n            { slug: 'palm-an-object', cost: '1', type: 2 },\r\n            { slug: 'steal', cost: '1', type: 2 },\r\n            { slug: 'disable-device', cost: '2', type: 2, trained: true },\r\n            { slug: 'pick-a-lock', cost: '2', type: 2, trained: true },\r\n        ],\r\n    },\r\n]\r\n\r\nSKILLS.forEach(skill => {\r\n    skill.actions = skill.actions.map(action => (typeof action === 'string' ? DUPLICATE_SKILLS[action] : action))\r\n\r\n    const { slug, actions } = skill\r\n    for (let action of actions) {\r\n        const unslugged = action.slug.replace(/-(.)/g, (_, c) => c.toUpperCase()).capitalize()\r\n\r\n        action.skillSlug = slug\r\n        action.uuid = ACTIONS_UUIDS[action.slug]\r\n        action.label = LABELS[action.slug] ?? `PF2E.Actions.${unslugged}.Title`\r\n\r\n        if (action.variants) {\r\n            action.variants = action.variants.map(variant => ({\r\n                slug: variant,\r\n                label: `${MODULE_ID}.skills.actions.${variant}`,\r\n            }))\r\n        } else if (action.map) {\r\n            action.variants = [\r\n                { label: 'PF2E.Roll.Normal' },\r\n                { label: 'PF2E.MAPAbbreviationLabel', map: -5 },\r\n                { label: 'PF2E.MAPAbbreviationLabel', map: -10 },\r\n            ]\r\n        }\r\n\r\n        action.modifiers?.forEach(({ modifiers }) => {\r\n            modifiers.forEach(modifier => {\r\n                modifier.label = `${MODULE_ID}.skills.modifiers.${modifier.slug}`\r\n            })\r\n        })\r\n    }\r\n})\r\n\r\nexport const SKILLS_SLUGS = SKILLS.map(skill => skill.slug)\r\n\r\nconst SKILLS_MAP = SKILLS.reduce((skills, { slug, actions }) => {\r\n    skills[slug] = {\r\n        slug,\r\n        actions: actions.reduce((actions, action) => {\r\n            actions[action.slug] = action\r\n            return actions\r\n        }, {}),\r\n    }\r\n    return skills\r\n}, {})\r\n\r\nexport const actionsUUIDS = new Set(Object.values(ACTIONS_UUIDS).filter(Boolean))\r\n\r\nexport function getSkillLabel(slug) {\r\n    return game.i18n.localize(slug === 'perception' ? 'PF2E.PerceptionLabel' : CONFIG.PF2E.skillList[slug])\r\n}\r\n\r\nexport async function getSkillsData(actor) {\r\n    const skills = []\r\n    const noUntrained = !getSetting('untrained')\r\n    const notCharacter = !actor.isOfType('character')\r\n\r\n    for (let i = 0; i < SKILLS.length; i++) {\r\n        const { slug, actions } = SKILLS[i]\r\n        const { label, rank, mod } = getSkill(slug, actor)\r\n\r\n        skills[i] = {\r\n            slug,\r\n            label,\r\n            rank,\r\n            modifier: modifier(mod),\r\n            actions: actions.filter(\r\n                action =>\r\n                    (noUntrained || notCharacter || !action.trained || actor.skills[slug].rank >= 1) &&\r\n                    (!action.condition || action.condition(actor))\r\n            ),\r\n        }\r\n    }\r\n\r\n    const lores = Object.values(actor.skills)\r\n        .filter(skill => skill.lore)\r\n        .map(({ label, rank, mod, slug }) => ({\r\n            slug,\r\n            label,\r\n            rank,\r\n            modifier: modifier(mod),\r\n        }))\r\n\r\n    return { skills, lores, doubled: getSetting('skills-columns') }\r\n}\r\n\r\nexport function getSkill(slug, actor) {\r\n    return slug === 'perception' ? actor.perception : actor.skills[slug]\r\n}\r\n\r\nexport function addSkillsListeners(el, actor) {\r\n    el.find('[data-action=action-description]').on('click', event => {\r\n        event.preventDefault()\r\n        const action = $(event.currentTarget).closest('.action')\r\n        showItemSummary(action, actor, action.find('.name').children().html())\r\n    })\r\n\r\n    // IS OWNER\r\n    if (!actor.isOwner) return\r\n\r\n    el.find('[data-action=roll-skill]').on('click', event => {\r\n        event.preventDefault()\r\n        const { slug } = event.currentTarget.dataset\r\n        getSkill(slug, actor).roll({ event })\r\n    })\r\n\r\n    el.find('[data-action=roll-action]').on('click contextmenu', async event => {\r\n        event.preventDefault()\r\n        const target = $(event.currentTarget)\r\n        const { skillSlug, slug } = target.closest('.action').data()\r\n        const variant = event.type === 'contextmenu' ? await createVariantDialog(skillSlug) : undefined\r\n        if (variant !== null) rollAction(event, actor, skillSlug, slug, target.data(), variant?.selected)\r\n    })\r\n\r\n    el.find('[data-action=action-chat]').on('click', async event => {\r\n        event.preventDefault()\r\n        const { uuid } = event.currentTarget.closest('.action').dataset\r\n        const item = await fromUuid(uuid)\r\n        if (item) unownedItemToMessage(event, item, actor, { create: true })\r\n    })\r\n}\r\n\r\nexport async function createVariantDialog(base, dc) {\r\n    const skills = SKILLS_SLUGS.map(slug => ({ slug, label: getSkillLabel(slug) }))\r\n\r\n    const content = await renderTemplate(templatePath('dialogs/variant'), {\r\n        i18n: str => localize(`skills.variant.${str}`),\r\n        dc,\r\n        skills,\r\n        selected: base,\r\n    })\r\n\r\n    return Dialog.prompt({\r\n        title: localize('skills.variant.title'),\r\n        label: localize('skills.variant.button'),\r\n        callback: html => ({ selected: html.find('select').val(), dc: html.find('input').val() }),\r\n        rejectClose: false,\r\n        content,\r\n        options: { width: 280 },\r\n    })\r\n}\r\n\r\nfunction rollAction(event, actor, skillSlug, slug, { variant, map }, skill) {\r\n    const action = SKILLS_MAP[skillSlug].actions[slug]\r\n    const type = action.type\r\n\r\n    skill ??= action.noSkill ? undefined : skillSlug\r\n\r\n    const options = {\r\n        event,\r\n        actors: [actor],\r\n        variant,\r\n        rollMode: action.secret ? 'blindroll' : 'roll',\r\n    }\r\n\r\n    options.modifiers = []\r\n\r\n    if (action.modifiers) {\r\n        for (const { condition, modifiers } of action.modifiers) {\r\n            if (condition && !condition(actor)) continue\r\n            for (const modifier of modifiers) {\r\n                options.modifiers.push(new game.pf2e.Modifier(modifier))\r\n            }\r\n        }\r\n    }\r\n\r\n    if (action.custom) {\r\n        action.custom(actor, options)\r\n        return\r\n    } else if (!type) {\r\n        getSkill(skill, actor).roll(options)\r\n        return\r\n    }\r\n\r\n    // old actions\r\n    if (type === 1) {\r\n        options.skill = skill\r\n        if (map) options.modifiers.push(new game.pf2e.Modifier({ label: 'PF2E.MultipleAttackPenalty', modifier: map }))\r\n        game.pf2e.actions[slug](options)\r\n    }\r\n    // new actions\r\n    else if (type === 2) {\r\n        options.statistic = skill\r\n        if (map) options.multipleAttackPenalty = map / -5\r\n        game.pf2e.actions.get(slug).use(options)\r\n    }\r\n    // exception for old actions that only accept one actor argument\r\n    else if (type === 3) {\r\n        game.pf2e.actions[slug](actor)\r\n    }\r\n}\r\n", "import { getSetting, templatePath } from '../module.js'\r\nimport { getActionIcon, toggleWeaponTrait } from '../pf2e.js'\r\nimport { popup, showItemSummary } from '../popup.js'\r\nimport { addNameTooltipListeners, getItemFromEvent } from '../shared.js'\r\nimport { actionsUUIDS } from './skills.js'\r\n\r\nconst SECTIONS_TYPES = {\r\n    action: { order: 0, label: 'PF2E.ActionsActionsHeader', actionLabel: 'PF2E.ActionTypeAction' },\r\n    reaction: { order: 1, label: 'PF2E.ActionTypeReaction', actionLabel: 'PF2E.ActionTypeReaction' },\r\n    free: { order: 2, label: 'PF2E.ActionTypeFree', actionLabel: 'PF2E.ActionTypeFree' },\r\n    passive: { order: 3, label: 'PF2E.ActionTypePassive', actionLabel: 'PF2E.ActionTypePassive' },\r\n}\r\n\r\nconst TOOLTIPS = {\r\n    delay: [500, 0],\r\n    position: 'top',\r\n    theme: 'crb-hover',\r\n    arrow: false,\r\n}\r\n\r\nexport async function getActionsData(actor) {\r\n    const isCharacter = actor.isOfType('character')\r\n    const toggles = actor.synthetics.toggles.slice()\r\n    const sorting = getSetting('actions')\r\n    const actions = isCharacter ? getCharacterActions(actor) : getNpcActions(actor)\r\n\r\n    let heroActions\r\n    const heroActionsModule = game.modules.get('pf2e-hero-actions')\r\n    if (heroActionsModule?.active && isCharacter) {\r\n        const actions = heroActionsModule.api.getHeroActions(actor)\r\n        const diff = actor.heroPoints.value - actions.length\r\n\r\n        heroActions = {\r\n            actions,\r\n            draw: Math.max(diff, 0),\r\n            discard: Math.abs(Math.min(diff, 0)),\r\n            canTrade: actions.length && game.settings.get('pf2e-hero-actions', 'trade'),\r\n        }\r\n    }\r\n\r\n    const strikes = await Promise.all(\r\n        actor.system.actions.map(async (strike, index) => ({\r\n            ...strike,\r\n            index,\r\n            damageFormula: await strike.damage?.({ getFormula: true }),\r\n            criticalFormula: await strike.critical?.({ getFormula: true }),\r\n        }))\r\n    )\r\n\r\n    let sections = {}\r\n\r\n    for (const action of actions) {\r\n        if (sorting !== 'split') {\r\n            sections.action ??= []\r\n            sections.action.push(action)\r\n        } else {\r\n            sections[action.type] ??= []\r\n            sections[action.type].push(action)\r\n        }\r\n    }\r\n\r\n    sections = Object.entries(sections).map(([type, actions]) => {\r\n        actions.forEach(action => {\r\n            action.img = getActionIcon(action.cost)\r\n            action.typeLabel = SECTIONS_TYPES[action.type].actionLabel\r\n        })\r\n\r\n        if (sorting !== 'type') {\r\n            actions.sort((a, b) => a.name.localeCompare(b.name))\r\n        } else {\r\n            actions.sort((a, b) => {\r\n                const orderA = SECTIONS_TYPES[a.type].order\r\n                const orderB = SECTIONS_TYPES[b.type].order\r\n                return orderA === orderB ? a.name.localeCompare(b.name) : orderA - orderB\r\n            })\r\n        }\r\n\r\n        return { type, actions, label: SECTIONS_TYPES[type].label }\r\n    })\r\n\r\n    if (sorting === 'split') sections.sort((a, b) => SECTIONS_TYPES[a.type].order - SECTIONS_TYPES[b.type].order)\r\n\r\n    if (toggles.length || strikes.length || sections.length || heroActions?.length)\r\n        return { toggles, strikes, sections, heroActions, damageTypes: CONFIG.PF2E.damageTypes }\r\n}\r\n\r\nexport function getActionsOptions(actor) {\r\n    if (getSetting('actions-colors')) return { classList: ['attack-damage-system-colors'] }\r\n}\r\n\r\nexport function addActionsListeners(el, actor) {\r\n    addNameTooltipListeners(el.find('.toggle'))\r\n    addNameTooltipListeners(el.find('.strike'))\r\n    addNameTooltipListeners(el.find('.action'))\r\n\r\n    function action(action, callback, type = 'click') {\r\n        action = typeof action === 'string' ? [action] : action\r\n        action = action.map(x => `[data-action=${x}]`).join(', ')\r\n        return el.find(action).on(type, event => {\r\n            event.preventDefault()\r\n            callback(event)\r\n        })\r\n    }\r\n\r\n    function getStrike(event) {\r\n        const { index } = event.currentTarget.closest('.strike').dataset\r\n        return actor.system.actions[index]\r\n    }\r\n\r\n    function getUuid(event) {\r\n        return $(event.currentTarget).closest('.action').data().uuid\r\n    }\r\n\r\n    action('action-description', async event => {\r\n        const action = $(event.currentTarget).closest('.action')\r\n        showItemSummary(action, actor)\r\n    })\r\n\r\n    action('hero-action-description', async event => {\r\n        const { description, name } = (await getHeroActionDescription(getUuid(event))) ?? {}\r\n        if (description) popup(name, description)\r\n    })\r\n\r\n    action('strike-description', async event => {\r\n        const strike = getStrike(event)\r\n        if (!strike) return\r\n\r\n        const description = document.createElement('div')\r\n        description.classList.add('description')\r\n        // this one is a copy of the system template, there is nothing to generate it\r\n        description.innerHTML = await renderTemplate(templatePath('strike-description'), strike)\r\n\r\n        popup(strike.label, description)\r\n    })\r\n\r\n    action('trait-description', event => {\r\n        const strike = getStrike(event)\r\n        if (!strike) return\r\n\r\n        const { index } = event.currentTarget.dataset\r\n        const trait = strike.traits[index]\r\n        if (!trait) return\r\n\r\n        const description = game.i18n.localize(trait.description)\r\n        if (description) popup(game.i18n.localize(trait.label), description)\r\n    })\r\n\r\n    // IS OWNER\r\n    if (!actor.isOwner) return\r\n\r\n    action('action-chat', event => {\r\n        const item = getItemFromEvent(event, actor)\r\n        item?.toMessage(event, { create: true })\r\n    })\r\n\r\n    action('hero-action-chat', async event => {\r\n        await game.modules.get('pf2e-hero-actions')?.api.sendActionToChat(actor, getUuid(event))\r\n    })\r\n\r\n    action('draw-hero-action', async event => {\r\n        await game.modules.get('pf2e-hero-actions')?.api.drawHeroActions(actor)\r\n    })\r\n\r\n    action('use-hero-action', async event => {\r\n        await game.modules.get('pf2e-hero-actions')?.api.useHeroAction(actor, getUuid(event))\r\n    })\r\n\r\n    action('discard-hero-action', async event => {\r\n        await game.modules.get('pf2e-hero-actions')?.api.discardHeroActions(actor, getUuid(event))\r\n    })\r\n\r\n    action('trade-hero-action', async event => {\r\n        game.modules.get('pf2e-hero-actions')?.api.tradeHeroAction(actor)\r\n    })\r\n\r\n    action('strike-attack', event => {\r\n        const { index } = event.currentTarget.dataset\r\n        const strike = getStrike(event)\r\n        strike?.variants[index].roll({ event })\r\n    })\r\n\r\n    action(['toggle-roll-option', 'set-suboption'], event => {\r\n        const toggle = event.currentTarget.closest('.toggle')\r\n        const { domain, option, itemId } = toggle.dataset\r\n        const suboption = toggle.querySelector('select')?.value ?? null\r\n        actor.toggleRollOption(domain, option, itemId ?? null, toggle.querySelector('input').checked, suboption)\r\n    })\r\n\r\n    action(['strike-damage', 'strike-critical'], event => {\r\n        const { action } = event.currentTarget.dataset\r\n        const strike = getStrike(event)\r\n        strike?.[action === 'strike-damage' ? 'damage' : 'critical']({ event })\r\n    }).tooltipster(TOOLTIPS)\r\n\r\n    action('strike-auxiliary', event => {\r\n        if (event.currentTarget !== event.target) return\r\n\r\n        const strike = getStrike(event)\r\n        if (!strike) return\r\n\r\n        const { index } = event.currentTarget.dataset\r\n        const modular = event.currentTarget.querySelector('select')?.value ?? null\r\n\r\n        strike.auxiliaryActions?.[index]?.execute({ selection: modular })\r\n    })\r\n\r\n    action('toggle-versatile', event => {\r\n        const weapon = getStrike(event)?.item\r\n        if (!weapon) return\r\n\r\n        const target = event.currentTarget\r\n        const { value } = target.dataset\r\n        const baseType = weapon?.system.damage.damageType ?? null\r\n        const selection = target.classList.contains('selected') || value === baseType ? null : value\r\n\r\n        toggleWeaponTrait({ trait: 'versatile', weapon, selection })\r\n    }).tooltipster(TOOLTIPS)\r\n\r\n    action(\r\n        'strike-ammo',\r\n        async event => {\r\n            const weapon = getStrike(event)?.item\r\n            if (!weapon) return\r\n\r\n            const ammo = actor.items.get(event.currentTarget.value)\r\n            await weapon.update({ system: { selectedAmmoId: ammo?.id ?? null } })\r\n        },\r\n        'change'\r\n    )\r\n}\r\n\r\nfunction getHeroActionDescription(uuid) {\r\n    return game.modules.get('pf2e-hero-actions')?.api.getHeroActionDetails(uuid)\r\n}\r\n\r\nfunction getCharacterActions(actor) {\r\n    const actions = actor.itemTypes.action.filter(item => !actionsUUIDS.has(item.sourceId))\r\n    const feats = actor.itemTypes.feat.filter(item => item.actionCost)\r\n\r\n    return (\r\n        [...actions, ...feats]\r\n            // TODO maybe some day i will get back to this and give them their own place\r\n            .filter(actions => {\r\n                const traits = actions.system.traits.value\r\n                return !traits.includes('downtime') && !traits.includes('exploration')\r\n            })\r\n            .map(item => {\r\n                const actionCost = item.actionCost\r\n\r\n                return {\r\n                    id: item.id,\r\n                    type: actionCost?.type ?? 'free',\r\n                    cost: actionCost,\r\n                    name: item.name,\r\n                }\r\n            })\r\n    )\r\n}\r\n\r\nfunction getNpcActions(actor) {\r\n    return actor.itemTypes.action.map(item => {\r\n        const actionCost = item.actionCost\r\n        const actionType = actionCost?.type ?? 'passive'\r\n        const hasAura =\r\n            actionType === 'passive' &&\r\n            (item.system.traits.value.includes('aura') || !!item.system.rules.find(r => r.key === 'Aura'))\r\n\r\n        return {\r\n            id: item.id,\r\n            type: actionType,\r\n            cost: actionCost,\r\n            name: item.name,\r\n            hasDeathNote: item.system.deathNote,\r\n            hasAura,\r\n        }\r\n    })\r\n}\r\n", "import { localize, modifier, MODULE_ID, templatePath } from '../module.js'\r\nimport { calculateDegreeOfSuccess } from '../pf2e.js'\r\nimport { getUniqueTarget, RANKS } from '../shared.js'\r\n\r\nconst SKILLS = ['arcana', 'crafting', 'medicine', 'nature', 'occultism', 'religion', 'society']\r\n\r\nconst SUCCESS = {\r\n    // 0: { icon: '<i class=\"fa-solid fa-circle-xmark\"></i>', name: 'criticalFailure' },\r\n    0: { icon: '<i class=\"fa-solid fa-xmark-large\"></i><i class=\"fa-solid fa-xmark-large\"></i>', name: 'criticalFailure' },\r\n    1: { icon: '<i class=\"fa-solid fa-xmark-large\"></i>', name: 'failure' },\r\n    2: { icon: '<i class=\"fa-solid fa-check\"></i>', name: 'success' },\r\n    3: { icon: '<i class=\"fa-solid fa-check\"></i><i class=\"fa-solid fa-check\"></i>', name: 'criticalSuccess' },\r\n    // 3: { icon: '<i class=\"fa-solid fa-circle-check\"></i>', name: 'criticalSuccess' },\r\n}\r\n\r\nexport async function rollRecallKnowledges(actor) {\r\n    const roll = await new Roll('1d20').evaluate({ async: true })\r\n    const result = roll.total\r\n    const dieResult = roll.dice[0].total\r\n    const dieSuccess = dieResult === 1 ? '0' : dieResult === 20 ? '3' : ''\r\n    const lores = Object.values(actor.skills).filter(skill => skill.lore)\r\n    const target = getUniqueTarget(target => target.actor?.identificationDCs)\r\n\r\n    let data = {\r\n        dieSuccess,\r\n        dieResult,\r\n        target,\r\n        i18n: str => localize(`actions.recall-knowledge.${str}`),\r\n    }\r\n\r\n    if (target) {\r\n        const { standard, skills, lore } = target.actor.identificationDCs\r\n\r\n        let skillsDCs = standard.progression.slice()\r\n        skillsDCs.length = 4\r\n        skillsDCs = [...skillsDCs]\r\n\r\n        const loresDCs = lore.map(({ progression }) => {\r\n            let dcs = progression\r\n            dcs.length = 6\r\n            return [...dcs]\r\n        })\r\n\r\n        data.skillsDCs = skillsDCs\r\n        data.skills = skills.map(slug => {\r\n            const { mod, label, rank } = actor.skills[slug]\r\n            const total = result + mod\r\n\r\n            return {\r\n                label,\r\n                mod,\r\n                rank,\r\n                rankLabel: RANKS[rank],\r\n                total,\r\n                checks: skillsDCs.map(dc => {\r\n                    if (!dc) return `-`\r\n                    const success = calculateDegreeOfSuccess(total, dieResult, dc)\r\n                    return {\r\n                        success,\r\n                        icon: SUCCESS[success].icon,\r\n                        title: SUCCESS[success].name,\r\n                    }\r\n                }),\r\n            }\r\n        })\r\n        data.loresDCs = loresDCs\r\n        data.lores = lores.map(({ label, rank, mod }) => ({\r\n            label,\r\n            rank,\r\n            mod,\r\n            modifier: modifier(mod),\r\n        }))\r\n    } else {\r\n        data.skills = [...SKILLS.map(slug => actor.skills[slug]), ...lores].map(({ label, rank, mod }) => ({\r\n            label,\r\n            rank,\r\n            mod,\r\n            modifier: modifier(mod),\r\n        }))\r\n    }\r\n\r\n    const flavor = await renderTemplate(templatePath('chat/recall-knowledge'), data)\r\n\r\n    ChatMessage.create({\r\n        flavor,\r\n        speaker: ChatMessage.getSpeaker({ actor }),\r\n        rollMode: CONST.DICE_ROLL_MODES.BLIND,\r\n        type: CONST.CHAT_MESSAGE_TYPES.ROLL,\r\n    })\r\n}\r\n", "import { rollRecallKnowledges } from '../actions/recall-knowledge.js'\r\nimport { localize } from '../module.js'\r\nimport { unownedItemToMessage } from '../pf2e.js'\r\nimport { showItemSummary } from '../popup.js'\r\nimport { addNameTooltipListeners, deleteMacro, getMacros, onDroppedMacro } from '../shared.js'\r\nimport { createVariantDialog, getSkillLabel, SKILLS_SLUGS } from './skills.js'\r\n\r\nexport async function getExtrasData(actor) {\r\n    const { attributes } = actor\r\n    const { initiative } = attributes\r\n\r\n    return {\r\n        noMacro: localize('extras.no-macro'),\r\n        macros: getMacros(actor),\r\n        initiative: {\r\n            selected: initiative.statistic,\r\n            skills: SKILLS_SLUGS.map(slug => ({ slug, label: getSkillLabel(slug) })),\r\n        },\r\n        hasDailies: game.modules.get('pf2e-dailies')?.active,\r\n    }\r\n}\r\n\r\nexport function addExtrasListeners(el, actor, token) {\r\n    function action(action, callback, type = 'click') {\r\n        el.find(`[data-action=${action}]`).on(type, event => {\r\n            event.preventDefault()\r\n            callback(event)\r\n        })\r\n    }\r\n\r\n    action('action-description', event => {\r\n        const action = $(event.currentTarget).closest('.row')\r\n        showItemSummary(action, actor)\r\n    })\r\n\r\n    // IS OWNER\r\n    if (!actor.isOwner) return\r\n\r\n    addNameTooltipListeners(el.find('.macro'))\r\n\r\n    async function getMacro(event) {\r\n        const { uuid } = event.currentTarget.closest('.macro').dataset\r\n        return fromUuid(uuid)\r\n    }\r\n\r\n    action('delete-macro', event => deleteMacro(event, actor))\r\n\r\n    action('edit-macro', async event => {\r\n        const macro = await getMacro(event)\r\n        macro?.sheet.render(true)\r\n    })\r\n\r\n    action('use-macro', async event => {\r\n        const macro = await getMacro(event)\r\n        macro?.execute({ actor, token })\r\n    })\r\n\r\n    el.on('drop', event => onDroppedMacro(event, actor))\r\n\r\n    action('action-chat', async event => {\r\n        const { uuid } = event.currentTarget.closest('.row').dataset\r\n        const item = await fromUuid(uuid)\r\n        if (item) unownedItemToMessage(event, item, actor, { create: true })\r\n    })\r\n\r\n    el.find('input[name], select[name]').on('change', async event => {\r\n        const target = event.currentTarget\r\n        const value = target.type === 'number' ? target.valueAsNumber : target.value\r\n        await actor.update({ [target.name]: value })\r\n    })\r\n\r\n    action('roll-initiative', async event => {\r\n        await actor.initiative.roll({ event })\r\n    })\r\n\r\n    action('prepare-dailies', event => {\r\n        const dailies = game.modules.get('pf2e-dailies')\r\n        if (dailies?.active) dailies.api.openDailiesInterface(actor)\r\n    })\r\n\r\n    action('rest-for-the-night', event => {\r\n        game.pf2e.actions.restForTheNight({ actors: [actor] })\r\n    })\r\n\r\n    action('roll-recall-knowledge', event => {\r\n        rollRecallKnowledges(actor)\r\n    })\r\n\r\n    action(\r\n        'roll-aid',\r\n        async event => {\r\n            const variant = await createVariantDialog(null, 20)\r\n            const note = { text: '@UUID[Compendium.pf2e.other-effects.AHMUpMbaVkZ5A1KX]' }\r\n            if (variant !== null)\r\n                game.pf2e.actions.get('aid').use({\r\n                    event,\r\n                    actors: [actor],\r\n                    statistic: variant?.selected,\r\n                    difficultyClass: { value: variant?.dc },\r\n                    notes: [note],\r\n                })\r\n        },\r\n        'click contextmenu'\r\n    )\r\n\r\n    action(\r\n        'roll-escape',\r\n        async event => {\r\n            const variant = event.type === 'contextmenu' ? await createVariantDialog() : undefined\r\n            if (variant !== null) game.pf2e.actions.get('escape').use({ event, actors: [actor], statistic: variant?.selected })\r\n        },\r\n        'click contextmenu'\r\n    )\r\n}\r\n", "import { IdentifyItemPopup } from '../pf2e.js'\r\nimport { showItemSummary } from '../popup.js'\r\nimport { addNameTooltipListeners, deleteItem, editItem, getItemFromEvent } from '../shared.js'\r\n\r\nconst ITEMS_TYPES = {\r\n    weapon: { order: 0, label: 'PF2E.InventoryWeaponsHeader' },\r\n    armor: { order: 1, label: 'PF2E.InventoryArmorHeader' },\r\n    consumable: { order: 2, label: 'PF2E.InventoryConsumablesHeader' },\r\n    equipment: { order: 3, label: 'PF2E.InventoryEquipmentHeader' },\r\n    treasure: { order: 4, label: 'PF2E.InventoryTreasureHeader' },\r\n    backpack: { order: 5, label: 'PF2E.InventoryBackpackHeader' },\r\n}\r\n\r\nexport async function getItemsData(actor) {\r\n    const categories = {}\r\n\r\n    for (const item of actor.inventory.contents) {\r\n        categories[item.type] ??= []\r\n        categories[item.type].push(item)\r\n    }\r\n\r\n    return {\r\n        categories: Object.entries(categories)\r\n            .map(([type, items]) => {\r\n                items.sort((a, b) => a.name.localeCompare(b.name))\r\n                return { type, items, label: ITEMS_TYPES[type].label }\r\n            })\r\n            .sort((a, b) => ITEMS_TYPES[a.type].order - ITEMS_TYPES[b.type].order),\r\n    }\r\n}\r\n\r\nexport function addItemsListeners(el, actor) {\r\n    const item = el.find('.item')\r\n\r\n    addNameTooltipListeners(item)\r\n\r\n    item.find('[data-action=item-description]').on('click', async event => {\r\n        event.preventDefault()\r\n        const item = $(event.currentTarget).closest('.item')\r\n        showItemSummary(item, actor)\r\n    })\r\n\r\n    // IS OWNER\r\n    if (!actor.isOwner) return\r\n\r\n    item.find('[data-action=item-chat]').on('click', async event => {\r\n        const item = getItemFromEvent(event, actor)\r\n        item?.toMessage(event, { create: true })\r\n    })\r\n\r\n    item.on('dragstart', event => {\r\n        const target = event.target.closest('.item')\r\n        const { itemType, uuid } = target.dataset\r\n\r\n        const img = new Image()\r\n        img.src = target.querySelector('.item-img img').src\r\n        img.style.width = '32px'\r\n        img.style.height = '32px'\r\n        img.style.borderRadius = '4px'\r\n        img.style.position = 'absolute'\r\n        img.style.left = '-1000px'\r\n        document.body.append(img)\r\n\r\n        event.originalEvent.dataTransfer.setDragImage(img, 16, 16)\r\n        event.originalEvent.dataTransfer.setData(\r\n            'text/plain',\r\n            JSON.stringify({ type: 'Item', fromInventory: true, itemType, uuid })\r\n        )\r\n\r\n        target.addEventListener('dragend', () => img.remove(), { once: true })\r\n    })\r\n\r\n    el.find('.quantity input').on('change', async event => {\r\n        await getItemFromEvent(event, actor)?.update({ 'system.quantity': event.currentTarget.valueAsNumber })\r\n    })\r\n\r\n    el.find('[data-action=toggle-item-invest]').on('click', event => {\r\n        event.preventDefault()\r\n        const { itemId } = event.currentTarget.closest('.item').dataset\r\n        actor.toggleInvested(itemId)\r\n    })\r\n\r\n    el.find('[data-action=repair-item]').on('click', event => {\r\n        event.preventDefault()\r\n        const item = getItemFromEvent(event, actor)\r\n        if (item) game.pf2e.actions.repair({ item, actors: [actor] })\r\n    })\r\n\r\n    el.find('[data-action=toggle-identified]').on('click', event => {\r\n        event.preventDefault()\r\n        const item = getItemFromEvent(event, actor)\r\n        if (!item) return\r\n        if (item.isIdentified) item.setIdentificationStatus('unidentified')\r\n        else new IdentifyItemPopup(item).render(true)\r\n    })\r\n\r\n    el.find('[data-action=edit-item]').on('click', event => {\r\n        event.preventDefault()\r\n        editItem(event, actor)\r\n    })\r\n\r\n    el.find('[data-action=delete-item]').on('click', event => {\r\n        event.preventDefault()\r\n        deleteItem(event, actor)\r\n    })\r\n\r\n    el.find('[data-action=toggle-item-worn').tooltipster({\r\n        animation: null,\r\n        updateAnimation: null,\r\n        animationDuration: 0,\r\n        delay: [0, 0],\r\n        trigger: 'click',\r\n        contentAsHTML: true,\r\n        interactive: true,\r\n        arrow: false,\r\n        side: ['bottom', 'top'],\r\n        theme: 'crb-hover',\r\n        minWidth: 120,\r\n        content: '',\r\n        functionBefore: async function (tooltipster, { event, origin }) {\r\n            const item = getItemFromEvent(event, actor)\r\n            if (!item) return\r\n\r\n            const tmp = document.createElement('div')\r\n            tmp.innerHTML = await renderTemplate('systems/pf2e/templates/actors/partials/carry-type.hbs', { item })\r\n\r\n            const content = tmp.children[1]\r\n            $(content)\r\n                .find('[data-carry-type]')\r\n                .on('click', event => {\r\n                    const { carryType, handsHeld = 0, inSlot } = $(event.currentTarget).data()\r\n                    actor.adjustCarryType(item, carryType, handsHeld, inSlot)\r\n                    tooltipster.close()\r\n                })\r\n\r\n            tooltipster.content(content)\r\n        },\r\n    })\r\n}\r\n", "import { getSetting, MODULE_ID } from '../module.js'\r\nimport { showItemSummary } from '../popup.js'\r\nimport { addNameTooltipListeners, getItemFromEvent } from '../shared.js'\r\n\r\nexport async function getSpellsData(actor) {\r\n    const focusPool = actor.system.resources.focus ?? { value: 0, max: 0 }\r\n    const entries = actor.spellcasting.regular\r\n    const showTradition = getSetting('tradition')\r\n    const spells = []\r\n    const focuses = []\r\n    let hasFocusCantrips = false\r\n\r\n    for (const entry of entries) {\r\n        const entryId = entry.id\r\n        const tradition = showTradition && entry.statistic.label[0]\r\n        const data = await entry.getSheetData()\r\n        const isFocus = data.isFocusPool\r\n        const isCharge = entry.system?.prepared?.value === 'charge'\r\n        const isStaff = getProperty(entry, 'flags.pf2e-staves.staveID') !== undefined\r\n        const charges = { value: getProperty(entry, 'flags.pf2e-staves.charges') ?? 0 }\r\n\r\n        for (const slot of data.levels) {\r\n            if (!slot.active.length || slot.uses?.max === 0) continue\r\n\r\n            const slotSpells = []\r\n            const isCantrip = slot.isCantrip\r\n            const actives = slot.active.filter(x => x && x.uses?.max !== 0)\r\n\r\n            for (let slotId = 0; slotId < actives.length; slotId++) {\r\n                const { spell, expended, virtual, uses, castLevel } = actives[slotId]\r\n\r\n                slotSpells.push({\r\n                    name: spell.name,\r\n                    img: spell.img,\r\n                    tradition,\r\n                    castLevel: castLevel ?? spell.level,\r\n                    slotId,\r\n                    entryId,\r\n                    itemId: spell.id,\r\n                    inputId: data.isInnate ? spell.id : data.id,\r\n                    inputPath: isCharge\r\n                        ? 'flags.pf2e-staves.charges'\r\n                        : data.isInnate\r\n                        ? 'system.location.uses.value'\r\n                        : `system.slots.slot${slot.level}.value`,\r\n                    isCharge,\r\n                    isVirtual: virtual,\r\n                    isInnate: data.isInnate,\r\n                    isCantrip: isCantrip,\r\n                    isFocus,\r\n                    isPrepared: data.isPrepared,\r\n                    isSpontaneous: data.isSpontaneous || data.isFlexible,\r\n                    slotLevel: slot.level,\r\n                    uses: uses ?? (isCharge ? charges : slot.uses),\r\n                    expended: expended ?? (isFocus && !isCantrip ? focusPool.value <= 0 : false),\r\n                    action: spell.system.time.value,\r\n                    type: isCharge\r\n                        ? isStaff\r\n                            ? `${MODULE_ID}.spells.staff`\r\n                            : `${MODULE_ID}.spells.charges`\r\n                        : data.isInnate\r\n                        ? 'PF2E.PreparationTypeInnate'\r\n                        : data.isSpontaneous\r\n                        ? 'PF2E.PreparationTypeSpontaneous'\r\n                        : data.isFlexible\r\n                        ? 'PF2E.SpellFlexibleLabel'\r\n                        : isFocus\r\n                        ? 'PF2E.SpellFocusLabel'\r\n                        : 'PF2E.SpellPreparedLabel',\r\n                    order: isCharge ? 0 : data.isPrepared ? 1 : isFocus ? 2 : data.isInnate ? 3 : data.isSpontaneous ? 4 : 5,\r\n                })\r\n            }\r\n\r\n            if (slotSpells.length) {\r\n                if (isFocus) {\r\n                    if (isCantrip) hasFocusCantrips = true\r\n                    else {\r\n                        focuses.push(...slotSpells)\r\n                        continue\r\n                    }\r\n                }\r\n\r\n                spells[slot.level] ??= []\r\n                spells[slot.level].push(...slotSpells)\r\n            }\r\n        }\r\n    }\r\n\r\n    if (spells.length) {\r\n        const sort = getSetting('spells')\r\n            ? (a, b) => (a.order === b.order ? a.name.localeCompare(b.name) : a.order - b.order)\r\n            : (a, b) => a.name.localeCompare(b.name)\r\n        spells.forEach(entry => entry.sort(sort))\r\n    }\r\n\r\n    if (focuses.length) {\r\n        focuses.sort((a, b) => a.name.localeCompare(b.name))\r\n        spells[12] = focuses\r\n        hasFocusCantrips = false\r\n    }\r\n\r\n    const ritualData = await actor.spellcasting.ritual?.getSheetData()\r\n    const rituals = ritualData?.levels.flatMap((slot, slotId) =>\r\n        slot.active.map(({ spell }) => ({\r\n            name: spell.name,\r\n            img: spell.img,\r\n            slotId,\r\n            itemId: spell.id,\r\n            level: spell.level,\r\n            time: spell.system.time.value,\r\n        }))\r\n    )\r\n\r\n    if (spells.length || rituals?.length)\r\n        return { spells, rituals, focusPool, hasFocusCantrips, doubled: getSetting('spells-columns') }\r\n}\r\n\r\nexport function addSpellsListeners(el, actor) {\r\n    addNameTooltipListeners(el.find('.spell'))\r\n\r\n    el.find('[data-action=spell-description]').on('click', async event => {\r\n        event.preventDefault()\r\n        const spell = $(event.currentTarget).closest('.spell')\r\n        showItemSummary(spell, actor)\r\n    })\r\n\r\n    // IS OWNER\r\n    if (!actor.isOwner) return\r\n\r\n    el.find('[data-action=spell-chat]').on('click', async event => {\r\n        const item = getItemFromEvent(event, actor)\r\n        item?.toMessage(event, { create: true })\r\n    })\r\n\r\n    el.find('[data-action=toggle-pips]').on('click contextmenu', async event => {\r\n        event.preventDefault()\r\n        const change = event.type === 'click' ? 1 : -1\r\n        const points = (actor.system.resources.focus?.value ?? 0) + change\r\n        await actor.update({ 'system.resources.focus.value': points })\r\n    })\r\n\r\n    el.find('[data-action=toggle-prepared]').on('click', event => {\r\n        event.preventDefault()\r\n        const { slotLevel, slotId, entryId, expended } = $(event.currentTarget).closest('.spell').data()\r\n        const collection = actor.spellcasting.collections.get(entryId)\r\n        collection?.setSlotExpendedState(slotLevel ?? 0, slotId ?? 0, expended !== true)\r\n    })\r\n\r\n    el.find('[data-action=cast-spell]').on('click', event => {\r\n        event.preventDefault()\r\n\r\n        const { slotLevel, slotId, entryId, itemId } = $(event.currentTarget).closest('.spell').data()\r\n        const collection = actor.spellcasting.collections.get(entryId, { strict: true })\r\n        if (!collection) return\r\n\r\n        const spell = collection.get(itemId, { strict: true })\r\n        if (!spell) return\r\n\r\n        collection.entry.cast(spell, { slot: slotId, level: slotLevel })\r\n    })\r\n\r\n    el.find('[data-input-path]').on('change', async event => {\r\n        const { inputPath, entryId } = $(event.currentTarget).data()\r\n        const value = event.currentTarget.valueAsNumber\r\n        await actor.updateEmbeddedDocuments('Item', [{ _id: entryId, [inputPath]: value }])\r\n    })\r\n}\r\n", "import { isHolding } from './keybindings.js'\r\nimport { getFlag, getSetting, localize, modifier, MODULE_ID, setFlag, templatePath } from './module.js'\r\nimport { getUniqueTarget, RANKS } from './shared.js'\r\nimport { addActionsListeners, getActionsData, getActionsOptions } from './sidebars/actions.js'\r\nimport { addExtrasListeners, getExtrasData } from './sidebars/extras.js'\r\nimport { addItemsListeners, getItemsData } from './sidebars/items.js'\r\nimport { addSkillsListeners, getSkill, getSkillsData } from './sidebars/skills.js'\r\nimport { addSpellsListeners, getSpellsData } from './sidebars/spells.js'\r\n\r\nconst COVER_UUID = 'Compendium.pf2e.other-effects.I9lfZUiCwMiGogVi'\r\nconst RESOLVE_UUID = 'Compendium.pf2e.feats-srd.jFmdevE4nKevovzo'\r\n\r\nconst POSITIONS = {\r\n    left: ['left', 'right', 'top', 'bottom'],\r\n    right: ['right', 'left', 'top', 'bottom'],\r\n    top: ['top', 'bottom', 'left', 'right'],\r\n    bottom: ['bottom', 'top', 'left', 'right'],\r\n}\r\n\r\nconst ALIGNMENTS = {\r\n    G: 'fa-solid fa-face-smile-halo',\r\n    N: 'fa-solid fa-face-meh',\r\n    E: 'fa-solid fa-face-angry-horns',\r\n}\r\n\r\nconst SPEEDS = [\r\n    { type: 'land', icon: 'fa-solid fa-shoe-prints' },\r\n    { type: 'burrow', icon: 'fa-solid fa-chevrons-down' },\r\n    { type: 'climb', icon: 'fa-solid fa-spider' },\r\n    { type: 'fly', icon: 'fa-solid fa-feather' },\r\n    { type: 'swim', icon: 'fa-solid fa-person-swimming' },\r\n]\r\n\r\nconst SIDEBARS = {\r\n    actions: { getData: getActionsData, addListeners: addActionsListeners, getOptions: getActionsOptions },\r\n    items: { getData: getItemsData, addListeners: addItemsListeners },\r\n    spells: { getData: getSpellsData, addListeners: addSpellsListeners },\r\n    skills: { getData: getSkillsData, addListeners: addSkillsListeners },\r\n    extras: { getData: getExtrasData, addListeners: addExtrasListeners },\r\n}\r\n\r\nconst SAVES = {\r\n    fortitude: 'fa-solid fa-hand-fist',\r\n    reflex: 'fa-solid fa-person-running',\r\n    will: 'fa-solid fa-brain',\r\n}\r\n\r\nconst SKILLS = {\r\n    perception: 'fa-solid fa-eye',\r\n    stealth: 'fa-duotone fa-eye-slash',\r\n    athletics: 'fa-solid fa-dumbbell',\r\n}\r\n\r\nexport class HUD extends Application {\r\n    #token = null\r\n    #lastToken = null\r\n    #delay = null\r\n    #hover = false\r\n    #closing = null\r\n    #mouseevent\r\n    #mousedown = [false, false, false]\r\n    #lock = false\r\n    #softLock = false\r\n    #hoverToken = null\r\n    #deleteToken = null\r\n    #isObserved = false\r\n\r\n    constructor() {\r\n        super()\r\n\r\n        this.forceClose = () => this.close({ force: true })\r\n\r\n        this.#hoverToken = (token, hover) => {\r\n            const hoverSidebar = getSetting('chat') && $(window.document).find(':hover').filter('#sidebar').length\r\n\r\n            if (\r\n                hoverSidebar ||\r\n                this.mousedown ||\r\n                this.#lock ||\r\n                this.#softLock ||\r\n                !(token instanceof Token) ||\r\n                !token.actor?.isOfType('character', 'npc')\r\n            )\r\n                return\r\n\r\n            const transform = token.localTransform\r\n            const document = token.document\r\n            if (transform.tx !== document.x || transform.ty !== document.y) return\r\n\r\n            this.#hover = hover\r\n            if (hover && this.#token === token && this.rendered) return\r\n\r\n            if (hover && !game.keyboard.downKeys.has('ControlLeft')) {\r\n                this.#setToken(token)\r\n                if (!this.#closing) return this.render(null, null, getSetting('use-holding') === 'none' || !isHolding())\r\n                clearTimeout(this.#closing)\r\n                this.#closing = null\r\n                this.render()\r\n            } else {\r\n                this.close()\r\n            }\r\n        }\r\n\r\n        this.#mouseevent = event => {\r\n            const button = event.button\r\n            if (![0, 2].includes(button)) return\r\n\r\n            if (event.type === 'mouseup') {\r\n                this.#mousedown[button] = false\r\n                return\r\n            }\r\n\r\n            this.#mousedown[button] = true\r\n\r\n            const target = event.target\r\n            const el = this.element[0]\r\n\r\n            if (el) {\r\n                const popup = el.querySelector('.popup')\r\n                if (el.contains(target)) {\r\n                    if (popup && !popup.contains(target)) popup.remove()\r\n                    return\r\n                }\r\n                if (target.closest('.app') || target.closest('.tooltipster-base')) return\r\n                if (el.querySelector('.sidebar.extras') && target.closest('#hotbar')) return\r\n                if (popup) return popup.remove()\r\n                this.forceClose()\r\n            } else if (this.#delay) {\r\n                clearTimeout(this.#delay)\r\n                this.#delay = null\r\n            }\r\n\r\n            this.#lock = false\r\n        }\r\n\r\n        this.#deleteToken = token => {\r\n            if (this.#token && token.id === this.#token.id) this.forceClose()\r\n        }\r\n\r\n        window.addEventListener('mousedown', this.#mouseevent)\r\n        window.addEventListener('mouseup', this.#mouseevent)\r\n\r\n        Hooks.on('hoverToken', this.#hoverToken)\r\n        Hooks.on('deleteToken', this.#deleteToken)\r\n        Hooks.on('canvasPan', this.forceClose)\r\n    }\r\n\r\n    delete() {\r\n        this.forceClose()\r\n\r\n        window.removeEventListener('mousedown', this.#mouseevent)\r\n        window.removeEventListener('mouseup', this.#mouseevent)\r\n\r\n        Hooks.off('hoverToken', this.#hoverToken)\r\n        Hooks.off('deleteToken', this.#deleteToken)\r\n        Hooks.off('canvasPan', this.forceClose)\r\n    }\r\n\r\n    static get defaultOptions() {\r\n        return mergeObject(super.defaultOptions, {\r\n            popOut: false,\r\n            minimizable: false,\r\n            template: templatePath('hud'),\r\n        })\r\n    }\r\n\r\n    get mousedown() {\r\n        return this.#mousedown[0] || this.#mousedown[2]\r\n    }\r\n\r\n    get token() {\r\n        return this.#token\r\n    }\r\n\r\n    get actor() {\r\n        return this.#token?.actor\r\n    }\r\n\r\n    get hasCover() {\r\n        return this.actor?.itemTypes.effect.find(effect => effect.flags.core?.sourceId === COVER_UUID)\r\n    }\r\n\r\n    get isCharacter() {\r\n        return this.actor?.isOfType('character')\r\n    }\r\n\r\n    #setToken(token) {\r\n        if (token === this.#token) return\r\n        if (this.#token) delete this.#token.actor.apps[this.appId]\r\n        this.#token = token\r\n    }\r\n\r\n    getData() {\r\n        const token = this.#token\r\n        const actor = this.#token?.actor\r\n        if (!actor) return {}\r\n\r\n        let distance = null\r\n        const savesSetting = getSetting('saves')\r\n        const othersSetting = getSetting('others')\r\n        const isCharacter = this.isCharacter\r\n        const { attributes, saves, heroPoints, system, alignment } = actor\r\n        const { traits } = system\r\n        const {\r\n            hp,\r\n            sp = { max: 0, value: 0 },\r\n            resolve,\r\n            ac,\r\n            shield,\r\n            speed,\r\n            dying,\r\n            wounded,\r\n            resistances,\r\n            weaknesses,\r\n            immunities,\r\n        } = attributes\r\n        const useStamina = game.settings.get('pf2e', 'staminaVariant')\r\n        const isObserver = this.#isObserved\r\n        const showDistance = getSetting('distance')\r\n\r\n        if (showDistance === 'all' || (showDistance === 'self' && isObserver)) {\r\n            const unitSplit = getSetting('unit').split(',')\r\n            const multiplier = Number(unitSplit[0]?.trim()) || 1\r\n            const unit = unitSplit[1]?.trim() || game.system.gridUnits\r\n            const decimals = Number(unitSplit[2]?.trim()) || 0\r\n            const selected = canvas.tokens.controlled\r\n\r\n            let isTarget = false\r\n            let target = selected.length === 1 ? selected[0] : null\r\n\r\n            if (!target || target === token) {\r\n                target = getUniqueTarget()\r\n                isTarget = true\r\n            }\r\n\r\n            if (target && target !== token) {\r\n                distance = {\r\n                    unit,\r\n                    icon: isTarget ? '<i class=\"fa-solid fa-crosshairs-simple\"></i>' : '<i class=\"fa-solid fa-expand\"></i>',\r\n                    range: (token.distanceTo(target) * multiplier).toFixed(decimals),\r\n                }\r\n            }\r\n        }\r\n\r\n        let status\r\n        if (!isObserver || getSetting('see-status')) {\r\n            const statuses = getSetting('status')\r\n                .split(',')\r\n                .map(x => x.trim())\r\n                .filter(Boolean)\r\n\r\n            if (statuses.length) {\r\n                const max = hp.max + (useStamina ? sp.max : 0)\r\n                const current = hp.value + (useStamina ? sp.value : 0)\r\n                const ratio = current / max\r\n                const pick = Math.ceil(ratio * statuses.length)\r\n\r\n                status = {\r\n                    hue: ratio * ratio * 122 + 3,\r\n                    value: pick === 0 ? game.i18n.localize('EFFECT.StatusDead') : statuses.at(pick - 1),\r\n                }\r\n            }\r\n        }\r\n\r\n        if (!isObserver) {\r\n            return {\r\n                status,\r\n                distance,\r\n                tokenId: token.id,\r\n            }\r\n        }\r\n\r\n        function toInfo(str) {\r\n            return `<li>${str.trim()}</li>`\r\n        }\r\n\r\n        function sort(a, b) {\r\n            return a.localeCompare(b)\r\n        }\r\n\r\n        const languages = actor.system.traits?.languages?.value\r\n            .map(x => game.i18n.localize(CONFIG.PF2E.languages[x]))\r\n            .filter(Boolean)\r\n            .sort(sort)\r\n            .map(toInfo)\r\n            .join('')\r\n\r\n        const senses = isCharacter ? traits.senses.map(x => x.label) : traits.senses.value.split(',').filter(Boolean)\r\n\r\n        function toIWR(category, header) {\r\n            if (!category.length) return ''\r\n            return (\r\n                `<li>${game.i18n.localize(header)}<ul>` +\r\n                category.map(x => toInfo(x.label.replace('-', ' ').titleCase())).join('') +\r\n                '</ul></li>'\r\n            )\r\n        }\r\n\r\n        const speeds = SPEEDS.map(({ type, icon }, index) => ({\r\n            index,\r\n            icon,\r\n            label: game.i18n.localize(CONFIG.PF2E.speedTypes[type] ?? 'PF2E.SpeedTypesLand'),\r\n            value: (type === 'land' ? speed.total : speed.otherSpeeds.find(s => s.type === type)?.total) || 0,\r\n        }))\r\n\r\n        const selectedSpeed = getFlag(actor, `speeds.selected.${game.user.id}`) || 0\r\n        const mainSpeed = speeds.splice(selectedSpeed, 1)[0]\r\n\r\n        let otherSpeeds = speeds\r\n            .map(({ value, label, index }) => `<a data-index=\"${index}\"><li>${label}: ${value}</li></a>`)\r\n            .join('')\r\n        if (speed.details) otherSpeeds += `<li>${game.i18n.localize('PF2E.DetailsHeading')}: ${speed.details}</li>`\r\n\r\n        const showDeath = getSetting('show-death')\r\n        const showRanks = getSetting('ranks')\r\n\r\n        function getStatistic(stat, type, icons) {\r\n            const slug = stat.slug\r\n            const value = type === 'bonus' ? modifier(stat.mod) : stat.dc.value\r\n            return { slug, value, label: stat.label, icon: icons[slug], rank: showRanks && RANKS[stat.rank] }\r\n        }\r\n\r\n        return {\r\n            titles: {\r\n                actions: `${MODULE_ID}.actions.title`,\r\n                items: `${MODULE_ID}.items.title`,\r\n                spells: `${MODULE_ID}.spells.title`,\r\n                skills: `${MODULE_ID}.skills.title`,\r\n                extras: `${MODULE_ID}.extras.title`,\r\n            },\r\n            distance,\r\n            status,\r\n            isOwner: token.isOwner,\r\n            isObserver,\r\n            tokenId: token.id,\r\n            name: token.document.name,\r\n            hp,\r\n            sp: useStamina ? sp : { max: 0 },\r\n            ac: ac.value,\r\n            hero: heroPoints,\r\n            dying,\r\n            wounded,\r\n            shield,\r\n            resolve,\r\n            alignment: {\r\n                value: alignment,\r\n                icon: ALIGNMENTS[alignment.at(-1)],\r\n            },\r\n            level: actor.level,\r\n            isCharacter,\r\n            showDeathLine: isCharacter && (showDeath === 'always' || dying.value || wounded.value),\r\n            hasCover: this.hasCover,\r\n            saves:\r\n                savesSetting !== 'none' &&\r\n                ['fortitude', 'reflex', 'will'].map(slug => getStatistic(saves[slug], savesSetting, SAVES)),\r\n            others:\r\n                othersSetting !== 'none' &&\r\n                ['perception', 'stealth', 'athletics'].map(slug => getStatistic(getSkill(slug, actor), othersSetting, SKILLS)),\r\n            speeds: {\r\n                main: mainSpeed,\r\n                others: otherSpeeds,\r\n            },\r\n            iwr:\r\n                toIWR(immunities, 'PF2E.ImmunitiesLabel') +\r\n                toIWR(weaknesses, 'PF2E.WeaknessesLabel') +\r\n                toIWR(resistances, 'PF2E.ResistancesLabel'),\r\n            senses: senses.map(toInfo).join(''),\r\n            languages,\r\n            hasSpells: actor.spellcasting.some(x => x.category !== 'items'),\r\n            hasItems: actor.inventory.size,\r\n        }\r\n    }\r\n\r\n    #close(options) {\r\n        this.#setToken(null)\r\n        this.#hover = false\r\n        this.#lock = false\r\n        this.#softLock = false\r\n        this.#isObserved = false\r\n\r\n        if (this.#delay !== null) {\r\n            clearTimeout(this.#delay)\r\n            this.#delay = null\r\n        }\r\n\r\n        const states = Application.RENDER_STATES\r\n        if (!options.force && ![states.RENDERED, states.ERROR].includes(this._state)) return\r\n\r\n        this._state = states.CLOSING\r\n\r\n        let el = this.element\r\n        if (!el) return (this._state = states.CLOSED)\r\n        el.css({ minHeight: 0 })\r\n\r\n        for (let cls of this.constructor._getInheritanceChain()) {\r\n            Hooks.call(`close${cls.name}`, this, el)\r\n        }\r\n\r\n        el.remove()\r\n\r\n        this._element = null\r\n        this._state = states.CLOSED\r\n        delete ui.windows[this.appId]\r\n    }\r\n\r\n    close(options = {}) {\r\n        if (options.force) return this.#close(options)\r\n\r\n        this.#closing = setTimeout(() => {\r\n            this.#closing = null\r\n            if (this.#hover) return\r\n            this.#close(options)\r\n        })\r\n    }\r\n\r\n    async _render(force = false, options = {}) {\r\n        let sidebarType\r\n        let scrollTop\r\n\r\n        if (this.#lastToken === this.#token) {\r\n            const sidebar = this.element.find('> .sidebar')[0]\r\n            if (sidebar) {\r\n                sidebarType = sidebar.dataset.type\r\n                scrollTop = sidebar.scrollTop\r\n            }\r\n        }\r\n\r\n        await super._render(force, options)\r\n        ui.windows[this.appId] = this\r\n\r\n        if (sidebarType) {\r\n            const sidebar = await this.#openSidebar(sidebarType)\r\n            if (scrollTop > 0) sidebar.scrollTop = scrollTop\r\n        }\r\n\r\n        this.#lastToken = this.#token\r\n    }\r\n\r\n    render(force, options, useDelay) {\r\n        const token = this.#token\r\n        const actor = token?.actor\r\n        if (!actor) return\r\n\r\n        const holding = isHolding()\r\n        const holdingSetting = getSetting('use-holding')\r\n        const isParty = actor.system.details.alliance === 'party'\r\n\r\n        if (game.user.isGM && holdingSetting === 'half' && !holding) this.#isObserved = false\r\n        else this.#isObserved = token.isOwner || (getSetting('observer') && (token.observer || (isParty && getSetting('party'))))\r\n\r\n        if (holdingSetting !== 'none' && !holding && (holdingSetting === 'all' || this.#isObserved)) return\r\n\r\n        if (!useDelay) return super.render(true)\r\n\r\n        const delay = getSetting('delay')\r\n        if (!delay) super.render(true)\r\n        else this.#delay = setTimeout(() => super.render(true), delay)\r\n    }\r\n\r\n    _injectHTML(html) {\r\n        $('body').append(html)\r\n        this._element = html\r\n    }\r\n\r\n    setPosition() {\r\n        const token = this.#token\r\n        if (!token) return\r\n\r\n        const element = this.element[0]\r\n        const scale = token.worldTransform.a\r\n        const hud = element.getBoundingClientRect()\r\n        const targetCoords = canvas.clientCoordinatesFromCanvas(token.document._source)\r\n        const target = {\r\n            x: targetCoords.x,\r\n            y: targetCoords.y,\r\n            width: token.hitArea.width * scale,\r\n            height: token.hitArea.height * scale,\r\n            get right() {\r\n                return this.x + this.width\r\n            },\r\n            get bottom() {\r\n                return this.y + this.height\r\n            },\r\n        }\r\n\r\n        let coords\r\n\r\n        const positions = this.#isObserved\r\n            ? POSITIONS[getSetting('position')].slice()\r\n            : POSITIONS[getSetting('small-position')].slice()\r\n\r\n        while (positions.length && !coords) {\r\n            const position = positions.shift()\r\n\r\n            if (position === 'left') {\r\n                coords = {\r\n                    x: target.x - hud.width,\r\n                    y: postionFromTargetY(hud, target),\r\n                }\r\n                if (coords.x < 0) coords = undefined\r\n            } else if (position === 'right') {\r\n                coords = {\r\n                    x: target.right,\r\n                    y: postionFromTargetY(hud, target),\r\n                }\r\n                if (coords.x + hud.width > window.innerWidth) coords = undefined\r\n            } else if (position === 'top') {\r\n                coords = {\r\n                    x: postionFromTargetX(hud, target),\r\n                    y: target.y - hud.height,\r\n                }\r\n                if (coords.y < 0) coords = undefined\r\n            } else if (position === 'bottom') {\r\n                coords = {\r\n                    x: postionFromTargetX(hud, target),\r\n                    y: target.bottom,\r\n                }\r\n                if (coords.y + hud.height > window.innerHeight) coords = undefined\r\n            }\r\n        }\r\n\r\n        if (coords) {\r\n            element.style.left = `${coords.x}px`\r\n            element.style.top = `${coords.y}px`\r\n        }\r\n\r\n        return coords\r\n    }\r\n\r\n    activateListeners(html) {\r\n        const token = this.#token\r\n        const actor = token?.actor\r\n        if (!actor) return\r\n\r\n        const isOwner = token.isOwner\r\n        actor.apps[this.appId] = this\r\n\r\n        if (getSetting('tooltips')) {\r\n            html.find('.inner [data-tooltip]').attr('data-tooltip', '')\r\n        }\r\n\r\n        html.on('mousedown', () => this.bringToTop())\r\n\r\n        html.on('mouseenter', () => {\r\n            if (!html.find('.inner').length) return\r\n            this.#hover = true\r\n            this.#softLock = true\r\n        })\r\n\r\n        html.on('mouseleave', () => {\r\n            this.#softLock = false\r\n            if (this.#lock) return\r\n            this.#hover = false\r\n            this.close()\r\n        })\r\n\r\n        html.on('dragover', () => {\r\n            if (token.isOwner && html.find('> .sidebar.extras').length && !html.find('.popup').length) return\r\n\r\n            html.css('opacity', 0.1)\r\n            html.css('pointerEvents', 'none')\r\n\r\n            window.addEventListener(\r\n                'dragend',\r\n                () => {\r\n                    html.css('opacity', 1)\r\n                    html.css('pointerEvents', '')\r\n                },\r\n                { once: true }\r\n            )\r\n        })\r\n\r\n        const infos = html.find('[data-action=show-info]')\r\n        infos.tooltipster({\r\n            position: ['top', 'bottom', 'left', 'right'],\r\n            theme: 'crb-hover',\r\n            arrow: false,\r\n            animationDuration: 0,\r\n            contentAsHTML: true,\r\n            trigger: 'click',\r\n        })\r\n\r\n        const infosToLeave = isOwner ? infos.filter(':not(.speeds)') : infos\r\n        infosToLeave.on('mouseleave', event => {\r\n            $(event.currentTarget).tooltipster('hide')\r\n        })\r\n\r\n        html.find('.inner .footer [data-type]').on('click', this.#openSidebar.bind(this))\r\n\r\n        // IS OWNER\r\n        if (!isOwner) return\r\n\r\n        html.find('input').on('change', async event => {\r\n            const target = event.currentTarget\r\n            const value = target.valueAsNumber\r\n            const attr = target.name\r\n\r\n            target.blur()\r\n\r\n            if (attr !== 'shield.value') await actor.update({ [attr]: value })\r\n            else await actor.heldShield.update({ 'system.hp.value': value })\r\n        })\r\n\r\n        html.find('[data-action=toggle-hero]').on('click contextmenu', event => {\r\n            event.preventDefault()\r\n            const { max, value } = actor.heroPoints\r\n            const change = event.type === 'click' ? 1 : -1\r\n            const newValue = Math.clamped(value + change, 0, max)\r\n            if (newValue !== value) actor.update({ 'system.resources.heroPoints.value': newValue })\r\n        })\r\n\r\n        html.find('[data-action=raise-shield]').on('click', event => {\r\n            event.preventDefault()\r\n            game.pf2e.actions.raiseAShield({ actors: [actor] })\r\n        })\r\n\r\n        html.find('[data-action=take-cover]').on('click', async event => {\r\n            event.preventDefault()\r\n\r\n            const source = (await fromUuid(COVER_UUID)).toObject()\r\n            setProperty(source, 'flags.core.sourceId', COVER_UUID)\r\n\r\n            const hasCover = this.hasCover\r\n            if (this.hasCover) await hasCover.delete()\r\n            else await actor.createEmbeddedDocuments('Item', [source])\r\n        })\r\n\r\n        html.find('[data-action=roll-save]').on('click', event => {\r\n            event.preventDefault()\r\n            const save = event.currentTarget.dataset.save\r\n            actor.saves[save].roll({ event })\r\n        })\r\n\r\n        html.find('[data-action=roll-other]').on('click', event => {\r\n            event.preventDefault()\r\n            const slug = event.currentTarget.dataset.slug\r\n            if (slug !== 'athletics') {\r\n                const { ctrlKey, metaKey, shiftKey } = event\r\n                event = new MouseEvent('click', { ctrlKey: !ctrlKey, metaKey, shiftKey })\r\n            }\r\n            getSkill(slug, actor).roll({ event })\r\n        })\r\n\r\n        html.find('[data-action=recovery-check]').on('click', event => {\r\n            event.preventDefault()\r\n            actor.rollRecovery(event)\r\n        })\r\n\r\n        html.find('[data-action=toggle-dying], [data-action=toggle-wounded]').on('click contextmenu', event => {\r\n            event.preventDefault()\r\n\r\n            const condition = event.currentTarget.dataset.action === 'toggle-dying' ? 'dying' : 'wounded'\r\n            const max = actor.system.attributes[condition]?.max\r\n\r\n            if (!max) return\r\n            if (event.type === 'click') actor.increaseCondition(condition, { max })\r\n            else actor.decreaseCondition(condition)\r\n        })\r\n\r\n        html.find('[data-action=use-resolve]').on('click', event => {\r\n            event.preventDefault()\r\n            useResolve(actor)\r\n        })\r\n\r\n        infos\r\n            .filter('.speeds')\r\n            .tooltipster('option', 'interactive', true)\r\n            .tooltipster('option', 'functionReady', (tooltipster, { origin, tooltip }) => {\r\n                this.#lock = true\r\n                tooltip.querySelectorAll('[data-index]').forEach(speed => {\r\n                    speed.addEventListener('click', async event => {\r\n                        event.preventDefault()\r\n                        await setFlag(actor, `speeds.selected.${game.user.id}`, Number(speed.dataset.index))\r\n                    })\r\n                })\r\n            })\r\n            .tooltipster('option', 'functionAfter', () => {\r\n                if (html.find('> .sidebar').length) return\r\n                this.#lock = false\r\n            })\r\n    }\r\n\r\n    async #openSidebar(type) {\r\n        type = typeof type === 'string' ? type : type.currentTarget.dataset.type\r\n\r\n        let element = this.element\r\n        let sidebar = element.find('> .sidebar')\r\n        const action = sidebar[0]?.dataset.type\r\n\r\n        sidebar.remove()\r\n        element.find('.inner .footer [data-type]').removeClass('active')\r\n\r\n        if (action === type) {\r\n            this.#lock = false\r\n            return\r\n        }\r\n\r\n        const token = this.#token\r\n        const actor = token.actor\r\n        const { getData, addListeners, getOptions } = SIDEBARS[type]\r\n        const data = await getData(actor, token)\r\n        const { classList = [] } = (getOptions && (await getOptions(actor, token))) || {}\r\n        if (!data) return ui.notifications.warn(localize(`${type}.empty`, { name: this.#token.name }))\r\n\r\n        data.isGM = game.user.isGM\r\n        data.isCharacter = this.isCharacter\r\n        data.isOwner = actor.isOwner\r\n\r\n        this.#lock = true\r\n\r\n        element.find(`.inner .footer [data-type=${type}]`).addClass('active')\r\n        element = element[0]\r\n\r\n        const tmp = document.createElement('div')\r\n        tmp.innerHTML = await renderTemplate(templatePath(`sidebars/${type}`), data)\r\n\r\n        sidebar = tmp.firstElementChild\r\n        sidebar.classList.add('sidebar', ...classList)\r\n        if (!getSetting('scrollbar')) sidebar.classList.add('no-scrollbar')\r\n        if (data.doubled) sidebar.classList.add('doubled')\r\n        sidebar.dataset.type = type\r\n        sidebar.style.setProperty('--max-height', getSetting('height').trim() || '100%')\r\n        this.element.append(sidebar)\r\n\r\n        const rect = sidebar.getBoundingClientRect()\r\n        const target = element.getBoundingClientRect()\r\n\r\n        let left = target.x - rect.width\r\n        if (left < 0) left = target.right\r\n\r\n        const elPadding = parseInt(window.getComputedStyle(element).padding)\r\n        let top = postionFromTargetY(rect, target, elPadding)\r\n\r\n        sidebar.style.left = `${left}px`\r\n        sidebar.style.top = `${top}px`\r\n\r\n        addListeners($(sidebar), actor, token)\r\n\r\n        return sidebar\r\n    }\r\n}\r\n\r\nfunction postionFromTargetY(el, target, margin = 0) {\r\n    let y = target.y + target.height / 2 - el.height / 2\r\n    if (y + el.height > window.innerHeight) y = window.innerHeight - el.height - margin\r\n    if (y < 0) y = margin\r\n    return y\r\n}\r\n\r\nfunction postionFromTargetX(el, target) {\r\n    let x = target.x + target.width / 2 - el.width / 2\r\n    if (x + el.width > window.innerWidth) y = window.innerWidth - el.width\r\n    if (x < 0) x = 0\r\n    return x\r\n}\r\n\r\nasync function useResolve(actor) {\r\n    function toChat(content) {\r\n        ChatMessage.create({\r\n            user: game.user.id,\r\n            content,\r\n            speaker: ChatMessage.getSpeaker({ actor }),\r\n        })\r\n    }\r\n\r\n    const { name, attributes } = actor\r\n    const { sp, resolve } = attributes\r\n    const fullStamina = localize('hud.resolve.full', { name })\r\n    const noResolve = game.i18n.format('PF2E.Actions.SteelYourResolve.NoStamina', { name })\r\n\r\n    if (sp.value === sp.max) return ui.notifications.warn(fullStamina)\r\n    if (resolve.value < 1) return ui.notifications.warn(noResolve)\r\n\r\n    const hasSteel = actor.itemTypes.feat.find(item => item.sourceId === RESOLVE_UUID)\r\n    const content = await renderTemplate(templatePath('dialogs/resolve'), {\r\n        hasSteel,\r\n        i18n: str => localize(`hud.resolve.${str}`),\r\n    })\r\n\r\n    new Dialog({\r\n        title: localize('hud.resolve.title'),\r\n        content,\r\n        buttons: {\r\n            yes: {\r\n                icon: \"<i class='fas fa-check'></i>\",\r\n                label: localize('hud.resolve.yes'),\r\n                callback: async html => {\r\n                    const { attributes } = actor\r\n                    const { sp, resolve } = attributes\r\n\r\n                    if (sp.value === sp.max) return toChat(fullStamina)\r\n                    if (resolve.value < 1) return toChat(noResolve)\r\n\r\n                    const selected = html.find('input:checked').val()\r\n                    const ratio = `${sp.value}/${sp.max}`\r\n\r\n                    if (selected === 'breather') {\r\n                        toChat(localize('hud.resolve.breather.used', { name, ratio }))\r\n                        await actor.update({\r\n                            'system.attributes.sp.value': sp.max,\r\n                            'system.attributes.resolve.value': resolve.value - 1,\r\n                        })\r\n                    } else {\r\n                        toChat(game.i18n.format('PF2E.Actions.SteelYourResolve.RecoverStamina', { name, ratio }))\r\n                        const newSP = sp.value + Math.floor(sp.max / 2)\r\n                        await actor.update({\r\n                            'system.attributes.sp.value': Math.min(newSP, sp.max),\r\n                            'system.attributes.resolve.value': resolve.value - 1,\r\n                        })\r\n                    }\r\n                },\r\n            },\r\n            no: {\r\n                icon: \"<i class='fas fa-times'></i>\",\r\n                label: localize('hud.resolve.no'),\r\n            },\r\n        },\r\n    }).render(true)\r\n}\r\n", "import { HUD } from './hud.js'\r\n\r\nexport const MODULE_ID = 'pf2e-token-hud'\r\n\r\nlet hud = null\r\nexport function getHud() {\r\n    return hud\r\n}\r\n\r\nexport function enableModule(enabled) {\r\n    if (enabled && !hud) {\r\n        hud = new HUD()\r\n    } else if (!enabled && hud) {\r\n        hud.delete()\r\n        hud = null\r\n    }\r\n}\r\n\r\nexport function getSetting(setting) {\r\n    return game.settings.get(MODULE_ID, setting)\r\n}\r\n\r\nexport function localize(...args) {\r\n    const data = args.at(-1)\r\n    const useFormat = typeof data === 'object'\r\n\r\n    const keys = useFormat ? args.slice(0, -1) : args\r\n    keys.unshift(MODULE_ID)\r\n\r\n    return game.i18n[useFormat ? 'format' : 'localize'](keys.join('.'), data)\r\n}\r\n\r\nexport function hasFeat(actor, uuid) {\r\n    return actor.itemTypes.feat.some(feat => feat.sourceId === uuid)\r\n}\r\n\r\nexport function templatePath(template) {\r\n    return `modules/${MODULE_ID}/templates/${template}.hbs`\r\n}\r\n\r\nexport function modifier(mod) {\r\n    return mod >= 0 ? `+${mod}` : mod\r\n}\r\n\r\nexport function getFlag(doc, flag) {\r\n    return doc.getFlag(MODULE_ID, flag)\r\n}\r\n\r\nexport function setFlag(doc, flag, value) {\r\n    return doc.setFlag(MODULE_ID, flag, value)\r\n}\r\n", "import { getHud, getSetting, MODULE_ID } from './module.js'\r\n\r\nlet holding = false\r\n\r\nexport function registerKeybindings() {\r\n    register('hold', {\r\n        onDown: () => {\r\n            holding = true\r\n            if (getSetting('use-holding') !== 'none') getHud().render()\r\n        },\r\n        onUp: () => {\r\n            holding = false\r\n        },\r\n    })\r\n}\r\n\r\nexport function isHolding() {\r\n    return holding\r\n}\r\n\r\nfunction path(bind, key) {\r\n    return `${MODULE_ID}.keybinds.${bind}.${key}`\r\n}\r\n\r\nfunction register(name, extras = {}) {\r\n    game.keybindings.register(MODULE_ID, name, {\r\n        name: path(name, 'name'),\r\n        hint: path(name, 'hint'),\r\n        precedence: CONST.KEYBINDING_PRECEDENCE.PRIORITY,\r\n        ...extras,\r\n    })\r\n}\r\n", "import { enableModule, localize, MODULE_ID } from './module.js'\r\n\r\nexport function registerSettings() {\r\n    const isGM = game.data.users.find(x => x._id === game.data.userId).role >= CONST.USER_ROLES.GAMEMASTER\r\n\r\n    /**\r\n     * GM\r\n     */\r\n    const statuses = ['first', 'second', 'third', 'fourth'].map(x => localize(`settings.status.statuses.${x}`)).join(', ')\r\n    register('status', String, statuses, { scope: 'world' })\r\n\r\n    register('party', Boolean, false, { scope: 'world' })\r\n\r\n    /**\r\n     * CLIENT\r\n     */\r\n    register('enabled', Boolean, true, { onChange: enableModule })\r\n\r\n    register('position', String, 'right', {\r\n        choices: {\r\n            left: path('position', 'choices.left'),\r\n            right: path('position', 'choices.right'),\r\n            top: path('position', 'choices.top'),\r\n            bottom: path('position', 'choices.bottom'),\r\n        },\r\n    })\r\n\r\n    register('small-position', String, 'top', {\r\n        choices: {\r\n            left: path('position', 'choices.left'),\r\n            right: path('position', 'choices.right'),\r\n            top: path('position', 'choices.top'),\r\n            bottom: path('position', 'choices.bottom'),\r\n        },\r\n    })\r\n\r\n    register('delay', Number, 250, {\r\n        range: {\r\n            min: 0,\r\n            max: 2000,\r\n            step: 50,\r\n        },\r\n    })\r\n\r\n    register('use-holding', String, 'none', {\r\n        hint: path('use-holding', isGM ? 'choices.gm.hint' : 'choices.player.hint'),\r\n        choices: {\r\n            none: path('use-holding', 'choices.none'),\r\n            half: path('use-holding', isGM ? 'choices.gm.half' : 'choices.player.half'),\r\n            all: path('use-holding', isGM ? 'choices.gm.all' : 'choices.player.all'),\r\n        },\r\n    })\r\n\r\n    register('observer', Boolean, true)\r\n\r\n    register('see-status', Boolean, false)\r\n\r\n    register('chat', Boolean, true)\r\n\r\n    // tooltip\r\n\r\n    register('saves', String, 'bonus', {\r\n        choices: {\r\n            none: path('saves', 'choices.none'),\r\n            bonus: path('saves', 'choices.bonus'),\r\n            dc: path('saves', 'choices.dc'),\r\n        },\r\n    })\r\n\r\n    register('others', String, 'none', {\r\n        choices: {\r\n            none: path('saves', 'choices.none'),\r\n            bonus: path('saves', 'choices.bonus'),\r\n            dc: path('saves', 'choices.dc'),\r\n        },\r\n    })\r\n\r\n    register('ranks', Boolean, false)\r\n\r\n    register('show-death', String, 'always', {\r\n        choices: {\r\n            none: path('show-death', 'choices.none'),\r\n            always: path('show-death', 'choices.always'),\r\n            only: path('show-death', 'choices.only'),\r\n        },\r\n    })\r\n\r\n    register('tooltips', Boolean, false)\r\n\r\n    // distance\r\n\r\n    register('distance', String, 'all', {\r\n        choices: {\r\n            none: path('distance', 'choices.none'),\r\n            self: path('distance', 'choices.self'),\r\n            all: path('distance', 'choices.all'),\r\n        },\r\n    })\r\n\r\n    register('unit', String, '')\r\n\r\n    // sidebar\r\n\r\n    register('height', String, '')\r\n\r\n    register('scrollbar', Boolean, true)\r\n\r\n    register('spells-columns', Boolean, false)\r\n\r\n    register('skills-columns', Boolean, false)\r\n\r\n    // actions\r\n\r\n    register('actions', String, 'split', {\r\n        choices: {\r\n            name: path('actions', 'choices.name'),\r\n            type: path('actions', 'choices.type'),\r\n            split: path('actions', 'choices.split'),\r\n        },\r\n    })\r\n\r\n    register('actions-colors', Boolean, true)\r\n\r\n    // spells\r\n\r\n    register('spells', Boolean, false)\r\n\r\n    register('tradition', Boolean, false)\r\n\r\n    // skills\r\n\r\n    register('untrained', Boolean, true)\r\n}\r\n\r\nexport function renderSettingsConfig(_, html) {\r\n    const tab = html.find(`.tab[data-tab=${MODULE_ID}]`)\r\n\r\n    function beforeGroup(name, key, dom = 'h3') {\r\n        const localized = localize(`menu.${key}`)\r\n        tab.find(`[name=\"${MODULE_ID}.${name}\"]`).closest('.form-group').before(`<${dom}>${localized}</${dom}>`)\r\n    }\r\n\r\n    if (game.user.isGM) {\r\n        beforeGroup('enabled', 'client.header', 'h2')\r\n    }\r\n\r\n    beforeGroup('saves', 'client.tooltip')\r\n    beforeGroup('distance', 'client.distance')\r\n    beforeGroup('height', 'client.sidebar')\r\n    beforeGroup('actions', 'client.actions')\r\n    beforeGroup('spells', 'client.spells')\r\n    beforeGroup('untrained', 'client.skills')\r\n}\r\n\r\nfunction path(setting, key) {\r\n    return `${MODULE_ID}.settings.${setting}.${key}`\r\n}\r\n\r\nfunction register(name, type, defValue, extra = {}) {\r\n    game.settings.register(MODULE_ID, name, {\r\n        name: path(name, 'name'),\r\n        hint: path(name, 'hint'),\r\n        scope: 'client',\r\n        config: true,\r\n        type,\r\n        default: defValue,\r\n        ...extra,\r\n    })\r\n}\r\n", "import { registerKeybindings } from './keybindings.js'\r\nimport { enableModule, getSetting, localize, MODULE_ID, templatePath } from './module.js'\r\nimport { registerSettings, renderSettingsConfig } from './settings.js'\r\nimport { deleteMacro, getMacros, onDroppedMacro } from './shared.js'\r\n\r\nHooks.once('setup', () => {\r\n    registerSettings()\r\n    registerKeybindings()\r\n})\r\n\r\nHooks.once('ready', () => {\r\n    if (getSetting('enabled')) enableModule(true)\r\n})\r\n\r\nHooks.on('renderSettingsConfig', renderSettingsConfig)\r\n\r\nHooks.on('getActorDirectoryEntryContext', (_, data) => {\r\n    data.unshift({\r\n        icon: '<i class=\"fa-solid fa-code\"></i>',\r\n        name: `${MODULE_ID}.actor.macros.contextmenu`,\r\n        condition: html => {\r\n            const { documentId } = html.data()\r\n            return getSetting('enabled') && game.actors.get(documentId)?.isOwner\r\n        },\r\n        callback: html => {\r\n            const { documentId } = html.data()\r\n            openMacrosDialog(documentId)\r\n        },\r\n    })\r\n})\r\n\r\nclass DataDialog extends Dialog {\r\n    async getData(options = {}) {\r\n        const data = super.getData(options)\r\n        if (typeof data.content === 'function') data.content = await data.content()\r\n        return data\r\n    }\r\n}\r\n\r\nfunction openMacrosDialog(actorId) {\r\n    const actor = game.actors.get(actorId)\r\n    if (!actor) return\r\n\r\n    const dialog = new DataDialog(\r\n        {\r\n            title: `${actor.name} - ${localize('actor.macros.title')}`,\r\n            content: async () => {\r\n                const macros = getMacros(actor) ?? []\r\n                return renderTemplate(templatePath('dialogs/macros'), {\r\n                    macros,\r\n                    noMacro: localize('extras.no-macro'),\r\n                })\r\n            },\r\n            buttons: {},\r\n            render: html => {\r\n                actor.apps[dialog.appId] = dialog\r\n                html.on('drop', event => onDroppedMacro(event, actor))\r\n                html.find('[data-action=delete-macro]').on('click', event => deleteMacro(event, actor))\r\n            },\r\n            close: () => {\r\n                delete actor.apps[dialog.appId]\r\n            },\r\n        },\r\n        { height: 'auto' }\r\n    ).render(true)\r\n}\r\n"],
  "mappings": "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",
  "names": ["RANKS", "getItemSummary", "el", "actor", "dataset", "item", "data", "description", "__name", "addNameTooltipListeners", "event", "target", "width", "name", "editItem", "getItemFromEvent", "deleteItem", "localize", "itemId", "getMacros", "getFlag", "uuid", "onDroppedMacro", "type", "flag", "macros", "setFlag", "deleteMacro", "index", "getUniqueTarget", "condition", "targets", "dcAdjustments", "dcByLevel", "MAGIC_TRADITIONS", "actionImgMap", "getActionIcon", "action", "fallback", "actionImgMap", "value", "sanitized", "__name", "toggleWeaponTrait", "weapon", "trait", "selection", "item", "__name", "adjustDC", "dc", "adjustment", "dcAdjustments", "rarityToDCAdjustment", "rarity", "adjustDCByRarity", "calculateDC", "level", "proficiencyWithoutLevel", "pwlSetting", "dcByLevel", "getDcRarity", "getMagicTraditions", "traits", "t", "setHasElement", "MAGIC_TRADITIONS", "getIdentifyMagicDCs", "baseDC", "notMatchingTraditionModifier", "result", "traditions", "key", "getItemIdentificationDCs", "objectHasKey", "obj", "set", "value", "IdentifyItemPopup", "dcs", "$form", "event", "$button", "itemImg", "itemName", "identifiedName", "skills", "row", "slug", "name", "actionOption", "content", "_event", "formData", "status", "unownedItemToMessage", "actor", "rollMode", "create", "data", "template", "token", "nearestItem", "ChatMessagePF2e", "contextualData", "templateData", "chatData", "u", "DegreeOfSuccess", "DEGREE_ADJUSTMENT_AMOUNTS", "adjustDegreeOfSuccess", "amount", "degreeOfSuccess", "adjustDegreeByDieValue", "dieResult", "degree", "calculateDegreeOfSuccess", "rollTotal", "popup", "title", "content", "hud", "MODULE_ID", "tmp", "localize", "__name", "showItemSummary", "el", "actor", "description", "getItemSummary", "MODULE_ID", "CROWBAR_UUIDS", "BON_MOT_UUID", "NATURAL_MEDICINE_UUID", "LABELS", "ACTIONS_UUIDS", "DUPLICATE_SKILLS", "SKILLS", "actor", "item", "hasFeat", "skill", "action", "slug", "actions", "unslugged", "_", "c", "variant", "modifiers", "modifier", "SKILLS_SLUGS", "SKILLS_MAP", "skills", "actionsUUIDS", "getSkillLabel", "__name", "getSkillsData", "noUntrained", "getSetting", "notCharacter", "i", "label", "rank", "mod", "getSkill", "lores", "addSkillsListeners", "el", "event", "showItemSummary", "target", "skillSlug", "createVariantDialog", "rollAction", "uuid", "unownedItemToMessage", "base", "dc", "content", "templatePath", "str", "localize", "html", "map", "type", "options", "condition", "SECTIONS_TYPES", "TOOLTIPS", "getActionsData", "actor", "isCharacter", "toggles", "sorting", "getSetting", "actions", "getCharacterActions", "getNpcActions", "heroActions", "heroActionsModule", "diff", "strikes", "strike", "index", "sections", "action", "type", "getActionIcon", "a", "b", "orderA", "orderB", "__name", "getActionsOptions", "addActionsListeners", "el", "addNameTooltipListeners", "callback", "x", "event", "getStrike", "getUuid", "showItemSummary", "description", "name", "getHeroActionDescription", "popup", "templatePath", "trait", "getItemFromEvent", "toggle", "domain", "option", "itemId", "suboption", "modular", "weapon", "target", "value", "baseType", "selection", "toggleWeaponTrait", "ammo", "uuid", "item", "actionsUUIDS", "feats", "traits", "actionCost", "actionType", "hasAura", "r", "SKILLS", "SUCCESS", "rollRecallKnowledges", "actor", "roll", "result", "dieResult", "dieSuccess", "lores", "skill", "target", "getUniqueTarget", "data", "str", "localize", "standard", "skills", "lore", "skillsDCs", "loresDCs", "progression", "dcs", "slug", "mod", "label", "rank", "total", "RANKS", "dc", "success", "calculateDegreeOfSuccess", "modifier", "flavor", "templatePath", "__name", "getExtrasData", "actor", "attributes", "initiative", "localize", "getMacros", "SKILLS_SLUGS", "slug", "getSkillLabel", "__name", "addExtrasListeners", "el", "token", "action", "callback", "type", "event", "showItemSummary", "addNameTooltipListeners", "getMacro", "uuid", "deleteMacro", "onDroppedMacro", "item", "unownedItemToMessage", "target", "value", "dailies", "rollRecallKnowledges", "variant", "createVariantDialog", "note", "ITEMS_TYPES", "getItemsData", "actor", "categories", "item", "type", "items", "a", "b", "__name", "addItemsListeners", "el", "addNameTooltipListeners", "event", "showItemSummary", "getItemFromEvent", "target", "itemType", "uuid", "img", "itemId", "IdentifyItemPopup", "editItem", "deleteItem", "tooltipster", "origin", "tmp", "content", "carryType", "handsHeld", "inSlot", "getSpellsData", "actor", "focusPool", "entries", "showTradition", "getSetting", "spells", "focuses", "hasFocusCantrips", "entry", "entryId", "tradition", "data", "isFocus", "isCharge", "isStaff", "charges", "slot", "slotSpells", "isCantrip", "actives", "x", "slotId", "spell", "expended", "virtual", "uses", "castLevel", "MODULE_ID", "sort", "a", "b", "rituals", "__name", "addSpellsListeners", "el", "addNameTooltipListeners", "event", "showItemSummary", "getItemFromEvent", "change", "points", "slotLevel", "itemId", "collection", "inputPath", "value", "COVER_UUID", "RESOLVE_UUID", "POSITIONS", "ALIGNMENTS", "SPEEDS", "SIDEBARS", "getActionsData", "addActionsListeners", "getActionsOptions", "getItemsData", "addItemsListeners", "getSpellsData", "addSpellsListeners", "getSkillsData", "addSkillsListeners", "getExtrasData", "addExtrasListeners", "SAVES", "SKILLS", "HUD", "#token", "#lastToken", "#delay", "#hover", "#closing", "#mouseevent", "#mousedown", "#lock", "#softLock", "#hoverToken", "#deleteToken", "#isObserved", "token", "hover", "getSetting", "transform", "document", "#setToken", "isHolding", "event", "button", "target", "el", "popup", "templatePath", "effect", "actor", "distance", "savesSetting", "othersSetting", "isCharacter", "attributes", "saves", "heroPoints", "system", "alignment", "traits", "hp", "sp", "resolve", "ac", "shield", "speed", "dying", "wounded", "resistances", "weaknesses", "immunities", "useStamina", "isObserver", "showDistance", "unitSplit", "multiplier", "unit", "decimals", "selected", "isTarget", "getUniqueTarget", "status", "statuses", "x", "max", "ratio", "pick", "toInfo", "str", "__name", "sort", "a", "b", "languages", "senses", "toIWR", "category", "header", "speeds", "type", "icon", "index", "s", "selectedSpeed", "getFlag", "mainSpeed", "otherSpeeds", "value", "label", "showDeath", "showRanks", "getStatistic", "stat", "icons", "slug", "modifier", "RANKS", "MODULE_ID", "getSkill", "#close", "options", "states", "cls", "force", "sidebarType", "scrollTop", "sidebar", "#openSidebar", "useDelay", "holding", "holdingSetting", "isParty", "delay", "html", "element", "scale", "hud", "targetCoords", "coords", "positions", "position", "postionFromTargetY", "postionFromTargetX", "isOwner", "infos", "attr", "change", "newValue", "source", "hasCover", "save", "ctrlKey", "metaKey", "shiftKey", "condition", "useResolve", "tooltipster", "origin", "tooltip", "setFlag", "action", "getData", "addListeners", "getOptions", "data", "classList", "localize", "tmp", "rect", "left", "elPadding", "top", "margin", "y", "toChat", "content", "name", "fullStamina", "noResolve", "hasSteel", "item", "newSP", "MODULE_ID", "hud", "getHud", "__name", "enableModule", "enabled", "HUD", "getSetting", "setting", "localize", "args", "data", "useFormat", "keys", "hasFeat", "actor", "uuid", "feat", "templatePath", "template", "modifier", "mod", "getFlag", "doc", "flag", "setFlag", "value", "holding", "registerKeybindings", "register", "getSetting", "getHud", "__name", "isHolding", "path", "bind", "key", "MODULE_ID", "name", "extras", "registerSettings", "isGM", "x", "statuses", "localize", "register", "enableModule", "path", "__name", "renderSettingsConfig", "_", "html", "tab", "MODULE_ID", "beforeGroup", "name", "key", "dom", "localized", "setting", "type", "defValue", "extra", "registerSettings", "registerKeybindings", "getSetting", "enableModule", "renderSettingsConfig", "_", "data", "MODULE_ID", "html", "documentId", "openMacrosDialog", "DataDialog", "options", "__name", "actorId", "actor", "dialog", "localize", "macros", "getMacros", "templatePath", "event", "onDroppedMacro", "deleteMacro"]
}
